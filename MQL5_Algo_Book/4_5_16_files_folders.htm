<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>4.5.16 Working with folders</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part4.htm"> Part 4. Common APIs </a> / <a class="h_m" href="4_5_files.htm"> 4.5 Working with files </a>/ 4.5.16 Working with folders
          </td>
          <td width="70" align="right">
          <a href="4_5_15_files_find.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="4_5_17_files_select.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">4.5.16 Working with folders</span></p>
<p class="p_Text"><span class="f_Text">It is difficult to imagine a file system without the ability to structure stored information through an arbitrary hierarchy of directories – containers for sets of logically related files. At the MQL5 level, this feature is also supported. If necessary, we can create, clean up and delete folders using the built-in functions </span><span class="f_Text" style="font-style: italic;">FolderCreate</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">FolderClean</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">FolderDelete</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Earlier, we have already seen one way to create a folder, and, perhaps, not even one, but the entire required hierarchy of subfolders at once. For this, when creating (opening) a file using </span><span class="f_Text" style="font-style: italic;"><a href="4_5_3_files_open_close.htm" class="topiclink">FileOpen</a></span><span class="f_Text">, or when copying it (</span><span class="f_Text" style="font-style: italic;"><a href="4_5_14_files_copy_move.htm" class="topiclink">FileCopy</a></span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;"><a href="4_5_14_files_copy_move.htm" class="topiclink">FileMove</a></span><span class="f_Text">), you should specify not just a name, but precede it with the required path. For example,</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileCopy</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/unicode1.txt&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;ABC/DEF/code.txt&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This statement will create the &quot;ABC&quot; folder in the sandbox, the &quot;DEF&quot; folder in it, and copy the file there under a new name (the source file must exist).</span></p>
<p class="p_Text"><span class="f_Text">If you do not want to create a source file in advance, you can create a dummy file on the go:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">dummy</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileSave</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;ABC/DEF/empty&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">dummy</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here we will get the same folder hierarchy as in the previous example but with a zero-size &quot;empty&quot; file.</span></p>
<p class="p_Text"><span class="f_Text">With such approaches, the creation of folders becomes some sort of a by-product of working with files. However, sometimes it is required to operate with folders as independent entities and without side effects, in particular, just create an empty folder. This is offered by the </span><span class="f_Text" style="font-style: italic;">FolderCreate</span><span class="f_Text"> function.</span></p>
<p class="p_H4"><span class="f_H4">bool FolderCreate(const string folder, int flag = 0)</span></p>
<p class="p_Text"><span class="f_Text">The function creates a folder named </span><span class="f_Text" style="font-style: italic;">folder</span><span class="f_Text">, which can include a path (several top-level folder names). In either case, a single folder or folder hierarchy is created in the sandbox defined by the </span><span class="f_Text" style="font-style: italic;">flag</span><span class="f_Text"> parameter. By default when </span><span class="f_Text" style="font-style: italic;">flag</span><span class="f_Text"> is 0, the local working folder </span><span class="f_Text" style="font-style: italic;">MQL5/Files</span><span class="f_Text"> of terminal or tester agent (if the program is running in the tester) is used. If </span><span class="f_Text" style="font-style: italic;">flag</span><span class="f_Text"> equals FILE_COMMON, the shared folder of all terminals is used.</span></p>
<p class="p_Text"><span class="f_Text">The function returns </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text"> on success, or if the folder already exists. In case of an error, the result is </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">.</span></p>
<p class="p_H4"><span class="f_H4">bool FolderClean(const string folder, int flag = 0)</span></p>
<p class="p_Text"><span class="f_Text">The function deletes all files and folders of any nesting level (together with all content) in the specified </span><span class="f_Text" style="font-style: italic;">folder</span><span class="f_Text"> directory. The </span><span class="f_Text" style="font-style: italic;">flag</span><span class="f_Text"> parameter specifies the sandbox (local or global) in which the action takes place.</span></p>
<p class="p_Quote"><span class="f_Quote">Use this feature with caution, as all files and subfolders (with their files) are permanently deleted.</span></p>
<p class="p_H4"><span class="f_H4">bool FolderDelete(const string folder, int flag = 0)</span></p>
<p class="p_Text"><span class="f_Text">The function deletes the specified folder (</span><span class="f_Text" style="font-style: italic;">folder</span><span class="f_Text">). Before calling the function, the folder must be empty, otherwise it cannot be deleted.</span></p>
<p class="p_Text"><span class="f_Text">Techniques for working with these three functions are demonstrated in the script </span><span class="f_Text" style="font-style: italic;">FileFolder.mq5</span><span class="f_Text">. You can execute this script in the debug mode step by step (statement by statement) and watch in the file manager how folders and files appear and disappear. However, please note that before executing the next instruction, you should use the file manager to exit the created folders up to the &quot;MQL5Book&quot; level, because otherwise the folders may be occupied by the file manager, and this will disrupt the script.</span></p>
<p class="p_Text"><span class="f_Text">We first create several subfolders as a by-product of writing an empty dummy file into them.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">filename</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/ABC/DEF/dummy&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">dummy</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileSave</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">filename</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">dummy</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;true</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Next, we create another folder at the bottom nesting level with </span><span class="f_Text" style="font-style: italic;">FolderCreate</span><span class="f_Text">: This time the folder appears on its own, without the helper file.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FolderCreate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/ABC/GHI&quot;</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;true</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">If you try to delete the &quot;DEF&quot; folder, it will fail because it is not empty (there is a file there).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FolderDelete</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/ABC/DEF&quot;</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;false&nbsp;/&nbsp;CANNOT_DELETE_DIRECTORY(5024)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In order to remove it, you must first clear it, and the easiest way to do this is with </span><span class="f_Text" style="font-style: italic;">FolderClean</span><span class="f_Text">. But we will try to simulate a common situation when some files in the folders being cleared can be locked by other MQL programs, external applications, or the terminal itself. Let's open the file for reading and call </span><span class="f_Text" style="font-style: italic;">FolderClean</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">filename</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FolderClean</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/ABC&quot;</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;false&nbsp;/&nbsp;CANNOT_CLEAN_DIRECTORY(5025)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The function returns </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text"> and exposes error code 5025 (CANNOT_CLEAN_DIRECTORY). After we close the file, cleaning and deleting the entire folder hierarchy succeeds.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FolderClean</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/ABC&quot;</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;true</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FolderDelete</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/ABC&quot;</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;true</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Potential locks are more likely when using a shared terminal directory, where the same file or folder can be &quot;claimed&quot; by different program instances. But even in a local sandbox, you should not forget about possible conflicts (for example, if a csv file is opened in Excel). Implement detailed diagnostics and error output for the code parts that work with folders, so that the user can notice and fix the problem.</span></p>

</div>

</body>
</html>
