<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>4.5.6 Writing and reading arrays</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part4.htm"> Part 4. Common APIs </a> / <a class="h_m" href="4_5_files.htm"> 4.5 Working with files </a>/ 4.5.6 Writing and reading arrays
          </td>
          <td width="70" align="right">
          <a href="4_5_5_files_txt_codepage.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="4_5_7_files_bin_structs.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">4.5.6 Writing and reading arrays</span></p>
<p class="p_Text"><span class="f_Text">Two MQL5 functions are intended for writing and reading arrays: </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">FileReadArray</span><span class="f_Text">. With binary files, they allow you to handle arrays of any built-in type other than strings, as well as arrays of simple structures that do not contain string fields, objects, pointers, and dynamic arrays. These limitations are related to the optimization of the writing and reading processes, which is possible due to the exclusion of types with variable lengths. Strings, objects, and dynamic arrays are just like that.</span></p>
<p class="p_Text"><span class="f_Text">At the same time, when working with text files, these functions are able to operate on arrays of type </span><span class="f_Text" style="font-style: italic;">string</span><span class="f_Text"> (other types of arrays in files with FILE_TXT/FILE_CSV mode are not allowed by these functions). Such arrays are stored in a file in the following format: one element per line.</span></p>
<p class="p_Text"><span class="f_Text">If you need to store structures or classes without type restrictions in a file, use type-specific functions that process one value per call. They are described in two sections on writing and reading variables of built-in types: for <a href="4_5_8_files_bin_atomic.htm" class="topiclink">binary</a> and <a href="4_5_9_files_txt_atomic.htm" class="topiclink">text</a> files.</span></p>
<p class="p_Text"><span class="f_Text">In addition, support for structures with strings can be organized through internal optimization of information storage. For example, instead of string fields, you can use integer fields, which will contain the indices of the corresponding strings in a separate array with strings. Given the possibility of redefining many operations (in particular, the assignment) using OOP tools and obtaining a structural element of an array by number, the appearance of the algorithm will practically not change. But when writing, you can first open a file in binary mode and call </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> for an array with a simplified structure type and then reopen the file in text mode and add an array of all strings to it using the second </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> call. To read such a file, you should provide a header at the beginning of it containing the number of elements in the arrays in order to pass it as the </span><span class="f_Text" style="font-style: italic;">count</span><span class="f_Text"> parameter into </span><span class="f_Text" style="font-style: italic;">FileReadArray</span><span class="f_Text"> (see further along). &nbsp;</span></p>
<p class="p_Text"><span class="f_Text">If you need to save or read not an array of structures, but a single structure, use the </span><span class="f_Text" style="font-style: italic;">FileWriteStruct</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">FileReadStruct</span><span class="f_Text"> functions which are described in the <a href="4_5_7_files_bin_structs.htm" class="topiclink">next section</a>.</span></p>
<p class="p_Text"><span class="f_Text">Let's study function signatures and then consider a general example (</span><span class="f_Text" style="font-style: italic;">FileArray.mq5</span><span class="f_Text">).</span></p>
<p class="p_H4"><span class="f_H4">uint FileWriteArray(int handle, const void &amp;array[], int start = 0, int count = WHOLE_ARRAY)</span></p>
<p class="p_Text"><span class="f_Text">The function writes the </span><span class="f_Text" style="font-style: italic;">array array </span><span class="f_Text">to a file with the </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> descriptor. The array can be multidimensional. The </span><span class="f_Text" style="font-style: italic;">start</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">count</span><span class="f_Text"> parameters allow to set the range of elements; by default, it is equal to the entire array. In the case of multidimensional arrays, the </span><span class="f_Text" style="font-style: italic;">start</span><span class="f_Text"> index and the number of elements </span><span class="f_Text" style="font-style: italic;">count</span><span class="f_Text"> refer to continuous numbering across all dimensions, not the first dimension of the array. For example, if the array has the configuration [][5], then the </span><span class="f_Text" style="font-style: italic;">start </span><span class="f_Text">value equal to 7 will point to the element with indexes [1][2], and </span><span class="f_Text" style="font-style: italic;">count = 2</span><span class="f_Text"> will add the element [1][3] to it.</span></p>
<p class="p_Text"><span class="f_Text">The function returns the number of written elements. In case of an error, it will be 0.</span></p>
<p class="p_Text"><span class="f_Text">If </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> is received in binary mode, arrays can be of any built-in type except strings, or simple structure types. If </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> is opened in any of the text modes, the array must be of type </span><span class="f_Text" style="font-style: italic;">string</span><span class="f_Text">.</span></p>
<p class="p_H4"><span class="f_H4">uint FileReadArray(int handle, const void &amp;array[], int start = 0, int count = WHOLE_ARRAY)</span></p>
<p class="p_Text"><span class="f_Text">The function reads data from a file with the </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> descriptor into an array. The array can be multidimensional and dynamic. For multidimensional arrays, the </span><span class="f_Text" style="font-style: italic;">start</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">count</span><span class="f_Text"> parameters work on the basis of the continuous numbering of elements in all dimensions, described above. A dynamic array, if necessary, automatically increases in size to fit the data being read. If </span><span class="f_Text" style="font-style: italic;">start</span><span class="f_Text"> is greater than the original length of the array, these intermediate elements will contain random data after memory allocation (see the example).</span></p>
<p class="p_Quote"><span class="f_Quote">Pay attention that the function cannot control whether the configuration of the array used when writing the file matches the configuration of the receiving array when reading. Basically, there is no guarantee that the file being read was written with </span><span class="f_Quote" style="font-style: italic;">FileWriteArray</span><span class="f_Quote">.</span><br>
<span class="f_Quote" style="font-style: italic;">&nbsp;</span><br>
<span class="f_Quote">To check the validity of the data structure, some predefined formats of initial headers or other descriptors inside files are usually used. The functions themselves will read any contents of the file within its size and place it in the specified array.</span></p>
<p class="p_Text"><span class="f_Text">If </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> is received in binary mode, arrays can be any of the built-in non-string types or simple structure types. If </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> is opened in text mode, the array must be of type </span><span class="f_Text" style="font-style: italic;">string</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Let's check the work both in binary and in text mode using the </span><span class="f_Text" style="font-style: italic;">FileArray.mq5</span><span class="f_Text"> script. To do this, we will reserve two file names.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">raw</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/array.raw&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">txt</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/array.txt&quot;</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Three arrays of type </span><span class="f_Text" style="font-style: italic;">long</span><span class="f_Text"> and two arrays of type </span><span class="f_Text" style="font-style: italic;">string</span><span class="f_Text"> are described in the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> function. Only the first array of each type is filled with data, and all the rest will be checked for reading after the files are written.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">numbers1</span><span class="f_CodeExample">[][</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">]&nbsp;=&nbsp;{{</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">4</span><span class="f_CodeExample">},&nbsp;{</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">5</span><span class="f_CodeExample">},&nbsp;{</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">6</span><span class="f_CodeExample">}};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">numbers2</span><span class="f_CodeExample">[][</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">numbers3</span><span class="f_CodeExample">[][</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">text1</span><span class="f_CodeExample">[][</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">]&nbsp;=&nbsp;{{</span><span class="f_CodeExample" style="color: #008080;">&quot;1.0&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;abc&quot;</span><span class="f_CodeExample">},&nbsp;{</span><span class="f_CodeExample" style="color: #008080;">&quot;2.0&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;def&quot;</span><span class="f_CodeExample">},&nbsp;{</span><span class="f_CodeExample" style="color: #008080;">&quot;3.0&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;ghi&quot;</span><span class="f_CodeExample">}};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">text2</span><span class="f_CodeExample">[][</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In addition, to test operations with structures, the following 3 types are defined:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">TT</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">s1</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">s2</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">B</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">b</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">setB</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">)&nbsp;{&nbsp;</span><span class="f_CodeExample" style="color: #333333;">b</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;}</span>
<br><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">XYZ</span><span class="f_CodeExample">&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">B</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">color</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">y</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">z</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">We will not be able to use a structure of the </span><span class="f_Text" style="font-style: italic;">TT</span><span class="f_Text"> type in the described functions because it contains string fields. It is needed to demonstrate a potential compilation error in a commented statement (see further along). Inheritance between structures </span><span class="f_Text" style="font-style: italic;">B</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">XYZ</span><span class="f_Text">, as well as the presence of a closed field, are not an obstacle for the functions </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">FileReadArray</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">The structures are used to declare a pair of arrays:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">TTtt</span><span class="f_CodeExample">[];&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;empty,&nbsp;because&nbsp;data&nbsp;is&nbsp;not&nbsp;important</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">XYZ</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">xyz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">xyz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">setB</span><span class="f_CodeExample">(-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">xyz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">xyz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">y</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">xyz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">z</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">clrRed</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Let's start with binary mode. Let's create a new file or open an existing file, dumping its contents. Then, in three </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> calls, we will try to write three arrays: </span><span class="f_Text" style="font-style: italic;">numbers1</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">text1</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">xyz</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">raw</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">numbers1</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;6&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">text1</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;0&nbsp;/&nbsp;FILE_NOTTXT(5012)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">xyz</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">numbers1</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Arrays </span><span class="f_Text" style="font-style: italic;">numbers1</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">xyz</span><span class="f_Text"> are written successfully, as indicated by the number of items written. The </span><span class="f_Text" style="font-style: italic;">text1</span><span class="f_Text"> array fails with a FILE_NOTTXT(5012) error because string arrays require the file to be opened in text mode. Therefore the content </span><span class="f_Text" style="font-style: italic;">xyz</span><span class="f_Text"> will be located in the file immediately after all elements of </span><span class="f_Text" style="font-style: italic;">numbers1</span><span class="f_Text">.</span></p>
<p class="p_Quote"><span class="f_Quote">Note that each write (or read) function starts writing (or reading) data to the current position within the file, and shifts it by the size of the written or read data. If this pointer is at the end of the file before the write operation, the file size is increased. If the end of the file is reached while reading, the pointer no longer moves and the system raises a special internal error code 5027 (FILE_ENDOFFILE). In a new file of the zero size, the beginning and end are the same.</span></p>
<p class="p_Text"><span class="f_Text">From an array </span><span class="f_Text" style="font-style: italic;">text1</span><span class="f_Text">, 0 items were written, so nothing in the file reminds you that between two successful calls </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> there was one failure.</span></p>
<p class="p_Text"><span class="f_Text">In the test script, we simply output the result of the function and the status (error code) to the log, but in a real program, we should analyze problems on the go and take some actions: fix something in the parameters, in the file settings, or interrupt the process with a message to the user.</span></p>
<p class="p_Text"><span class="f_Text">Let's read a file into the </span><span class="f_Text" style="font-style: italic;">numbers2</span><span class="f_Text"> array.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">reader</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">raw</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileReadArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">reader</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">numbers2</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;8&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">numbers2</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Since two different arrays were written to the file (not only </span><span class="f_Text" style="font-style: italic;">numbers1</span><span class="f_Text">, but also </span><span class="f_Text" style="font-style: italic;">xyz</span><span class="f_Text">), 8 elements were read into the receiving array (i.e., the entire file to the end, because otherwise was not specified using parameters).</span></p>
<p class="p_Text"><span class="f_Text">Indeed, the size of the structure </span><span class="f_Text" style="font-style: italic;">XYZ</span><span class="f_Text"> is 16 bytes (4 fields of 4 bytes: one </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text"> and three </span><span class="f_Text" style="font-style: italic;">color</span><span class="f_Text">), which corresponds to one row in the array </span><span class="f_Text" style="font-style: italic;">numbers2</span><span class="f_Text"> (2 elements of type </span><span class="f_Text" style="font-style: italic;">long</span><span class="f_Text">). In this case, it's a coincidence. As noted above, the functions have no idea about the configuration and size of the raw data and can read anything into any array: the programmer must monitor the validity of the operation.</span></p>
<p class="p_Text"><span class="f_Text">Let's compare the initial and received states. Source array </span><span class="f_Text" style="font-style: italic;">numbers1</span><span class="f_Text">:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,0][,1]</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[0,]&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;4</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[1,]&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;5</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[2,]&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;6</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Resulting array </span><span class="f_Text" style="font-style: italic;">numbers2</span><span class="f_Text">:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,0]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,1]</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[0,]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[1,]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[2,]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[3,]&nbsp;1099511627775&nbsp;1095216660735</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The beginning of the </span><span class="f_Text" style="font-style: italic;">numbers2</span><span class="f_Text"> array completely matches the original </span><span class="f_Text" style="font-style: italic;">numbers1</span><span class="f_Text"> array, i.e., writing and reading through the file work properly.</span></p>
<p class="p_Text"><span class="f_Text">The last row is entirely occupied by a single structure </span><span class="f_Text" style="font-style: italic;">XYZ</span><span class="f_Text"> (with correct values, but incorrect representation as two numbers of type </span><span class="f_Text" style="font-style: italic;">long</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">Now we get to the file beginning (using the </span><span class="f_Text" style="font-style: italic;">FileSeek </span><span class="f_Text">function, which we will discuss later in the section <a href="4_5_10_files_cursor.htm" class="topiclink">Position control within a file</a>) and call </span><span class="f_Text" style="font-style: italic;">FileReadArray</span><span class="f_Text"> indicating the number and quantity of elements, i.e., we perform a partial reading.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileSeek</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">reader</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">SEEK_SET</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;true</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileReadArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">reader</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">numbers3</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">10</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">reader</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">numbers3</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Three elements are read from the file and placed, starting at index 10, into the receiving array </span><span class="f_Text" style="font-style: italic;">numbers3</span><span class="f_Text">. Since the file is read from the beginning, these elements are the values 1, 4, 2. And since a two-dimensional array has the configuration [][2], the through index 10 points to the element [5,0]. Here's what it looks like in memory:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,0][,1]</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[0,]</span><span class="f_CodeExample" style="background-color: #ffff00;">&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;4</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[1,]</span><span class="f_CodeExample" style="background-color: #ffff00;">&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;4</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[2,]</span><span class="f_CodeExample" style="background-color: #ffff00;">&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;6</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[3,]</span><span class="f_CodeExample" style="background-color: #ffff00;">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[4,]</span><span class="f_CodeExample" style="background-color: #ffff00;">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[5,]&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;4</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;[6,]&nbsp;&nbsp;&nbsp;2</span><span class="f_CodeExample" style="background-color: #ffff00;">&nbsp;&nbsp;&nbsp;0</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Items marked in yellow are random (may change for different script runs). It is possible that they will all be zero, but this is not guaranteed. The </span><span class="f_Text" style="font-style: italic;">numbers3</span><span class="f_Text"> array initially was empty and the </span><span class="f_Text" style="font-style: italic;">FileReadArray</span><span class="f_Text"> call initiated an allocation of memory required to receive 3 elements at offset 10 (total 13). The selected block is not filled with anything, and only 3 numbers are read from the file. Therefore, elements with through indices from 0 to 9 (i.e. the first 5 rows), as well as the last one, with index 13, contain garbage.</span></p>
<p class="p_Text"><span class="f_Text">Multidimensional arrays are scaled along the first dimension, and therefore an increase of 1 number means adding the entire configuration along higher dimensions. In this case, the distribution concerns a series of two numbers ([][2]). In other words, the requested size 13 is rounded up to a multiple of two, that is, 14.</span></p>
<p class="p_Text"><span class="f_Text">Finally, let's test how the functions work with string arrays. Let's create a new file or open an existing file, dumping its contents. Then, in two </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> calls, we will write the </span><span class="f_Text" style="font-style: italic;">text1</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">numbers1</span><span class="f_Text"> arrays.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">txt</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_TXT</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_ANSI</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">text1</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;6&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">numbers1</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;0&nbsp;/&nbsp;FILE_NOTBIN(5011)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The string array is saved successfully. The numeric array is ignored with a FILE_NOTBIN(5011) error because it must open the file in binary mode.</span></p>
<p class="p_Text"><span class="f_Text">When trying to write an array of structures </span><span class="f_Text" style="font-style: italic;">tt</span><span class="f_Text">, we get a compilation error with a lengthy message &quot;structures or classes with objects are not allowed&quot;. What the compiler actually means is that it doesn't like fields like </span><span class="f_Text" style="font-style: italic;">string</span><span class="f_Text"> (it is assumed that strings and dynamic arrays have an internal representation of some service objects). Thus, despite the fact that the file is opened in text mode and there are only text fields in the structure, this combination is not supported in MQL5.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;COMPILATION&nbsp;ERROR:&nbsp;structures&nbsp;or&nbsp;classes&nbsp;containing&nbsp;objects&nbsp;are&nbsp;not&nbsp;allowed</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">writer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">tt</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The presence of string fields makes the structure &quot;complicated&quot; and unsuitable for working with functions </span><span class="f_Text" style="font-style: italic;">FileWriteArray/FileReadArray</span><span class="f_Text"> in any mode.</span></p>
<p class="p_Text"><span class="f_Text">After running the script, you can change to the directory </span><span class="f_Text" style="font-style: italic;">MQL5/Files/MQL5Book</span><span class="f_Text"> and examine the contents of the generated files.</span></p>
<p class="p_Text"><span class="f_Text">Earlier, in the section <a href="4_5_2_files_save_load.htm" class="topiclink">Writing and reading files in simplified mode</a>, we discussed the </span><span class="f_Text" style="font-style: italic;">FileSave</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">FileLoad</span><span class="f_Text"> functions. In the test script (</span><span class="f_Text" style="font-style: italic;">FileSaveLoad.mq5</span><span class="f_Text">), we have implemented the equivalent versions of these functions using </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">FileReadArray</span><span class="f_Text">. But we have not seen them in detail. Since we are now familiar with these new functions, we can examine the source code:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">template</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">MyFileSave</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">array</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">flags</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #333333;">flags</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INVALID_HANDLE</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">false</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">array</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">template</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">MyFileLoad</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">array</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">flags</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #333333;">flags</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INVALID_HANDLE</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileReadArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">array</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)(</span><span class="f_CodeExample" style="color: #0000ff;">FileSize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">)&nbsp;/&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">sizeof</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">)));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;this&nbsp;version&nbsp;has&nbsp;the&nbsp;following&nbsp;check&nbsp;added&nbsp;compared&nbsp;to&nbsp;the&nbsp;standard&nbsp;FileLoad:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;is&nbsp;not&nbsp;a&nbsp;multiple&nbsp;of&nbsp;the&nbsp;structure&nbsp;size,&nbsp;print&nbsp;a&nbsp;warning</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">leftover</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileSize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">)&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileTell</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">leftover</span><span class="f_CodeExample">&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Warning&nbsp;from&nbsp;%s:&nbsp;Some&nbsp;data&nbsp;left&nbsp;unread:&nbsp;%d&nbsp;bytes&quot;</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">__FUNCTION__</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">leftover</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">SetUserError</span><span class="f_CodeExample">((</span><span class="f_CodeExample" style="color: #0000ff;">ushort</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">leftover</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text" style="font-style: italic;">MyFileSave</span><span class="f_Text"> is built on a single call of </span><span class="f_Text" style="font-style: italic;">FileWriteArray</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">MyFileLoad</span><span class="f_Text"> on </span><span class="f_Text" style="font-style: italic;">FileReadArray </span><span class="f_Text">call, between a pair of </span><span class="f_Text" style="font-style: italic;">FileOpen/FileClose</span><span class="f_Text"> calls. In both cases, all available data is written and read. Thanks to templates, our functions are also able to accept arrays of arbitrary types. But if any unsupported type (for example, a class) is deduced as a meta parameter T, then a compilation error will occur, as is the case with incorrect access to built-in functions.</span></p>

</div>

</body>
</html>
