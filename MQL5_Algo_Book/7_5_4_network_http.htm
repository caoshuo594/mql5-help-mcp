<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>7.5.4 Data exchange with a web server via HTTP/HTTPS protocol</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part7.htm"> Part 7. Advanced language tools </a> / <a class="h_m" href="7_5_network.htm"> 7.5 Network functions </a>/ 7.5.4 Data exchange with a web server via HTTP/HTTPS
          </td>
          <td width="70" align="right">
          <a href="7_5_3_network_ftp.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="7_5_5_network_socket_create_connect.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">7.5.4 Data exchange with a web server via HTTP/HTTPS</span></p>
<p class="p_Text"><span class="f_Text">MQL5 allows you to integrate programs with web services and request data from the Internet. Data can be sent and received via HTTP/HTTPS protocols using the </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> function, which has two versions: for simplified and for advanced interaction with web servers.</span></p>
<p class="p_H4"><span class="f_H4">int WebRequest(const string method, const string url, const string cookie, const string referer,</span><br>
<span class="f_H4"> &nbsp; int timeout, const char &amp;data[], int size, char &amp;result[], string &amp;response)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">int WebRequest(const string method, const string url, const string headers, int timeout,</span><br>
<span class="f_H4"> &nbsp; const char &amp;data[], char &amp;result[], string &amp;response)</span></p>
<p class="p_Text"><span class="f_Text">The main difference between the two functions is that the simplified version allows you to specify only two types of headers in the request: a </span><span class="f_Text" style="font-style: italic;">cookie</span><span class="f_Text"> and a </span><span class="f_Text" style="font-style: italic;">referer</span><span class="f_Text">, i.e. the address from where the transition is made (there is no typo here – historically the word &quot;referrer&quot; is written in HTTP headers through one 'r'). The extended version takes a generic </span><span class="f_Text" style="font-style: italic;">headers</span><span class="f_Text"> parameter to send an arbitrary set of headers. Request headers are of the form &quot;name: value&quot; and are joined by a line break &quot;\r\n&quot; if there is more than one.</span></p>
<p class="p_Text"><span class="f_Text">If we assume that the </span><span class="f_Text" style="font-style: italic;">cookie</span><span class="f_Text"> string must contain &quot;name1=value1; name2=value2&quot; and the </span><span class="f_Text" style="font-style: italic;">referer</span><span class="f_Text"> link is equal to &quot;google.com&quot;, then to call the second version of the function with the same effect as the first one, we need to add the following in the </span><span class="f_Text" style="font-style: italic;">headers</span><span class="f_Text"> parameter: &quot;Cookie: name1=value1; name2=value2\r\nReferer: google.com&quot;.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">method</span><span class="f_Text"> parameter specifies one of the protocol methods, &quot;HEAD&quot;, &quot;GET&quot;, or &quot;POST&quot;. The address of the requested resource or service is passed in the </span><span class="f_Text" style="font-style: italic;">url</span><span class="f_Text"> parameter. According to the HTTP specification, the length of a network resource identifier is limited to 2048 bytes, but at the time of writing the book, MQL5 had a limit of 1024 bytes.</span></p>
<p class="p_Text"><span class="f_Text">The maximum duration of a request is determined by the </span><span class="f_Text" style="font-style: italic;">timeout</span><span class="f_Text"> in milliseconds.</span></p>
<p class="p_Text"><span class="f_Text">Both versions of the function transfer data from the </span><span class="f_Text" style="font-style: italic;">data</span><span class="f_Text"> array to the server. The first option additionally requires specifying the size of this array in bytes (</span><span class="f_Text" style="font-style: italic;">size</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">To send simple requests with values of several variables, you can combine them into a string like &quot;name1=value1&amp;name2=value2&amp;...&quot; and add them to the GET request address, after the delimiter character '?' or put in the </span><span class="f_Text" style="font-style: italic;">data</span><span class="f_Text"> array for a POST request using the &quot;Content-Type: application/x-www-form-urlencoded&quot; header. For more complex cases, such as uploading files, use a POST request and &quot;Content-Type: multipart/form-data&quot;.</span></p>
<p class="p_Text"><span class="f_Text">The receiving </span><span class="f_Text" style="font-style: italic;">result</span><span class="f_Text"> array gets the server response body (if any). The server response headers are placed in the </span><span class="f_Text" style="font-style: italic;">response</span><span class="f_Text"> string.</span></p>
<p class="p_Text"><span class="f_Text">The function returns the HTTP response code of the server or -1 in case of a system error (for example, communication problems or parameter errors). The potential error codes that can appear in </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> include:</span></p>
<ul>
<li class="p_li"><span class="f_li">5200 – ERR_WEBREQUEST_INVALID_ADDRESS – invalid URL</span></li>
<li class="p_li"><span class="f_li">5201 – ERR_WEBREQUEST_CONNECT_FAILED – failed to connect to the specified URL</span></li>
<li class="p_li"><span class="f_li">5202 – ERR_WEBREQUEST_TIMEOUT – the timeout for receiving a response from the server has been exceeded</span></li>
<li class="p_li"><span class="f_li">5203 – ERR_WEBREQUEST_REQUEST_FAILED – any other error as a result of the request</span></li>
</ul>
<p class="p_Text"><span class="f_Text">Recall that even if the request was executed without errors at the MQL5 level, an application error may be contained in the HTTP response code of the server (for example, authorization is required, invalid data format, page not found, etc.). In this case, the result will be empty, and instructions for resolving the situation, as a rule, are clarified by analyzing the received </span><span class="f_Text" style="font-style: italic;">response</span><span class="f_Text"> headers.</span></p>
<p class="p_Text"><span class="f_Text">To use the </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> function, the server addresses should be added to the list of allowed URLs in the </span><span class="f_Text" style="font-style: italic;">Expert Advisors</span><span class="f_Text"> tab in terminal settings. The server port is automatically selected based on the specified protocol: 80 for &quot;http://&quot; and 443 for &quot;https://&quot;.</span></p>
<p class="p_Quote"><span class="f_Quote">The f</span><span class="f_Quote" style="font-style: italic;">WebRequest</span><span class="f_Quote"> unction is synchronous, i.e., it pauses program execution while waiting for a response from the server. In this regard, the function is not allowed to be called from indicators, since they work in common streams for each character. A delay in the execution of one indicator will stop updating all charts for this symbol.</span></p>
<p class="p_Text"><span class="f_Text">When working in the strategy tester, the </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> function is not executed.</span></p>
<p class="p_Text"><span class="f_Text">Let's start with a simple script </span><span class="f_Text" style="font-style: italic;">WebRequestTest.mq5</span><span class="f_Text"> that executes a single request. In the input parameters, we will provide a choice for the method (by default &quot;GET&quot;), the address of the test web page, additional headers (optional), and the timeout as well.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Method</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;GET&quot;</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;Method&nbsp;(GET,POST)</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;https://httpbin.org/headers&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Timeout</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">5000</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The address is entered as in the browser line: all characters that are forbidden by the HTTP specification to be used directly in addresses (including local alphabet characters) are automatically &quot;masked&quot; by the </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> function before sending according to the </span><span class="f_Text" style="font-style: italic;">urlencode</span><span class="f_Text"> algorithm (the browser does exactly the same, but we don't see it, since this view is intended to be passed over the network infrastructure, not to humans).</span></p>
<p class="p_Text"><span class="f_Text">We will also add the </span><span class="f_Text" style="font-style: italic;">DumpDataToFiles</span><span class="f_Text"> option: when it equals </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">, the script will save the server's response to a separate file since it can be quite large. Value </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text"> instructs to output data directly to the log.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">DumpDataToFiles</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Quote"><span class="f_Quote">We have to say right away that testing such scripts requires a server. Those interested can install a local web server, for example, node.js, but this requires self-preparation or installation of server-side scripts (in this case, connecting JavaScript modules). An easier way is to use public test web servers available on the Internet. You could use, for example, </span><span class="f_Quote" style="font-style: italic;">httpbin.org</span><span class="f_Quote">, </span><span class="f_Quote" style="font-style: italic;">httpbingo.org</span><span class="f_Quote">, </span><span class="f_Quote" style="font-style: italic;">webhook site</span><span class="f_Quote">, </span><span class="f_Quote" style="font-style: italic;">putsreq.com</span><span class="f_Quote">, </span><span class="f_Quote" style="font-style: italic;">www.mockable.io</span><span class="f_Quote">, or </span><span class="f_Quote" style="font-style: italic;">reqbin.com</span><span class="f_Quote">. They provide a different set of features. Choose or find the right one for you (convenient and understandable, or as flexible as possible).</span></p>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">Address</span><span class="f_Text"> parameter the default is the address of the </span><span class="f_Text" style="font-style: italic;">endpoint</span><span class="f_Text"> of the server API </span><span class="f_Text" style="font-style: italic;">httpbin.org</span><span class="f_Text">. This dynamic &quot;web page&quot; returns the HTTP headers of its request (in JSON format) to the client. Thus, we will be able to see in our program what exactly came to the web server from the terminal.</span></p>
<p class="p_Quote"><span class="f_Quote">Don't forget to add the &quot;httpbin.org&quot; domain to the allowed list in the terminal settings.</span></p>
<p class="p_Text"><span class="f_Text">The JSON text format is the de facto standard for web services. Ready-made implementations of classes for parsing JSON can be found on the </span><span class="f_Text" style="font-style: italic;">mql5.com</span><span class="f_Text"> site, but for now, we'll just show the JSON &quot;as is&quot;.</span></p>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> handler, we call </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> with the given parameters and process the result if the error code is non-negative. Server response headers (</span><span class="f_Text" style="font-style: italic;">response</span><span class="f_Text">) are always logged.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">WebRequest</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Method</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Timeout</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;&gt;&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Got&nbsp;data:&nbsp;%d&nbsp;bytes&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">DumpDataToFiles</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">parse</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">filename</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">URL_HOST</span><span class="f_CodeExample">]&nbsp;+</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">URL_PATH</span><span class="f_CodeExample">])&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">&nbsp;?&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">URL_PATH</span><span class="f_CodeExample">]&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;/_index_.htm&quot;</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Saving&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">filename</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileSave</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">filename</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">CharArrayToString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">80</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">CP_UTF8</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">To form the file name, we use the URL helper class from the header file </span><span class="f_Text" style="font-style: italic;">URL.mqh</span><span class="f_Text"> (which will not be fully described here). Method </span><span class="f_Text" style="font-style: italic;">URL::parse</span><span class="f_Text"> parses the passed string into URL components according to the specification as the general form of the URL is always &quot;protocol://domain.com:port/path?query#hash&quot;; note that many fragments are optional. The results are placed in the receiving array, the indexes in which correspond to specific parts of the URL and are described in the URL_PARTS enumeration:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">enum</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_PARTS</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_COMPLETE</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;full&nbsp;address</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_SCHEME</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;protocol</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_USER</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;username/password&nbsp;(deprecated,&nbsp;not&nbsp;supported)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_HOST</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;server</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_PORT</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;port&nbsp;number</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_PATH</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;path/directories</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_QUERY</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;query&nbsp;string&nbsp;after&nbsp;'?'</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_FRAGMENT</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;fragment&nbsp;after&nbsp;'#'&nbsp;(not&nbsp;highlighted)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL_ENUM_LENGTH</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Thus, when the received data should be written to a file, the script creates it in a folder named after the server (</span><span class="f_Text" style="font-style: italic;">parts[URL_HOST]</span><span class="f_Text">) and so on, preserving the path hierarchy in the URL (</span><span class="f_Text" style="font-style: italic;">parts[URL_PATH]</span><span class="f_Text">): in the simplest case, this will simply be the name of the &quot;endpoint&quot;. When the home page of a site is requested (the path contains only a slash '/'), the file is named &quot;_index_.htm&quot;.</span></p>
<p class="p_Text"><span class="f_Text">Let's try to run the script with default parameters, remembering to allow this server in the terminal settings first. In the log, we will see the following lines (HTTP headers of the server response and a message about the successful saving of the file):</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">WebRequest(Method,Address,Headers,Timeout,data,result,response)=200&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">Date:&nbsp;Fri,&nbsp;22&nbsp;Jul&nbsp;2022&nbsp;08:45:03&nbsp;GMT</span>
<br><span class="f_CodeExample">Content-Type:&nbsp;application/json</span>
<br><span class="f_CodeExample">Content-Length:&nbsp;291</span>
<br><span class="f_CodeExample">Connection:&nbsp;keep-alive</span>
<br><span class="f_CodeExample">Server:&nbsp;gunicorn/19.9.0</span>
<br><span class="f_CodeExample">Access-Control-Allow-Origin:&nbsp;*</span>
<br><span class="f_CodeExample">Access-Control-Allow-Credentials:&nbsp;true</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">Got&nbsp;data:&nbsp;291&nbsp;bytes</span>
<br><span class="f_CodeExample">Saving&nbsp;httpbin.org/headers</span>
<br><span class="f_CodeExample">FileSave(filename,result)=true&nbsp;/&nbsp;ok</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">httpbin.org/headers</span><span class="f_Text"> file contains the headers of our request as seen by the server (the server added the JSON formatting itself when answering us).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;headers&quot;:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Accept&quot;:&nbsp;&quot;*/*&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Accept-Encoding&quot;:&nbsp;&quot;gzip,&nbsp;deflate&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Accept-Language&quot;:&nbsp;&quot;ru,en&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Host&quot;:&nbsp;&quot;httpbin.org&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;User-Agent&quot;:&nbsp;&quot;MetaTrader&nbsp;5&nbsp;Terminal/5.3333&nbsp;(Windows&nbsp;NT&nbsp;10.0;&nbsp;Win64;&nbsp;x64)&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;X-Amzn-Trace-Id&quot;:&nbsp;&quot;Root=1-62da638f-2554...&quot;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;&lt;-&nbsp;this&nbsp;is&nbsp;added&nbsp;by&nbsp;the&nbsp;reverse&nbsp;proxy&nbsp;server</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Thus, the terminal reports that it is ready to accept data of any type, with support for compression by specific methods and a list of preferred languages. In addition, it appears in the User-Agent field as MetaTrader 5. The latter may be undesirable when working with some sites that are optimized to work exclusively with browsers. Then we can specify a fictitious name in the </span><span class="f_Text" style="font-style: italic;">headers</span><span class="f_Text"> input parameter, for example, &quot;User-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36&quot;.</span></p>
<p class="p_Quote"><span class="f_Quote">Some of the test sites listed above allow you to organize a temporary test environment on the server with a random name for your personal experiment: to do this, you need to go to the site from a browser and get a unique link that usually works for 24 hours. Then you will be able to use this link as an address for requests from MQL5 and monitor the behavior of requests directly from the browser. There you can also configure server responses, in particular, attempt submitting forms.</span></p>
<p class="p_Text"><span class="f_Text">Let's make this example slightly more difficult. The server may require additional actions from the client to fulfill the request, in particular, authorize, perform a &quot;redirect&quot; (go to a different address), reduce the frequency of requests, etc. All such &quot;signals&quot; are denoted by special HTTP codes returned by the </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> function. For example, codes 301 and 302 mean redirect for different reasons, and </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> executes it internally automatically, re-requesting the page at the address specified by the server (therefore, redirect codes never end up in the MQL program code). The 401 code requires the client to provide a username and password, and here the entire responsibility lies with us. There are many ways to send this data. A new script </span><span class="f_Text" style="font-style: italic;">WebRequestAuth.mq5</span><span class="f_Text"> demonstrates the handling of two authorization options that the server requests using HTTP response headers: &quot;WWW-Authenticate: Basic&quot; or &quot;WWW-Authenticate: Digest&quot;. In headers it might look like this:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">WWW-Authenticate:Basic&nbsp;realm=&quot;DemoBasicAuth&quot;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Or like this:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">WWW-Authenticate:Digest&nbsp;realm=&quot;DemoDigestAuth&quot;,qop=&quot;auth&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #808080;">&raquo;</span><br>
<span class="f_CodeExample" style="color: #808080;">&raquo;</span><span class="f_CodeExample">&nbsp;&nbsp;nonce=&quot;cuFAuHbb5UDvtFGkZEb2mNxjqEG/DjDr&quot;,opaque=&quot;fyNjGC4x8Zgt830PpzbXRvoqExsZeQSDZj&quot;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The first of them is the simplest and most unsafe, and therefore is practically not used: it is given in the book because of how easy it is to learn it at the first stage. The bottom line of its work is to generate the following HTTP request in response to a server request by adding a special header:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Authorization:&nbsp;Basic&nbsp;dXNlcjpwYXNzd29yZA==</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here, the &quot;Basic&quot; keyword is followed by the Base64-encoded string &quot;user:password&quot; with the actual username and password, and the ':' character is inserted hereinafter &quot;as is&quot; as a linking block. More clearly, the interaction process is shown in the image.</span></p>
<p class="p_ImageCaption"><img class="help" alt="Simple authorization scheme on a web server" title="Simple authorization scheme on a web server" width="600" height="400" style="margin:0 auto 0 auto;width:600px;height:400px;border:none" src="web_basic_auth.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">Simple authorization scheme on a web server</span></p>
<p class="p_Text"><span class="f_Text">The authorization scheme </span><span class="f_Text" style="font-style: italic;">Digest</span><span class="f_Text"> is considered more advanced. In this case, the server provides some additional information in its response:</span></p>
<ul>
<li class="p_li"><span class="f_li" style="font-style: italic;">realms</span><span class="f_li"> – the name of the site (site area) where the entry is made</span></li>
<li class="p_li"><span class="f_li" style="font-style: italic;">qop</span><span class="f_li"> – a variation of the Digest method (we will only consider &quot;auth&quot;)</span></li>
<li class="p_li"><span class="f_li" style="font-style: italic;">nonce</span><span class="f_li"> – a random string that will be used to generate authorization data</span></li>
<li class="p_li"><span class="f_li" style="font-style: italic;">opaque</span><span class="f_li"> – a random string that we will pass back &quot;as is&quot; in our headers</span></li>
<li class="p_li"><span class="f_li" style="font-style: italic;">algorithm</span><span class="f_li"> – an optional name of the hashing algorithm, MD5 is assumed by default</span></li>
</ul>
<p class="p_Text"><span class="f_Text">For authorization, you need to perform the following steps:</span></p>
<ol style="list-style-type:decimal">
<li value="1" class="p_li"><span class="f_li">Generate your own random string </span><span class="f_li" style="font-style: italic;">cnonce</span></li>
<li value="2" class="p_li"><span class="f_li">Initialize or increment your request counter </span><span class="f_li" style="font-style: italic;">nc</span></li>
<li value="3" class="p_li"><span class="f_li">Calculate </span><span class="f_li" style="font-style: italic;">hash1 = MD5(user:realm:password)</span></li>
<li value="4" class="p_li"><span class="f_li">Calculate </span><span class="f_li" style="font-style: italic;">hash2 = MD5(method:uri)</span><span class="f_li">, here </span><span class="f_li" style="font-style: italic;">uri</span><span class="f_li"> is the path and name of the page</span></li>
<li value="5" class="p_li"><span class="f_li">Calculate </span><span class="f_li" style="font-style: italic;">response = MD5(hash1:nonce:nc:cnonce:qop:hash2)</span></li>
</ol>
<p class="p_Text"><span class="f_Text">After that, the client can repeat the request to the server, adding a line like this to its headers:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Authorization:&nbsp;Digest&nbsp;username=&quot;user&quot;,realm=&quot;realm&quot;,nonce=&quot;...&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #808080;">&raquo;</span><br>
<span class="f_CodeExample" style="color: #808080;">&raquo;</span><span class="f_CodeExample">&nbsp;&nbsp;uri=&quot;/path/to/page&quot;,qop=auth,nc=00000001,cnonce=&quot;...&quot;,response=&quot;...&quot;,opaque=&quot;...&quot;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Since the server has the same information as the client, it will be able to repeat the calculations and check the hashes match.</span></p>
<p class="p_Text"><span class="f_Text">Let's add variables to the script parameters to enter the username and password. By default, the </span><span class="f_Text" style="font-style: italic;">Address</span><span class="f_Text"> parameter includes the address of the </span><span class="f_Text" style="font-style: italic;">digest-auth</span><span class="f_Text"> endpoint, which can request authorization with parameters </span><span class="f_Text" style="font-style: italic;">qop</span><span class="f_Text"> (&quot;auth&quot;), login (&quot;test&quot;), and password (&quot;pass&quot;). This is all optional in the endpoint path (you can test other methods and user credentials, like so: &quot;https://httpbin.org/digest-auth/auth-int/mql5client/mql5password&quot;).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Method</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;GET&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;https://httpbin.org/digest-auth/auth/test/pass&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;User-Agent:&nbsp;noname&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Timeout</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">5000</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">User</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;test&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Password</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;pass&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">DumpDataToFiles</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">We specified a dummy browser name in the </span><span class="f_Text" style="font-style: italic;">Headers</span><span class="f_Text"> parameter to demonstrate the feature.</span></p>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> function, we add the processing of HTTP code 401. If a username and password are not provided, we will not be able to continue.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">URL</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">parse</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">WebRequest</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Method</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Timeout</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">401</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">User</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">&nbsp;||&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Password</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Credentials&nbsp;required&quot;</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The next step is to analyze the headers received from the server. For convenience, we have written the </span><span class="f_Text" style="font-style: italic;">HttpHeader</span><span class="f_Text"> class (</span><span class="f_Text" style="font-style: italic;">HttpHeader.mqh</span><span class="f_Text">). The full text is passed to its constructor, as well as the element separator (in this case, the newline character '\n') and the character used between the name and value within each element (in this case, the colon ':'). During its creation, the object &quot;parses&quot; the text, and then the elements are made available through the overloaded operator [], with the type of its argument being a string. As a result, we can check for an authorization requirement by the name &quot;WWW-Authenticate&quot;. If such an element exists in the text and is equal to &quot;Basic&quot;, we form the response header &quot;Authorization: Basic&quot; with the login and password encoded in Base64.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;=&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">header</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">,&nbsp;'\</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">',&nbsp;':');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">auth</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">header</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #008080;">&quot;WWW-Authenticate&quot;</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringFind</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">auth</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Basic&nbsp;&quot;</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\r\n&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Authorization:&nbsp;Basic&nbsp;&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">hash</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">User</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Password</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">CRYPT_BASE64</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">WebRequest</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Method</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Timeout</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">For Digest authorization, everything is a little more complicated, following the algorithm outlined above.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringFind</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">auth</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Digest&nbsp;&quot;</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">params</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringSubstr</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">auth</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">7</span><span class="f_CodeExample">),&nbsp;',',&nbsp;'=');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">realm</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">unquote</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">params</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #008080;">&quot;realm&quot;</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">realm</span><span class="f_CodeExample">&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">qop</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">unquote</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">params</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #008080;">&quot;qop&quot;</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">qop</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;auth&quot;</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h1</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">hash</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">User</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">realm</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Password</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h2</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">hash</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Method</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">URL_PATH</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">nonce</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">unquote</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">params</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #008080;">&quot;nonce&quot;</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">counter</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">StringFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;%08x&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">cnonce</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">StringFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;%08x&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">MathRand</span><span class="f_CodeExample">());</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h3</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpHeader</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">hash</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h1</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">nonce</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">counter</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">cnonce</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">qop</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h2</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\r\n&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Authorization:&nbsp;Digest&nbsp;&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;username=\&quot;&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;User&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;realm=\&quot;&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;realm&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;nonce=\&quot;&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;nonce&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;uri=\&quot;&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;parts[URL_PATH]&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;qop=&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">qop</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;nc=&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">counter</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;cnonce=\&quot;&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;cnonce&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;response=\&quot;&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;h3&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\&quot;,&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">&nbsp;+=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;opaque=&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">params</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #008080;">&quot;opaque&quot;</span><span class="f_CodeExample">]&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Header</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">WebRequest</span><span class="f_CodeExample">(</span><span class="f_CodeExampleCondensed">Method,&nbsp;Address,&nbsp;Header,&nbsp;Timeout,&nbsp;data,&nbsp;result,&nbsp;response</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Static method </span><span class="f_Text" style="font-style: italic;">HttpHeader::hash</span><span class="f_Text"> gets a string with a hexadecimal hash representation (default MD5) for all required compound strings. Based on this data, the header is formed for the next </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> call. The static </span><span class="f_Text" style="font-style: italic;">HttpHeader::unquote</span><span class="f_Text"> method removes the enclosing quotes.</span></p>
<p class="p_Text"><span class="f_Text">The rest of the script remained unchanged. A repeated HTTP request may succeed, and then we will get the content of the secure page, or authorization will be denied, and the server will write something like &quot;Access denied&quot;.</span></p>
<p class="p_Text"><span class="f_Text">Since the default parameters contain the correct values (&quot;/digest-auth/auth/test/pass&quot; corresponds to the user &quot;test&quot; and the password &quot;pass&quot;), we should get the following result of running the script (all main steps and data are logged).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">WebRequest(Method,Address,Headers,Timeout,data,result,response)=401&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">Date:&nbsp;Fri,&nbsp;22&nbsp;Jul&nbsp;2022&nbsp;10:45:56&nbsp;GMT</span>
<br><span class="f_CodeExample">Content-Type:&nbsp;text/html;&nbsp;charset=utf-8</span>
<br><span class="f_CodeExample">Content-Length:&nbsp;0</span>
<br><span class="f_CodeExample">Connection:&nbsp;keep-alive</span>
<br><span class="f_CodeExample">Server:&nbsp;gunicorn/19.9.0</span>
<br><span class="f_CodeExample">WWW-Authenticate:&nbsp;Digest&nbsp;<a href="mailto:realm="me@kennethreitz.com"" target="_blank" class="weblink">realm=&quot;me@kennethreitz.com&quot;</a>&nbsp;</span><span class="f_CodeExample" style="color: #808080;">&raquo;</span><br>
<span class="f_CodeExample" style="color: #808080;">&raquo;</span><span class="f_CodeExample">&nbsp;&nbsp;nonce=&quot;87d28b529a7a8797f6c3b81845400370&quot;,&nbsp;qop=&quot;auth&quot;,</span><br>
<span class="f_CodeExample" style="color: #808080;">&raquo;</span><span class="f_CodeExample">&nbsp;&nbsp;opaque=&quot;4cb97ad7ea915a6d24cf1ccbf6feeaba&quot;,&nbsp;algorithm=MD5,&nbsp;stale=FALSE</span>
<br><span class="f_CodeExample">...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The first </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> call has ended with code 401, and among the response headers is an authorization request (&quot;WWW-Authenticate&quot;) with the required parameters. Based on them, we calculated the correct answer and prepared headers for a new request.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Header=User-Agent:&nbsp;noname</span>
<br><span class="f_CodeExample">Authorization:&nbsp;Digest&nbsp;<a href="mailto:username="test",realm="me@kennethreitz.com"" target="_blank" class="weblink">username=&quot;test&quot;,realm=&quot;me@kennethreitz.com&quot;</a>&nbsp;</span><span class="f_CodeExample" style="color: #808080;">&raquo;</span><br>
<span class="f_CodeExample" style="color: #808080;">&raquo;</span><span class="f_CodeExample">&nbsp;&nbsp;nonce=&quot;87d28b529a7a8797f6c3b81845400370&quot;,uri=&quot;/digest-auth/auth/test/pass&quot;,</span><br>
<span class="f_CodeExample" style="color: #808080;">&raquo;</span><span class="f_CodeExample">&nbsp;&nbsp;qop=auth,nc=00000001,cnonce=&quot;00001c74&quot;,</span><br>
<span class="f_CodeExample" style="color: #808080;">&raquo;</span><span class="f_CodeExample">&nbsp;&nbsp;response=&quot;c09e52bca9cc90caf9a707d046b567b2&quot;,opaque=&quot;4cb97ad7ea915a6d24cf1ccbf6feeaba&quot;&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The second request returns 200 and a payload that we write to the file.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">WebRequest(Method,Address,Header,Timeout,data,result,response)=200&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">Date:&nbsp;Fri,&nbsp;22&nbsp;Jul&nbsp;2022&nbsp;10:45:56&nbsp;GMT</span>
<br><span class="f_CodeExample">Content-Type:&nbsp;application/json</span>
<br><span class="f_CodeExample">Content-Length:&nbsp;47</span>
<br><span class="f_CodeExample">Connection:&nbsp;keep-alive</span>
<br><span class="f_CodeExample">Server:&nbsp;gunicorn/19.9.0</span>
<br><span class="f_CodeExample">...</span>
<br><span class="f_CodeExample">Got&nbsp;data:&nbsp;47&nbsp;bytes</span>
<br><span class="f_CodeExample">Saving&nbsp;httpbin.org/digest-auth/auth/test/pass</span>
<br><span class="f_CodeExample">FileSave(filename,result)=true&nbsp;/&nbsp;ok</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Inside the file </span><span class="f_Text" style="font-style: italic;">MQL5/Files/httpbin.org/digest-auth/auth/test/pass</span><span class="f_Text"> you can find the &quot;web page&quot;, or rather the status of successful authorization in JSON format.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;authenticated&quot;:&nbsp;true,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;user&quot;:&nbsp;&quot;test&quot;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">If you specify an incorrect password when running the script, we will receive an empty response from the server, and the file will not be written.</span></p>
<p class="p_Quote"><span class="f_Quote">Using </span><span class="f_Quote" style="font-style: italic;">WebRequest</span><span class="f_Quote">, we automatically enter the field of distributed software systems, in which the correct operation depends not only on our client MQL code but also on the server (not to mention intermediate links, like a proxy). Therefore, you need to be prepared for the occurrence of other people's mistakes. In particular, at the time of writing the book in the implementation of the </span><span class="f_Quote" style="font-style: italic;">digest-auth</span><span class="f_Quote"> endpoint on </span><span class="f_Quote" style="font-style: italic;">httpbin.org</span><span class="f_Quote"> there was a problem: the username entered in the request did not participate in the authorization check, and therefore any login leads to successful authorization if the correct password is specified. Still, to check our script, use other services, for example, something like </span><span class="f_Quote" style="font-style: italic;">httpbingo.org/digest-auth/auth/test/pass</span><span class="f_Quote">. You can also configure the script to the address </span><span class="f_Quote" style="font-style: italic;">jigsaw.w3.org/HTTP/Digest/</span><span class="f_Quote"> – it expects login/password &quot;guest&quot;/&quot;guest&quot;.</span></p>
<p class="p_Text"><span class="f_Text">In practice, most sites implement authorization using forms embedded directly in web pages: inside the HTML code, they are essentially the </span><span class="f_Text" style="font-style: italic;">form</span><span class="f_Text"> container tag with a set of input fields, which are filled in by the user and sent to the server using the POST method. In this regard, it makes sense to analyze the example of submitting a form. However, before getting into this in detail, it is desirable to highlight one more technique.</span></p>
<p class="p_Text"><span class="f_Text">The thing is that the interaction between the client and the server is usually accompanied by a change in the state of both the client and the server. Using the example of authorization, this can be understood most clearly, since before authorization the user was unknown to the system, and after that, the system already knows the login and can apply the preferred settings for the site (for example, language, color, forum display method), and also allow access to those pages where unauthorized visitors cannot get into (the server stops such attempts by returning HTTP status 403, Forbidden).</span></p>
<p class="p_Text"><span class="f_Text">Support and synchronization of the consistent state of the client and server parts of a distributed web application is provided using the cookies mechanism which implies named variables and their values in HTTP headers. The term goes back to &quot;fortune cookies&quot; because </span><span class="f_Text" style="font-style: italic;">cookies</span><span class="f_Text"> also contain small messages invisible to the user.</span></p>
<p class="p_Text"><span class="f_Text">Either side, server and client, can add </span><span class="f_Text" style="font-style: italic;">cookie</span><span class="f_Text"> to the HTTP header. The server does this with a line like:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">Set</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">Cookie</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #333333;">value</span><span class="f_CodeExample">;&nbsp;&#8992;</span><span class="f_CodeExample" style="color: #333333;">Domain</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #333333;">domain</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Path</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #333333;">path</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Expires</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #333333;">date</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Max</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">Age</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #333333;">number_of_seconds</span><span class="f_CodeExample">&nbsp;...&#8993;&#7506;&#7510;&#7511;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Only the name and value are required and the rest of the attributes are optional: here are the main ones &#8722; </span><span class="f_Text" style="font-style: italic;">Domain</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Path</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Expires</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">Max age</span><span class="f_Text">, but in real situations, there are more of them.</span></p>
<p class="p_Text"><span class="f_Text">Having received such a header (or several headers), the client must remember the name and value of the variable and send them to the server in all requests that address to the corresponding </span><span class="f_Text" style="font-style: italic;">Domain</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">Path</span><span class="f_Text"> inside this domain until the expiration date (</span><span class="f_Text" style="font-style: italic;">Expires</span><span class="f_Text"> or </span><span class="f_Text" style="font-style: italic;">Max-Age</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">In an outgoing HTTP request from a client, </span><span class="f_Text" style="font-style: italic;">cookie</span><span class="f_Text">s are passed as a string:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">Cookie</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">&#8317;&#8470;&#8318;=</span><span class="f_CodeExample" style="color: #333333;">value</span><span class="f_CodeExample">&#8317;&#8470;&#8318;&nbsp;&#8992;;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">&#8317;&#8305;&#8318;=</span><span class="f_CodeExample" style="color: #333333;">value</span><span class="f_CodeExample">&#8317;&#8305;&#8318;&nbsp;...&#8993;&#7506;&#7510;&#7511;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here, separated by a semicolon and a space, all name=value pairs are listed; they are set by the server and known to this client, matched with the current request by the domain and path, and not expired.</span></p>
<p class="p_Text"><span class="f_Text">The server and client exchange all the necessary cookies with each HTTP request, which is why this architectural style of distributed systems is called REST (</span><span class="f_Text" style="font-style: italic;">Representational State Transfer</span><span class="f_Text">). For example, after a user successfully logs in to the server, the latter sets (via the &quot;Set-Cookie:&quot; header) a special &quot;cookie&quot; with the user's identifier, after which the web browser (or, in our case, a terminal with an MQL program) will send it in subsequent requests (by adding the appropriate line to the &quot;Cookie:&quot; header).</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> function silently does all this work for us: collects cookies from incoming headers and adds appropriate cookies to outgoing HTTP requests.</span></p>
<p class="p_Text"><span class="f_Text">Cookies are stored by the terminal and between sessions, according to their settings. To check this, it is enough to request a web page twice from a site using cookies.</span></p>
<p class="p_Quote"><span class="f_Quote">Attention, cookies are stored in relation to the site and therefore are imperceptibly substituted in the outgoing headers of all MQL programs that use </span><span class="f_Quote" style="font-style: italic;">WebRequest</span><span class="f_Quote"> for the same site.</span></p>
<p class="p_Text"><span class="f_Text">To simplify sequential requests, it makes sense to formalize popular actions in a special class </span><span class="f_Text" style="font-style: italic;">HTTPRequest</span><span class="f_Text"> (</span><span class="f_Text" style="font-style: italic;">HTTPRequest.mqh</span><span class="f_Text">). We will store common HTTP headers in it, which are likely to be needed for all requests (for example, supported languages, instructions for proxies, etc.). In addition, such a setting as timeout is also common. Both settings are passed to the object's constructor.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HTTPRequest</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HttpCookie</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">common_headers</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">timeout</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HTTPRequest</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">5000</span><span class="f_CodeExample">):</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">common_headers</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h</span><span class="f_CodeExample">),&nbsp;</span><span class="f_CodeExample" style="color: #333333;">timeout</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">)&nbsp;{&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">By default, the timeout is set to 5 seconds. The main, in a sense, universal method of the class is </span><span class="f_Text" style="font-style: italic;">request</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">request</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">method</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">headers</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">headers</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #333333;">headers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">common_headers</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;&gt;&gt;&gt;&nbsp;Request:\n&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">method</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\n&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">headers</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">WebRequest</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">method</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">headers</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">timeout</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;&lt;&lt;&lt;&nbsp;Response:\n&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">code</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Let's describe a couple more methods for queries of specific types.</span></p>
<p class="p_Text"><span class="f_Text">GET requests use only headers and the body of the document (the term </span><span class="f_Text" style="font-style: italic;">payload</span><span class="f_Text"> is often used) is empty.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">GET</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">custom_headers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">nodata</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">request</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;GET&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">custom_headers</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">nodata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In POST requests, there is usually a payload.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">POST</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">payload</span><span class="f_CodeExample">[],</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">custom_headers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">request</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;POST&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">custom_headers</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">payload</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Forms can be sent in different formats. The simplest one is &quot;application/x-www-form-urlencoded&quot;. It implies that the payload will be a string (maybe a very long one, since the specifications do not impose restrictions, and it all depends on the settings of the web servers). For such forms, we will provide a more convenient overload of the POST method with the payload string parameter.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">POST</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">payload</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">custom_headers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bytes</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">StringToCharArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">payload</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bytes</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">CP_UTF8</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">bytes</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">);&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;remove&nbsp;terminal&nbsp;zero</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">request</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;POST&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">custom_headers</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bytes</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Let's write a simple script to test our client web engine </span><span class="f_Text" style="font-style: italic;">WebRequestCookie.mq5</span><span class="f_Text">. Its task will be to request the same web page twice: the first time the server will most likely offer to set its cookies, and then they will be automatically substituted in the second request. In the input parameters, specify the address of the page for the test: let it be the </span><span class="f_Text" style="font-style: italic;">mql5.com</span><span class="f_Text"> website. We will also simulate the default headers by the corrected &quot;User-Agent&quot; string.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;https://www.mql5.com&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;User-Agent:&nbsp;Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;10.0)&nbsp;Chrome/103.0.0.0&quot;</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;Headers&nbsp;(use&nbsp;'|'&nbsp;as&nbsp;separator,&nbsp;if&nbsp;many&nbsp;specified)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the main function of the script, we describe the </span><span class="f_Text" style="font-style: italic;">HTTPRequest</span><span class="f_Text"> object and execute two GET requests in a loop.</span></p>
<p class="p_Quote"><span class="f_Quote">Attention! This test works under the assumption that MQL programs have not yet visited the www.mql5.com site and have not received cookies from it. After running the script once, the cookies will remain in the terminal cache, and it will become impossible to reproduce the example: on both iterations of the loop, we will get the same log entries. </span><br>
<span class="f_Quote">&nbsp;</span><br>
<span class="f_Quote">Don't forget to add the &quot;www.mql5.com&quot; domain to the allowed list in the terminal settings.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HTTPRequest</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">http</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Headers</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">;&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">http</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">GET</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Got&nbsp;data:&nbsp;%d&nbsp;bytes&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;show&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;document&nbsp;only&nbsp;the&nbsp;first&nbsp;time</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">CharArrayToString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">160</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">CP_UTF8</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">&nbsp;=&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">k</span><span class="f_CodeExample">&nbsp;=&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">while</span><span class="f_CodeExample">((</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">StringFind</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\r\n&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">))&nbsp;!=&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #333333;">k</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringSubstr</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">k</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The first iteration of the loop will generate the following log entries (with abbreviations):</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&gt;&gt;&gt;&nbsp;Request:</span>
<br><span class="f_CodeExample">GET&nbsp;https://www.mql5.com</span>
<br><span class="f_CodeExample">User-Agent:&nbsp;Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;10.0)&nbsp;Chrome/103.0.0.0</span>
<br><span class="f_CodeExample">WebRequest(method,address,headers,timeout,data,result,response)=200&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&lt;&lt;&lt;&nbsp;Response:</span>
<br><span class="f_CodeExample">Server:&nbsp;nginx</span>
<br><span class="f_CodeExample">Date:&nbsp;Sun,&nbsp;24&nbsp;Jul&nbsp;2022&nbsp;19:04:35&nbsp;GMT</span>
<br><span class="f_CodeExample">Content-Type:&nbsp;text/html;&nbsp;charset=utf-8</span>
<br><span class="f_CodeExample">Transfer-Encoding:&nbsp;chunked</span>
<br><span class="f_CodeExample">Connection:&nbsp;keep-alive</span>
<br><span class="f_CodeExample">Cache-Control:&nbsp;no-cache,no-store</span>
<br><span class="f_CodeExample">Content-Encoding:&nbsp;gzip</span>
<br><span class="f_CodeExample">Expires:&nbsp;-1</span>
<br><span class="f_CodeExample">Pragma:&nbsp;no-cache</span>
<br><span class="f_CodeExample" style="font-weight: bold;">Set-Cookie:&nbsp;sid=CfDJ8O2AwC...Ne2yP5QXpPKA2;&nbsp;domain=.mql5.com;&nbsp;path=/;&nbsp;samesite=lax;&nbsp;httponly</span>
<br><span class="f_CodeExample">Vary:&nbsp;Accept-Encoding</span>
<br><span class="f_CodeExample">Strict-Transport-Security:&nbsp;max-age=31536000;&nbsp;includeSubDomains;&nbsp;preload</span>
<br><span class="f_CodeExample">Content-Security-Policy:&nbsp;default-src&nbsp;'self';&nbsp;script-src&nbsp;'self'&nbsp;...&nbsp;</span>
<br><span class="f_CodeExample">Generate-Time:&nbsp;2823</span>
<br><span class="f_CodeExample">Agent-Type:&nbsp;desktop-ru-en</span>
<br><span class="f_CodeExample">X-Cache-Status:&nbsp;MISS</span>
<br><span class="f_CodeExample">Got&nbsp;data:&nbsp;184396&nbsp;bytes</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&lt;!DOCTYPE&nbsp;html&gt;</span>
<br><span class="f_CodeExample">&lt;html&nbsp;lang=&quot;ru&quot;&gt;</span>
<br><span class="f_CodeExample">&lt;head&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;X-UA-Compatible&quot;&nbsp;content=&quot;IE=edge&quot;&nbsp;/&gt;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">We received one new cookie with the name </span><span class="f_Text" style="font-style: italic;">sid</span><span class="f_Text">. To verify its effectiveness, you change to viewing the second part of the log, for the second iteration of the loop.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&gt;&gt;&gt;&nbsp;Request:</span>
<br><span class="f_CodeExample">GET&nbsp;https://www.mql5.com</span>
<br><span class="f_CodeExample">User-Agent:&nbsp;Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;10.0)&nbsp;Chrome/103.0.0.0</span>
<br><span class="f_CodeExample">WebRequest(method,address,headers,timeout,data,result,response)=200&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&lt;&lt;&lt;&nbsp;Response:</span>
<br><span class="f_CodeExample">Server:&nbsp;nginx</span>
<br><span class="f_CodeExample">Date:&nbsp;Sun,&nbsp;24&nbsp;Jul&nbsp;2022&nbsp;19:04:36&nbsp;GMT</span>
<br><span class="f_CodeExample">Content-Type:&nbsp;text/html;&nbsp;charset=utf-8</span>
<br><span class="f_CodeExample">Transfer-Encoding:&nbsp;chunked</span>
<br><span class="f_CodeExample">Connection:&nbsp;keep-alive</span>
<br><span class="f_CodeExample">Cache-Control:&nbsp;no-cache,&nbsp;no-store,&nbsp;must-revalidate,&nbsp;no-transform</span>
<br><span class="f_CodeExample">Content-Encoding:&nbsp;gzip</span>
<br><span class="f_CodeExample">Expires:&nbsp;-1</span>
<br><span class="f_CodeExample">Pragma:&nbsp;no-cache</span>
<br><span class="f_CodeExample">Vary:&nbsp;Accept-Encoding</span>
<br><span class="f_CodeExample">Strict-Transport-Security:&nbsp;max-age=31536000;&nbsp;includeSubDomains;&nbsp;preload</span>
<br><span class="f_CodeExample">Content-Security-Policy:&nbsp;default-src&nbsp;'self';&nbsp;script-src&nbsp;'self'&nbsp;...&nbsp;</span>
<br><span class="f_CodeExample">Generate-Time:&nbsp;2950</span>
<br><span class="f_CodeExample">Agent-Type:&nbsp;desktop-ru-en</span>
<br><span class="f_CodeExample">X-Cache-Status:&nbsp;MISS</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Unfortunately, here we do not see the full outgoing headers formed inside </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text">, but the instance of the cookie being sent to the server using the &quot;Cookie:&quot; header is proven by the fact that the server in its second response no longer asks to set it.</span></p>
<p class="p_Text"><span class="f_Text">In theory, this cookie simply identifies the visitor (as most sites do) but does not signify their authorization. Therefore, let's return to the exercise of submitting the form in a general way, meaning in the future the private task of entering a login and password.</span></p>
<p class="p_Text"><span class="f_Text">Recall that to submit the form, we can use the POST method with a string parameter </span><span class="f_Text" style="font-style: italic;">payload</span><span class="f_Text">. The principle of preparing data according to the &quot;x-www-form-urlencoded&quot; standard is that named variables and their values are written in one continuous line (somewhat similar to cookies).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">&#8317;&#8470;&#8318;=</span><span class="f_CodeExample" style="color: #333333;">value</span><span class="f_CodeExample">&#8317;&#8470;&#8318;[&amp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">&#8317;&#8305;&#8318;=</span><span class="f_CodeExample" style="color: #333333;">value</span><span class="f_CodeExample">&#8317;&#8305;&#8318;...]&#7506;&#7510;&#7511;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The name and value are connected with the sign '=', and the pairs are joined using the ampersand character '&amp;'. The value may be missing. For example,</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Name=John&amp;Age=33&amp;Education=&amp;Address=</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">It is important to note that from a technical point of view, this string must be converted according to the algorithm before sending </span><span class="f_Text" style="font-style: italic;">urlencode</span><span class="f_Text"> (this is where the name of the format comes from), however, </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> does this transformation for us. &nbsp;</span></p>
<p class="p_Text"><span class="f_Text">The variable names are determined by the web form (the contents of the tag </span><span class="f_Text" style="font-style: italic;">form</span><span class="f_Text"> in a web page) or web application logic - in any case, the web server must be able to interpret the names and values. Therefore, to get acquainted with the technology, we need a test server with a form.</span></p>
<p class="p_Text"><span class="f_Text">The test form is available at </span><span class="f_Text" style="font-style: italic;">https://httpbin.org/forms/post</span><span class="f_Text">. It is a dialog for ordering pizza.</span></p>
<p class="p_ImageCaption"><img class="help" alt="Test web form" title="Test web form" width="600" height="480" style="margin:0 auto 0 auto;width:600px;height:480px;border:none" src="webform.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">Test web form</span></p>
<p class="p_Text"><span class="f_Text">Its internal structure and behavior are described by the following HTML code. In it, we are primarily interested in </span><span class="f_Text" style="font-style: italic;">input</span><span class="f_Text"> tags, which set the variables expected by the server. In addition, attention should be paid to the </span><span class="f_Text" style="font-style: italic;">action</span><span class="f_Text"> attribute in the </span><span class="f_Text" style="font-style: italic;">form</span><span class="f_Text"> tag, since it defines the address to which the POST request should be sent, and in this case, it is &quot;/post&quot;, which together with the domain gives the string &quot;httpbin.org/post&quot;. This is what we will use in the MQL program.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&lt;!DOCTYPE&nbsp;html&gt;</span>
<br><span class="f_CodeExample">&lt;html&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&lt;body&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&lt;form&nbsp;method=&quot;post&quot;&nbsp;action=&quot;/post&quot;&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;Customer&nbsp;name:&nbsp;&lt;input&nbsp;name=&quot;custname&quot;&gt;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;Telephone:&nbsp;&lt;input&nbsp;type=tel&nbsp;name=&quot;custtel&quot;&gt;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;E-mail&nbsp;address:&nbsp;&lt;input&nbsp;type=email&nbsp;name=&quot;custemail&quot;&gt;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;legend&gt;&nbsp;Pizza&nbsp;Size&nbsp;&lt;/legend&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;&nbsp;&lt;input&nbsp;type=radio&nbsp;name=size&nbsp;value=&quot;small&quot;&gt;&nbsp;Small&nbsp;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;&nbsp;&lt;input&nbsp;type=radio&nbsp;name=size&nbsp;value=&quot;medium&quot;&gt;&nbsp;Medium&nbsp;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;&nbsp;&lt;input&nbsp;type=radio&nbsp;name=size&nbsp;value=&quot;large&quot;&gt;&nbsp;Large&nbsp;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/fieldset&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;legend&gt;&nbsp;Pizza&nbsp;Toppings&nbsp;&lt;/legend&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;&nbsp;&lt;input&nbsp;type=checkbox&nbsp;name=&quot;topping&quot;&nbsp;value=&quot;bacon&quot;&gt;&nbsp;Bacon&nbsp;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;&nbsp;&lt;input&nbsp;type=checkbox&nbsp;name=&quot;topping&quot;&nbsp;value=&quot;cheese&quot;&gt;&nbsp;Extra&nbsp;Cheese&nbsp;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;&nbsp;&lt;input&nbsp;type=checkbox&nbsp;name=&quot;topping&quot;&nbsp;value=&quot;onion&quot;&gt;&nbsp;Onion&nbsp;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;&nbsp;&lt;input&nbsp;type=checkbox&nbsp;name=&quot;topping&quot;&nbsp;value=&quot;mushroom&quot;&gt;&nbsp;Mushroom&nbsp;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/fieldset&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;Preferred&nbsp;delivery&nbsp;time:&nbsp;&lt;input&nbsp;type=time&nbsp;min=&quot;11:00&quot;&nbsp;max=&quot;21:00&quot;&nbsp;step=&quot;900&quot;&nbsp;name=&quot;delivery&quot;&gt;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;label&gt;Delivery&nbsp;instructions:&nbsp;&lt;textarea&nbsp;name=&quot;comments&quot;&gt;&lt;/textarea&gt;&lt;/label&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;button&gt;Submit&nbsp;order&lt;/button&gt;&lt;/p&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&lt;/form&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&lt;/body&gt;</span>
<br><span class="f_CodeExample">&lt;/html&gt;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">WebRequestForm.mq5</span><span class="f_Text"> script, we have prepared similar input variables to be specified by the user before being sent to the server.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;https://httpbin.org/post&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Customer</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;custname=Vincent&nbsp;Silver&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Telephone</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;custtel=123-123-123&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Email</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;custemail=email@address.org&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PizzaSize</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;size=small&quot;</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;PizzaSize&nbsp;(small,medium,large)</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PizzaTopping</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;topping=bacon&quot;</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;PizzaTopping&nbsp;(bacon,cheese,onion,mushroom)</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">DeliveryTime</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;delivery=&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Comments</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;comments=&quot;</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The already set strings are shown only for one-click testing: you can replace them with your own, but note that inside each string only the value to the right of '=' should be edited, and the name to the left of '=' should be kept (unknown names will be ignored by the server) .</span></p>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> function, we describe the HTTP header &quot;Content-Type:&quot; and prepare a concatenated string with all variables.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uchar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">header</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Content-Type:&nbsp;application/x-www-form-urlencoded&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">form_fields</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">StringConcatenate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">form_fields</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Customer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&amp;&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Telephone</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&amp;&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Email</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&amp;&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PizzaSize</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&amp;&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PizzaTopping</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&amp;&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">DeliveryTime</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&amp;&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Comments</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HTTPRequest</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">http</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">http</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">POST</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Address</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">form_fields</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">response</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Got&nbsp;data:&nbsp;%d&nbsp;bytes&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;NB:&nbsp;UTF-8&nbsp;is&nbsp;implied&nbsp;for&nbsp;many&nbsp;content-types,</span>
<br><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;but&nbsp;some&nbsp;may&nbsp;be&nbsp;different,&nbsp;analyze&nbsp;the&nbsp;response&nbsp;headers</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">CharArrayToString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">WHOLE_ARRAY</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">CP_UTF8</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Then we execute the POST method and log the server response. Here is an example result.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&gt;&gt;&gt;&nbsp;Request:</span>
<br><span class="f_CodeExample">POST&nbsp;https://httpbin.org/post</span>
<br><span class="f_CodeExample">Content-Type:&nbsp;application/x-www-form-urlencoded</span>
<br><span class="f_CodeExample">WebRequest(method,address,headers,timeout,data,result,response)=200&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&lt;&lt;&lt;&nbsp;Response:</span>
<br><span class="f_CodeExample">Date:&nbsp;Mon,&nbsp;25&nbsp;Jul&nbsp;2022&nbsp;08:41:41&nbsp;GMT</span>
<br><span class="f_CodeExample">Content-Type:&nbsp;application/json</span>
<br><span class="f_CodeExample">Content-Length:&nbsp;780</span>
<br><span class="f_CodeExample">Connection:&nbsp;keep-alive</span>
<br><span class="f_CodeExample">Server:&nbsp;gunicorn/19.9.0</span>
<br><span class="f_CodeExample">Access-Control-Allow-Origin:&nbsp;*</span>
<br><span class="f_CodeExample">Access-Control-Allow-Credentials:&nbsp;true</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">Got&nbsp;data:&nbsp;721&nbsp;bytes</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;args&quot;:&nbsp;{},&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;data&quot;:&nbsp;&quot;&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;files&quot;:&nbsp;{},&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;form&quot;:&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;comments&quot;:&nbsp;&quot;&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;custemail&quot;:&nbsp;&quot;email@address.org&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;custname&quot;:&nbsp;&quot;Vincent&nbsp;Silver&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;custtel&quot;:&nbsp;&quot;123-123-123&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;delivery&quot;:&nbsp;&quot;&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;size&quot;:&nbsp;&quot;small&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;topping&quot;:&nbsp;&quot;bacon&quot;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;},&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;headers&quot;:&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Accept&quot;:&nbsp;&quot;*/*&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Accept-Encoding&quot;:&nbsp;&quot;gzip,&nbsp;deflate&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Accept-Language&quot;:&nbsp;&quot;ru,en&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Content-Length&quot;:&nbsp;&quot;127&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Content-Type&quot;:&nbsp;&quot;application/x-www-form-urlencoded&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;Host&quot;:&nbsp;&quot;httpbin.org&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;User-Agent&quot;:&nbsp;&quot;MetaTrader&nbsp;5&nbsp;Terminal/5.3333&nbsp;(Windows&nbsp;NT&nbsp;10.0;&nbsp;x64)&quot;,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&quot;X-Amzn-Trace-Id&quot;:&nbsp;&quot;Root=1-62de5745-25bd1d823a9609f01cff04ad&quot;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;},&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;json&quot;:&nbsp;null,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&quot;url&quot;:&nbsp;&quot;https://httpbin.org/post&quot;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The test server acknowledges receipt of the data as a JSON copy. In practice, the server, of course, will not return the data itself, but simply will report a success status and possibly redirect to another web page that the data had an effect on (for example, show the order number).</span></p>
<p class="p_Text"><span class="f_Text">With the help of such POST requests, but of smaller size, authorization is usually performed as well. But to say the truth, most web services deliberately overcomplicate this process for security purposes and require you to first calculate several hash sums from the user's details. Specially developed public APIs usually have descriptions of all necessary algorithms in the documentation. But this is not always the case. In particular, we will not be able to log in using </span><span class="f_Text" style="font-style: italic;">WebRequest</span><span class="f_Text"> on </span><span class="f_Text" style="font-style: italic;">mql5.com</span><span class="f_Text"> because the site does not have an open programming interface.</span></p>
<p class="p_Text"><span class="f_Text">When sending requests to web services, always adhere to the rule about not exceeding the frequency of requests: usually, each service specifies its own limits, and violation of them will lead to the subsequent blocking of your client program, account, or IP address.</span></p>

</div>

</body>
</html>
