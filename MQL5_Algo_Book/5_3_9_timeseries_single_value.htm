<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>5.3.9 Reading price, volume, spread, and time by bar index</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part5.htm"> Part 5. Creating application programs </a> / <a class="h_m" href="5_3_timeseries.htm"> 5.3 Timeseries </a>/ 5.3.9 Reading price, volume, spread, and time by bar index
          </td>
          <td width="70" align="right">
          <a href="5_3_8_timeseries_ohlcvs.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="5_3_10_timeseries_highest_lowest.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">5.3.9 Reading price, volume, spread, and time by bar index</span></p>
<p class="p_Text"><span class="f_Text">Sometimes you need to find out information not about a sequence of bars but only about one bar. In theory, this can be done by using the previously discussed </span><span class="f_Text" style="font-style: italic;">Copy</span><span class="f_Text"> functions, specifying in them the quantity (parameter </span><span class="f_Text" style="font-style: italic;">count</span><span class="f_Text">) equal to 1, but this is not very convenient. A simpler version is offered by the following functions, which return one value of a certain type for a bar by its number in the timeseries.</span></p>
<p class="p_Text"><span class="f_Text">All functions have a similar prototype but different names and return types. Historically, names begin with the prefix </span><span class="f_Text" style="font-style: italic;">i</span><span class="f_Text">, that is, have the form </span><span class="f_Text" style="font-style: italic;">iValue</span><span class="f_Text"> (these functions belong to a large group of built-in technical indicators: after all, the characteristics of quotes are the primary source for technical analysis, and almost all indicators are their derivatives, hence the letter </span><span class="f_Text" style="font-style: italic;">i</span><span class="f_Text">).</span></p>
<p class="p_H4"><span class="f_H4">type iValue(const string symbol, ENUM_TIMEFRAMES timeframe, int offset)</span></p>
<p class="p_Text"><span class="f_Text">Here type corresponds to one of the types </span><span class="f_Text" style="font-style: italic;">datetime</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">long</span><span class="f_Text">, or </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text">, depending on the specific function. Symbol and timeframe identify the requested timeseries. Required bar index </span><span class="f_Text" style="font-style: italic;">offset</span><span class="f_Text"> is passed in timeseries notation: 0 means the most recent, right bar (usually not completed yet), and higher numbers mean older bars. As in the case of Copy functions, NULL and 0 can be used to set the symbol and period to be equal to the properties of the current chart.</span></p>
<p class="p_Text"><span class="f_Text">Because </span><span class="f_Text" style="font-style: italic;">i</span><span class="f_Text"> functions are equivalent to calling </span><span class="f_Text" style="font-style: italic;">Copy</span><span class="f_Text"> functions, all features of requesting timeseries from different types of programs, described in the section <a href="5_3_6_timeseries_copy_funcs_overview.htm" class="topiclink">Overview of Copy functions for obtaining arrays of quotes</a> are applicable to them.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:20%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Function</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iTime</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Bar opening time</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iOpen</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Bar opening price</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iHigh</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Bar high price</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iLow</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Bar low price</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iClose</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Bar closing price</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iTickVolume</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Bar tick volume (similar to iVolume)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iVolume</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Bar tick volume (similar to iTickVolume)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iRealVolume</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Real trading volume of the bar</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:20%;"><p class="p_fortable"><span class="f_fortable">iSpread</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Minimum bar spread (in pips)</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">The functions return the requested value or 0 on error (unfortunately, 0 can be a real value in some cases). To get more information about the error, call the </span><span class="f_Text" style="font-style: italic;"><a href="4_9_15_env_last_error.htm" class="topiclink">GetLastError</a></span><span class="f_Text"> function.</span></p>
<p class="p_Text"><span class="f_Text">The functions do not cache the results. On each call, they return actual data from the timeseries for the specified symbol/period. This means that in the absence of ready data (on the first call, or after a loss of synchronization), the function may take some time to prepare the result.</span></p>
<p class="p_Text"><span class="f_Text">As an example, let's try to obtain a more or less realistic estimate of the spread size for each bar. The minimum spread value is stored in the quotes, which can cause unreasonably high expectations when designing trading strategies. To obtain absolutely accurate values of the average, median or maximum spread per bar, it would be necessary to analyze real ticks, but we have not yet learned how to work with them. And besides, it would be a very resource-intensive process. A more rational approach is to analyze spreads on the lower M1 timeframe: for bars of higher timeframes, it is enough to look for the maximum spread in the inside bars of M1. Of course, strictly speaking, it will not be the maximum, but the maximum of the minimum values, but given the transience of minute readings, we may hope to detect characteristic spread expansions at least on some M1 bars, and this is enough to get an acceptable ratio of analysis accuracy and speed.</span></p>
<p class="p_Text"><span class="f_Text">One of the versions of the algorithm is implemented in the script </span><span class="f_Text" style="font-style: italic;">SeriesSpread.mq5</span><span class="f_Text">. In the input variables, you can set the symbol, timeframe, and the number of bars for analysis. By default, the symbol of the current chart and its period are processed (should be greater than M1).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WorkSymbol</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;Symbol&nbsp;(leave&nbsp;empty&nbsp;for&nbsp;current)</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">ENUM_TIMEFRAMES</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">TimeFrame</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_CURRENT</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BarCount</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">100</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Since only information about its time and spread is important for each bar, a special structure with two fields was described. We could use the standard </span><span class="f_Text" style="font-style: italic;">MqlRates</span><span class="f_Text"> structure and add &quot;maximum&quot; spreads to some unused field (for example, </span><span class="f_Text" style="font-style: italic;">real_volume</span><span class="f_Text"> for Forex symbols), but then the data for most fields would be copied and memory would be wasted.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SpreadPerBar</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">spread</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Using the new structure type, we prepare the </span><span class="f_Text" style="font-style: italic;">peaks</span><span class="f_Text"> array to calculate the data of the specified number of bars.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SpreadPerBar</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">peaks</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">peaks</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BarCount</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ZeroMemory</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">peaks</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Further along, the main part of the algorithm is executed in the bar loop. For each bar, we used the function </span><span class="f_Text" style="font-style: italic;">iTime</span><span class="f_Text"> to determine two timestamps that define the boundaries of the bar. In fact, this is the opening time of the i-th bar and the neighboring (i+1)-th bar. Given the principles of indexing, we can say that the (i+1)th bar is the previous bar (older, see variable </span><span class="f_Text" style="font-style: italic;">prev</span><span class="f_Text">) and i-th is the next one (newer, see variable </span><span class="f_Text" style="font-style: italic;">next</span><span class="f_Text">). The bar opening time belongs to only one bar, that is, the label </span><span class="f_Text" style="font-style: italic;">prev</span><span class="f_Text"> is contained in the (i+1)-th bar, and the label </span><span class="f_Text" style="font-style: italic;">next</span><span class="f_Text"> is in the i-th one. Thus, when processing each bar, its right border should be excluded from the interval [</span><span class="f_Text" style="font-style: italic;">prev;next</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">We are interested in spreads on a one-minute timeframe, and therefore we will use the </span><span class="f_Text" style="font-style: italic;">CopySpread</span><span class="f_Text"> function for PERIOD_M1. In this case, the half-open interval is achieved by setting the </span><span class="f_Text" style="font-style: italic;">start/stop</span><span class="f_Text"> parameters to the exact </span><span class="f_Text" style="font-style: italic;">prev</span><span class="f_Text"> value and the </span><span class="f_Text" style="font-style: italic;">next</span><span class="f_Text"> value reduced by 1 second. Spread information is copied to the dynamic array </span><span class="f_Text" style="font-style: italic;">spreads</span><span class="f_Text"> (memory for it is allocated by the function itself).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BarCount</span><span class="f_CodeExample">;&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int&nbsp;</span><span class="f_CodeExample" style="color: #333333;">spreads</span><span class="f_CodeExample">[];&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;receiving&nbsp;array&nbsp;for&nbsp;M1&nbsp;spreads&nbsp;inside&nbsp;the&nbsp;i-th&nbsp;bar</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">next</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">iTime</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">WorkSymbol</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">TimeFrame</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">prev</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">iTime</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">WorkSymbol</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">TimeFrame</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">CopySpread</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">WorkSymbol</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">prev</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">next</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">spreads</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayMaximum</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">spreads</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">m</span><span class="f_CodeExample">&nbsp;&gt;&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">peaks</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">spread</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">spreads</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">m</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">peaks</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">prev</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Then, we find the maximum value in this array and save it in the appropriate structure </span><span class="f_Text" style="font-style: italic;">SpreadPerBar</span><span class="f_Text"> along with the bar time. Please note that the zero incomplete bar is not included in the analysis (you can supplement the algorithm if necessary).</span></p>
<p class="p_Text"><span class="f_Text">After the loop is completed, we output an array of structures to the journal.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Maximal&nbsp;speeds&nbsp;per&nbsp;intraday&nbsp;bar\nProcessed&nbsp;%d&nbsp;bars&nbsp;on&nbsp;%s&nbsp;%s&quot;</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BarCount</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">WorkSymbol</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">&nbsp;?&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WorkSymbol</span><span class="f_CodeExample">&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #800080;">_Symbol</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">EnumToString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">TimeFrame</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_CURRENT</span><span class="f_CodeExample">&nbsp;?&nbsp;</span><span class="f_CodeExample" style="color: #800080;">_Period</span><span class="f_CodeExample">&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">TimeFrame</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ArrayPrintM</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">peaks</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">By running the script on the EURUSD,H1 chart, we will get spread statistics inside hourly bars (abridged):</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Maximal&nbsp;speeds&nbsp;per&nbsp;intraday&nbsp;bar</span>
<br><span class="f_CodeExample">Processed&nbsp;100&nbsp;bars&nbsp;on&nbsp;EURUSD&nbsp;PERIOD_H1</span>
<br><span class="f_CodeExample">[&nbsp;0]&nbsp;2021.10.12&nbsp;14:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[&nbsp;1]&nbsp;2021.10.12&nbsp;13:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[&nbsp;2]&nbsp;2021.10.12&nbsp;12:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[&nbsp;3]&nbsp;2021.10.12&nbsp;11:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[&nbsp;4]&nbsp;2021.10.12&nbsp;10:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">[&nbsp;5]&nbsp;2021.10.12&nbsp;09:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[&nbsp;6]&nbsp;2021.10.12&nbsp;08:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</span>
<br><span class="f_CodeExample">[&nbsp;7]&nbsp;2021.10.12&nbsp;07:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</span>
<br><span class="f_CodeExample">[&nbsp;8]&nbsp;2021.10.12&nbsp;06:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[&nbsp;9]&nbsp;2021.10.12&nbsp;05:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[10]&nbsp;2021.10.12&nbsp;04:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[11]&nbsp;2021.10.12&nbsp;03:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[12]&nbsp;2021.10.12&nbsp;02:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4</span>
<br><span class="f_CodeExample">[13]&nbsp;2021.10.12&nbsp;01:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16</span>
<br><span class="f_CodeExample">[14]&nbsp;2021.10.12&nbsp;00:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;65</span>
<br><span class="f_CodeExample">[15]&nbsp;2021.10.11&nbsp;23:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15</span>
<br><span class="f_CodeExample">[16]&nbsp;2021.10.11&nbsp;22:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</span>
<br><span class="f_CodeExample">[17]&nbsp;2021.10.11&nbsp;21:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[18]&nbsp;2021.10.11&nbsp;20:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[19]&nbsp;2021.10.11&nbsp;19:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</span>
<br><span class="f_CodeExample">[20]&nbsp;2021.10.11&nbsp;18:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[21]&nbsp;2021.10.11&nbsp;17:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[22]&nbsp;2021.10.11&nbsp;16:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">[23]&nbsp;2021.10.11&nbsp;15:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</span>
<br><span class="f_CodeExample">[24]&nbsp;2021.10.11&nbsp;14:00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">There is an obvious increase in spreads at night: for example, close to midnight, quotes contain spreads of 7-15 points, and in our measurements, they are 15-65. However, non-zero values are also found in other periods, although the metrics of hourly bars usually contain zeros.</span></p>

</div>

</body>
</html>
