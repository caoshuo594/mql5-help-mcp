<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>3.3.3 Templates vs preprocessor macros</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part3.htm"> Part 3. Object Oriented Programming </a> / <a class="h_m" href="3_3_templates.htm"> 3.3 Templates </a>/ 3.3.3 Templates vs preprocessor macros
          </td>
          <td width="70" align="right">
          <a href="3_3_2_templates_principles.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="3_3_4_templates_for_standard_and_object_types.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">3.3.3 Templates vs preprocessor macros</span></p>
<p class="p_Text"><span class="f_Text">A question may arise at some point, is it possible to use macro substitutions for the purposes of code generation? It is actually possible. For example, the set of </span><span class="f_Text" style="font-style: italic;">Max</span><span class="f_Text"> functions can be easily represented as a macro:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">MAX</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">V1</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">V2</span><span class="f_CodeExample">)&nbsp;((</span><span class="f_CodeExample" style="color: #333333;">V1</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">V2</span><span class="f_CodeExample">)&nbsp;?&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">V1</span><span class="f_CodeExample">)&nbsp;:&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">V2</span><span class="f_CodeExample">))</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">However, macros have more limited capabilities (nothing more than text substitution) and therefore they are only used in simple cases (like the one above).</span></p>
<p class="p_Text"><span class="f_Text">When comparing macros and templates, the following differences should be noted.</span></p>
<p class="p_Text"><span class="f_Text">Macros are &quot;expanded&quot; and replaced in the source text by the preprocessor before compilation starts. At the same time, there is no information about the types of parameters and the context in which the contents of the macro are substituted. In particular, the macro MAX cannot provide a check-up that the types of the parameters V1 and V2 are the same, and also that the comparison operator '&gt;' is defined for them. In addition, if a variable with the name MAX is encountered in a program text, the preprocessor will try to substitute the &quot;call&quot; of the MAX macro in its place and will be &quot;unhappy&quot; with the absence of arguments. Worse yet, these substitutions ignore which namespaces or classes the MAX token is found in — basically, any will do.</span></p>
<p class="p_Text"><span class="f_Text">Unlike macros, templates are handled by the compiler in terms of specific argument types and where they are used, so they provide type compatibility (and general applicability) checks for all expressions in a template, as well as context binding. For example, we can define a method template within a concrete class.</span></p>
<p class="p_Text"><span class="f_Text">A template with the same name can be defined differently for different types if necessary, while a macro with a given name is always replaced by the same &quot;implementation&quot;. For example, in the case of a function like MAX, we could define a case-insensitive comparison for strings.</span></p>
<p class="p_Text"><span class="f_Text">Compilation errors due to problems in macros are difficult to diagnose, especially if the macro consists of several lines, since the problematic line with the &quot;call&quot; of the macro is highlighted &quot;as is&quot;, without the expanded version of the text, as it came from the preprocessor to the compiler.</span></p>
<p class="p_Text"><span class="f_Text">At the same time, templates are elements of the source code in a ready-made form, as they enter the compiler, and therefore any error in them has a specific line number and position in the line.</span></p>
<p class="p_Text"><span class="f_Text">Macros can have side effects, which we discussed in the <a href="2_9_4_preprocessor_define_functional.htm" class="topiclink">Form of #define as a pseudo-function</a> section: if the MAX macro arguments are expressions with increments/decrements, then they will be executed twice.</span></p>
<p class="p_Text"><span class="f_Text">However, macros also have some advantages. Macros are capable of generating any text, not just correct language constructs. For example, with a few macros, you can simulate the instruction </span><span class="f_Text" style="font-style: italic;">switch</span><span class="f_Text"> for strings (although this approach is not recommended).</span></p>
<p class="p_Text"><span class="f_Text">In the standard library, macros are used, in particular, to organize the processing of events on charts (see </span><span class="f_Text" style="font-style: italic;">MQL5/Include/Controls/Defines.mqh</span><span class="f_Text">: EVENT_MAP_BEGIN, EVENT_MAP_END, ON_EVENT, etc.). It will not work on templates, but the way of arranging an event map on macros, of course, is far from the only one and not the most convenient for debugging. It is difficult to debug step-by-step (line-by-line) code execution in macros. Templates, on the contrary, support debugging in full.</span></p>

</div>

</body>
</html>
