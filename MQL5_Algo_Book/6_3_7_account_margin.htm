<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>6.3.7 Account margin settings</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part6.htm"> Part 6. Trading automation </a> / <a class="h_m" href="6_3_account.htm"> 6.3 Trading account information </a>/ 6.3.7 Account margin settings
          </td>
          <td width="70" align="right">
          <a href="6_3_6_account_limits_and_restrictions.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="6_3_8_account_state.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">6.3.7 Account margin settings</span></p>
<p class="p_Text"><span class="f_Text">For trading robots, it is important to control the amount of margin blocked and the amount available to secure new trades. In particular, if there are not enough free funds, the program will not be able to execute a trade. When maintaining open unprofitable positions, first a Margin Call is received, and if it is not fulfilled, the positions are forcedly closed by the broker (Stop Out). All associated account properties are included in the ENUM_ACCOUNT_INFO_DOUBLE enumeration.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:40%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Current reserved margin on the account in the deposit currency</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN_FREE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Current free margin on the account in the deposit currency, available for opening a position</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN_LEVEL</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Margin level on the account in percent (equity/margin*100)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN_SO_CALL</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The minimum margin level at which account replenishment will be required (Margin Call)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN_SO_SO</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The minimum margin level at which the most unprofitable position will be forced to close (Stop Out)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN_INITIAL</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Funds reserved on the account to provide margin for all pending orders</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN_MAINTENANCE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Funds reserved on the account to provide the minimum required margin for all open positions</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">ACCOUNT_MARGIN_SO_CALL and ACCOUNT_MARGIN_SO_SO are expressed as a percentage or deposit currency depending on the set ACCOUNT_MARGIN_SO_MODE (see further). This property, with the possibility to measure margin thresholds for the Margin Call or Stop Out, is included in the ENUM_ACCOUNT_INFO_INTEGER enumeration. In addition, the total leverage (used to calculate the margin for certain types of instruments) is also indicated there.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:40%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_LEVERAGE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The leverage amount</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">ACCOUNT_MARGIN_SO_MODE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The mode for setting the minimum allowable margin level from the ENUM_ACCOUNT_STOPOUT_MODE enumeration </span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">And here are the elements of the ENUM_ACCOUNT_STOPOUT_MODE enumeration.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:40%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortableCondensed"><span class="f_fortableCondensed">ACCOUNT_STOPOUT_MODE_PERCENT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The level is set as a percentage</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortableCondensed"><span class="f_fortableCondensed">ACCOUNT_STOPOUT_MODE_MONEY</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The level is set in the account currency</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">For example, for the ACCOUNT_STOPOUT_MODE_PERCENT option, the specified percentage (Margin Call or Stop Out) should be checked against the ratio of equity to the value of the ACCOUNT_MARGIN property:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_EQUITY</span><span class="f_CodeExample">)&nbsp;/&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_MARGIN</span><span class="f_CodeExample">)&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #333333;">100</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_MARGIN_SO_CALL</span><span class="f_CodeExample">)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the next section, you will find more details about the ACCOUNT_EQUITY property and other financial indicators of the account.</span></p>
<p class="p_Text"><span class="f_Text">However, the current margin level in percent is already provided in the ACCOUNT_MARGIN_LEVEL property. This is easy to check using the </span><span class="f_Text" style="font-style: italic;">AccountInfo.mq5</span><span class="f_Text"> script which logs all account properties, including those listed above.</span></p>
<p class="p_Text"><span class="f_Text">We have already run this script in the section <a href="6_3_2_account_number_identity.htm" class="topiclink">Account identification</a>. At that moment, one position was opened (1 lot USDRUB, equal to 100,000 USD), and the financials were as follows:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;0&nbsp;ACCOUNT_BALANCE=10000.00</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;1&nbsp;ACCOUNT_CREDIT=0.00</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;2&nbsp;ACCOUNT_PROFIT=-78.76</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;3&nbsp;ACCOUNT_EQUITY=9921.24</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;4&nbsp;ACCOUNT_MARGIN=1000.00</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;5&nbsp;ACCOUNT_MARGIN_FREE=8921.24</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;6&nbsp;ACCOUNT_MARGIN_LEVEL=992.12</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;7&nbsp;ACCOUNT_MARGIN_SO_CALL=50.00</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;8&nbsp;ACCOUNT_MARGIN_SO_SO=30.00</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">With a margin of 1000.00 USD, it is easy to check that the leverage of the account, ACCOUNT_LEVERAGE, is indeed 100 (according to the formula for calculating <a href="6_1_16_symbols_margin.htm" class="topiclink">margin for Forex</a> and <a href="6_1_7_symbols_margin_rates.htm" class="topiclink">margin ratio</a> which is equal to 1.0). The margin amount does not need to be converted at the current rate into the account currency, since it is the same as the base currency of the instrument.</span></p>
<p class="p_Text"><span class="f_Text">To get 992.12 in ACCOUNT_MARGIN_LEVEL, just divide 9921.24 by 1000.00 and multiply by 100%.</span></p>
<p class="p_Text"><span class="f_Text">Then another 1 lot position was opened, and the quotes went in an unfavorable direction, as a result of which the situation changed:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;0&nbsp;ACCOUNT_BALANCE=10000.00</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;1&nbsp;ACCOUNT_CREDIT=0.00</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;2&nbsp;ACCOUNT_PROFIT=-1486.07</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;3&nbsp;ACCOUNT_EQUITY=8513.93</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;4&nbsp;ACCOUNT_MARGIN=2000.00</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;5&nbsp;ACCOUNT_MARGIN_FREE=6513.93</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;6&nbsp;ACCOUNT_MARGIN_LEVEL=425.70</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">We can see a loss in the ACCOUNT_PROFIT column and a corresponding decrease in equity ACCOUNT_EQUITY. The margin ACCOUNT_MARGIN increased proportionally from 1000 to 2000, free margin and margin level decreased (but still far from the 50% and 30% limits). Again, the level 425.70 is obtained as the result of calculating the expression 8513.93 / 2000.00 * 100.</span></p>
<p class="p_Text"><span class="f_Text">It is more practical to use this formula to calculate the future margin level before opening a new position. In this case, it is necessary to increase the amount of the existing margin by the additional margin of </span><span class="f_Text" style="font-style: italic;">X</span><span class="f_Text">. In addition, if a market entry deal involves an instant commission deduction </span><span class="f_Text" style="font-style: italic;">C</span><span class="f_Text">, then, strictly speaking, it should also be taken into account (although usually it has a size significantly less than the margin and it can be neglected, plus the API does not provide a way to find out the commission in advance, before performing a trade: it can only be estimated by the commissions of already completed trades in trading history).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_EQUITY</span><span class="f_CodeExample">)&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">C</span><span class="f_CodeExample">)&nbsp;/&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_MARGIN</span><span class="f_CodeExample">)&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">)&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #333333;">100</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_MARGIN_SO_CALL</span><span class="f_CodeExample">)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Later we will learn how to obtain the </span><span class="f_Text" style="font-style: italic;">X</span><span class="f_Text"> value using the </span><span class="f_Text" style="font-style: italic;"><a href="6_4_7_experts_ordercalcmargin.htm" class="topiclink">OrderCalcMargin</a></span><span class="f_Text"> function, but in addition to it, adjustments may be required according to the rules announced in the <a href="6_1_16_symbols_margin.htm" class="topiclink">Margin Requirements</a> section, in particular, taking into account the possible <a href="https://www.metatrader5.com/en/terminal/help/trading_advanced/margin_forex#hedging" target="_blank" class="weblink" title="terminal documentation">position hedging</a>, discounts, and <a href="https://www.metatrader5.com/en/terminal/help/trading_advanced/margin_exchange" target="_blank" class="weblink" title="terminal documentation">margin adjustments</a>.</span></p>
<p class="p_Text"><span class="f_Text">For the option of setting the margin limit in money (ACCOUNT_STOPOUT_MODE_MONEY), the check for sufficient funds must be different.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_EQUITY</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">AccountInfoDouble</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ACCOUNT_MARGIN_SO_CALL</span><span class="f_CodeExample">)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here the commission is omitted. Please note that the margin </span><span class="f_Text" style="font-style: italic;">X</span><span class="f_Text"> for a new position being prepared for opening 'now' does not affect the assessment of the 'future' margin in any way.</span></p>
<p class="p_Text"><span class="f_Text">However, in any case, it is desirable not to load the deposit so much that the inequalities are barely fulfilled. The values of ACCOUNT_MARGIN_SO_CALL and ACCOUNT_MARGIN_SO_SO are quite close, and although the margin at the ACCOUNT_MARGIN_SO_CALL level is just a warning to the trader, it is easy to get a forced closing. That is why the formulas use the ACCOUNT_MARGIN_SO_CALL property.</span></p>

</div>

</body>
</html>
