<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>5.9.1 Event handling function OnChartEvent</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part5.htm"> Part 5. Creating application programs </a> / <a class="h_m" href="5_9_events.htm"> 5.9 Interactive events on charts </a>/ 5.9.1 Event handling function OnChartEvent
          </td>
          <td width="70" align="right">
          <a href="5_9_events.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="5_9_2_events_properties.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">5.9.1 Event handling function OnChartEvent</span></p>
<p class="p_Text"><span class="f_Text">An indicator or Expert Advisor can receive interactive events from the terminal if the code contains the </span><span class="f_Text" style="font-style: italic;">OnChartEvent</span><span class="f_Text"> function with the following prototype.</span></p>
<p class="p_H4"><span class="f_H4">void OnChartEvent(const int event, const long &amp;lparam, const double &amp;dparam, const string &amp;sparam)</span></p>
<p class="p_Text"><span class="f_Text">This function will be called by the terminal in response to user actions or in case of generating a &quot;user event&quot; using </span><span class="f_Text" style="font-style: italic;"><a href="5_9_7_events_custom.htm" class="topiclink">EventChartCustom</a></span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">event</span><span class="f_Text"> parameter, the event identifier (its type) is passed as one of the values of the ENUM_CHART_EVENT enumeration (see the table).</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:40%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_KEYDOWN</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Keyboard action</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_MOUSE_MOVE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Moving the mouse and clicking mouse buttons (if the CHART_EVENT_MOUSE_MOVE property is set for the chart)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_MOUSE_WHEEL</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Clicking or scrolling the mouse wheel (if the CHART_EVENT_MOUSE_WHEEL property is set for the chart)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_CLICK</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Mouse-click on the chart</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_OBJECT_CREATE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Creating a graphical object (if the CHART_EVENT_OBJECT_CREATE property is set for the chart)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_OBJECT_CHANGE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Modifying a graphical object through the properties dialog</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_OBJECT_DELETE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Deleting a graphical object (if the CHART_EVENT_OBJECT_DELETE property is set for the chart)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_OBJECT_CLICK</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Mouse-click on a graphical object</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_OBJECT_DRAG</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Dragging a graphical object</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_OBJECT_ENDEDIT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Finishing text editing in the &quot;input field&quot; graphical object</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_CHART_CHANGE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Changing the chart dimensions or properties (via the properties dialog, toolbar, or context menu)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_CUSTOM</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The starting number of the event from the custom event range</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:40%;"><p class="p_fortable"><span class="f_fortable">CHARTEVENT_CUSTOM_LAST</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">The end number of the event from the custom event range</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">lparam</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">dparam</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">sparam</span><span class="f_Text"> parameters are used differently depending on the event type. In general, we can say that they contain additional data necessary to process a particular event. The following sections provide details for each type.</span></p>
<p class="p_Quote"><span class="f_Quote">Attention! The </span><span class="f_Quote" style="font-style: italic;">OnChartEvent</span><span class="f_Quote"> function is called only for indicators and Expert Advisors that are directly plotted on the chart. If any indicator is created programmatically using </span><span class="f_Quote" style="font-style: italic;"><a href="5_5_2_indicators_icustom.htm" class="topiclink">iCustom</a></span><span class="f_Quote"> or </span><span class="f_Quote" style="font-style: italic;"><a href="5_5_8_indicators_indicatorcreate.htm" class="topiclink">IndicatorCreate</a></span><span class="f_Quote">, the </span><span class="f_Quote" style="font-style: italic;">OnChartEvent</span><span class="f_Quote"> events will not be translated to it.</span><br>
<span class="f_Quote" style="font-style: italic;">&nbsp;</span><br>
<span class="f_Quote">In addition, the </span><span class="f_Quote" style="font-style: italic;">OnChartEvent</span><span class="f_Quote"> handler is not called in the <a href="6_5_tester.htm" class="topiclink">tester</a>, even in visual mode.</span></p>
<p class="p_Text"><span class="f_Text">For the first demonstration of the </span><span class="f_Text" style="font-style: italic;">OnChartEvent</span><span class="f_Text"> handler, let's consider a bufferless indicator </span><span class="f_Text" style="font-style: italic;">EventAll.mq5</span><span class="f_Text"> which intercepts and logs all events.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnChartEvent</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">lparam</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">dparam</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">sparam</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">ENUM_CHART_EVENT</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">evt</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #ff0000;">ENUM_CHART_EVENT</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;%s&nbsp;%lld&nbsp;%f&nbsp;'%s'&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">EnumToString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">evt</span><span class="f_CodeExample">),&nbsp;</span><span class="f_CodeExample" style="color: #333333;">lparam</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">dparam</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">sparam</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">By default, all types of events can be generated on the chart, except for four mass events, which, as indicated in the table above, are enabled by the special properties of the chart. In the next section, we will supplement the indicator with settings to include certain types according to preferences.</span></p>
<p class="p_Text"><span class="f_Text">Run the indicator on a chart with existing objects or create objects while the indicator is running.</span></p>
<p class="p_Text"><span class="f_Text">Change the size or settings of the chart, make mouse clicks, and edit the properties of objects. The following entries will appear in the log.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">CHARTEVENT_CHART_CHANGE&nbsp;0&nbsp;0.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_CLICK&nbsp;149&nbsp;144.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_OBJECT_CLICK&nbsp;112&nbsp;105.000000&nbsp;'Daily&nbsp;Rectangle&nbsp;53404'</span>
<br><span class="f_CodeExample">CHARTEVENT_CLICK&nbsp;112&nbsp;105.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_KEYDOWN&nbsp;46&nbsp;1.000000&nbsp;'339'</span>
<br><span class="f_CodeExample">CHARTEVENT_CLICK&nbsp;13&nbsp;252.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_OBJECT_DRAG&nbsp;0&nbsp;0.000000&nbsp;'Daily&nbsp;Button&nbsp;61349'</span>
<br><span class="f_CodeExample">CHARTEVENT_OBJECT_CLICK&nbsp;145&nbsp;104.000000&nbsp;'Daily&nbsp;Button&nbsp;61349'</span>
<br><span class="f_CodeExample">CHARTEVENT_CLICK&nbsp;145&nbsp;104.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_CHART_CHANGE&nbsp;0&nbsp;0.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_OBJECT_DRAG&nbsp;0&nbsp;0.000000&nbsp;'Daily&nbsp;Vertical&nbsp;Line&nbsp;22641'</span>
<br><span class="f_CodeExample">CHARTEVENT_OBJECT_DRAG&nbsp;0&nbsp;0.000000&nbsp;'Daily&nbsp;Vertical&nbsp;Line&nbsp;22641'</span>
<br><span class="f_CodeExample">CHARTEVENT_OBJECT_CLICK&nbsp;177&nbsp;206.000000&nbsp;'Daily&nbsp;Vertical&nbsp;Line&nbsp;22641'</span>
<br><span class="f_CodeExample">CHARTEVENT_CLICK&nbsp;177&nbsp;206.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_OBJECT_CHANGE&nbsp;0&nbsp;0.000000&nbsp;'Daily&nbsp;Rectangle&nbsp;37930'</span>
<br><span class="f_CodeExample">CHARTEVENT_CHART_CHANGE&nbsp;0&nbsp;0.000000&nbsp;''</span>
<br><span class="f_CodeExample">CHARTEVENT_CLICK&nbsp;152&nbsp;118.000000&nbsp;''</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here we see events of various types, the meanings of their parameters will become clear after reading the following sections.</span></p>

</div>

</body>
</html>
