<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>3.1.5 Packing structures in memory and interacting with DLLs</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part3.htm"> Part 3. Object Oriented Programming </a> / <a class="h_m" href="3_1_structs_and_unions.htm"> 3.1 Structures and unions </a>/ 3.1.5 Packing structures in memory and interacting with DLLs
          </td>
          <td width="70" align="right">
          <a href="3_1_4_structs_ctor_dtor.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="3_1_6_structs_composition.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">3.1.5 Packing structures in memory and interacting with DLLs</span></p>
<p class="p_Text"><span class="f_Text">To store one instance of the structure, a contiguous area is allocated in memory, sufficient to fit all the elements.</span></p>
<p class="p_Text"><span class="f_Text">Unlike in C++, here structure elements follow one after another in memory and are not aligned on the boundary of 2, 4, 8 or 16 bytes, depending on the size of the elements themselves (alignment algorithms differ for different compilers and operating modes). Alignment of elements, the size of which is less than the specified block, is performed by adding unused dummy variables to the composition of the structure (the program does not have direct access to them). Alignment is used to optimize memory performance.</span></p>
<p class="p_Text"><span class="f_Text">MQL5 allows you to change the alignment rules if necessary, mainly when integrating MQL programs with third-party DLLs that describe specific types of structures. For those, it is necessary to prepare an equivalent description in MQL5 (see the section on <a href="7_7_2_libraries_import.htm" class="topiclink">importing libraries</a>). It is important to note that structures intended for integration should only have fields of a limited set of types in their definition. So, they cannot use strings, dynamic arrays, as well as class objects, and <a href="3_2_13_classes_pointers.htm" class="topiclink">pointers</a> to class objects.</span></p>
<p class="p_Text"><span class="f_Text">Alignment is controlled by the keyword </span><span class="f_Text" style="font-style: italic;">pack</span><span class="f_Text"> added to the header of the structure. There are two options:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">pack</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">size</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #333333;">identifier</span>
<br><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">identifier</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">pack</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">size</span><span class="f_CodeExample">)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In both cases, the size is an integer 1, 2, 4, 8, 16. Or you can use </span><span class="f_Text" style="font-style: italic;">sizeof(built-in_type)</span><span class="f_Text"> operator as the size, for example, </span><span class="f_Text" style="font-style: italic;">sizeof(double)</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">The option </span><span class="f_Text" style="font-style: italic;">pack(1)</span><span class="f_Text">, i.e. byte alignment, is identical to default behavior without </span><span class="f_Text" style="font-style: italic;">pack</span><span class="f_Text"> modifier.</span></p>
<p class="p_Text"><span class="f_Text">The special operator </span><span class="f_Text" style="font-style: italic;">offsetof()</span><span class="f_Text"> allows you to find out the offset in bytes of a specific structure element from its beginning. It has 2 parameters: structure object and element identifier. For example,</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">offsetof</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Result</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">status</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;36</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Before the </span><span class="f_Text" style="font-style: italic;">status</span><span class="f_Text"> field in the </span><span class="f_Text" style="font-style: italic;">Result</span><span class="f_Text"> structure, there are 4 </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text"> values and one </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text"> value: 36 in total.</span></p>
<p class="p_Text"><span class="f_Text">When designing your own structures, it is recommended that you place the largest elements first, and then the rest - in order of decreasing their size.</span></p>

</div>

</body>
</html>
