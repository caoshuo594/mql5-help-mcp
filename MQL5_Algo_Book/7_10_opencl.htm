<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>7.10 Built-in support for parallel computing: OpenCL</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part7.htm"> Part 7. Advanced language tools </a>/ 7.10 Built-in support for parallel computing: OpenCL
          </td>
          <td width="70" align="right">
          <a href="7_9_15_python_history_deals.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="conclusion.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H2"><span class="f_H2">7.10 Built-in support for parallel computing: OpenCL</span></p>
<p class="p_Text"><span class="f_Text">OpenCL is an open parallel programming standard that allows you to create applications for simultaneous execution on many cores of modern processors, different in architecture, in particular, graphic (GPU) or central (CPU).</span></p>
<p class="p_Text"><span class="f_Text">In other words, OpenCL allows you to use all the cores of the central processor or all the computing power of the video card for computing one task, which ultimately reduces the program execution time. Therefore, the use of OpenCL is very useful for computationally intensive tasks, but it is important to note that the algorithms for solving these tasks must be divisible into parallel threads. These include, for example, training neural networks, Fourier transform, or solving systems of equations of large dimensions.</span></p>
<p class="p_Text"><span class="f_Text">For example, in relation to the trading specifics, an increase in performance can be achieved with a script, indicator, or Expert Advisor that performs a complex and lengthy analysis of historical data for several symbols and timeframes, and the calculation for each of which does not depend on others.</span></p>
<p class="p_Quote"><span class="f_Quote">At the same time, beginners often have a question whether it is possible to speed up the testing and optimization of Expert Advisors using OpenCL. The answers to both questions are no. Testing reproduces the real process of sequential trading, and therefore each next bar or tick depends on the results of the previous ones, which makes it impossible to parallelize the calculations of one pass. As for optimization, the tester's agents only support CPU cores. This is due to the complexity of a full-fledged analysis of quotes or ticks, tracking positions and calculating balance and equity. However, if complexity doesn't scare you, you can implement your own optimization engine on the graphics card cores by transferring all the calculations that emulate the trading environment with the required reliability to OpenCL.</span></p>
<p class="p_Text"><span class="f_Text">OpenCL means Open Computing Language. It is similar to the C and C++ languages, and therefore, to MQL5. However, in order to prepare (&quot;compile&quot;) an OpenCL program, pass input data to it, run it in parallel on several cores, and obtain calculation results, a special programming interface (a set of functions) is used. This <a href="https://www.mql5.com/en/docs/opencl" target="_blank" class="weblink" title="OpenCL API on MQL5">OpenCL API</a> is also available for MQL programs that wish to implement parallel execution.</span></p>
<p class="p_Text"><span class="f_Text">To use OpenCL, it is not necessary to have a video card on your PC as the presence of a central processor is enough. In any case, special drivers from the manufacturer are required (OpenCL version 1.1 and higher is required). If your computer has games or other software (for example, scientific, video editor, etc.) that work directly with video cards, then the necessary software layer is most likely already available. This can be checked by trying to run an MQL program in the terminal with an OpenCL call (at least a simple example from the terminal delivery, see further).</span></p>
<p class="p_Text"><span class="f_Text">If there is no OpenCL support, you will see an error in the log.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">OpenCL&nbsp;OpenCL&nbsp;not&nbsp;found,&nbsp;please&nbsp;install&nbsp;OpenCL&nbsp;drivers</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">If there is a suitable device on your computer and OpenCL support has been enabled for it, the terminal will display a message with the name and type of this device (there may be several devices). For example:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">OpenCL&nbsp;Device&nbsp;#0:&nbsp;CPU&nbsp;GenuineIntel&nbsp;Intel(R)&nbsp;Core(TM)&nbsp;i7-2700K&nbsp;CPU&nbsp;@&nbsp;3.50GHz&nbsp;with&nbsp;OpenCL&nbsp;1.1&nbsp;(8&nbsp;units,&nbsp;3510&nbsp;MHz,&nbsp;16301&nbsp;Mb,&nbsp;version&nbsp;2.0,&nbsp;rating&nbsp;25)</span>
<br><span class="f_CodeExample">OpenCL&nbsp;Device&nbsp;#1:&nbsp;GPU&nbsp;Intel(R)&nbsp;Corporation&nbsp;Intel(R)&nbsp;UHD&nbsp;Graphics&nbsp;630&nbsp;with&nbsp;OpenCL&nbsp;2.1&nbsp;(24&nbsp;units,&nbsp;1200&nbsp;MHz,&nbsp;13014&nbsp;Mb,&nbsp;version&nbsp;26.20.100.7985,&nbsp;rating&nbsp;73)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The procedure for installing drivers for various devices is described in the <a href="https://www.mql5.com/en/articles/690" target="_blank" class="weblink" title="Installing OpenCL Drivers">article on mql5.com</a>. Support extends to the most popular devices from Intel, AMD, ATI, and Nvidia.</span></p>
<p class="p_Text"><span class="f_Text">In terms of the number of cores and the speed of distributed computing, central processors are significantly inferior to graphics cards, but a good multi-core central processor will be quite enough to significantly increase performance.</span></p>
<p class="p_Quote"><span class="f_Quote">Important: If your computer has a video card with OpenCL support, then you do not need to install OpenCL software emulation on the CPU!</span></p>
<p class="p_Text"><span class="f_Text">OpenCL device drivers automate the distribution of calculations across cores. For example, if you need to perform a million of calculations of the same type with different vectors, and there are only a thousand cores at your disposal, then the drivers will automatically start each next task as the previous ones are ready and the cores are released.</span></p>
<p class="p_Text"><span class="f_Text">Preparatory operations for setting up the OpenCL runtime environment in an MQL program are performed only once using the functions of the above OpenCL API. </span></p>
<ol style="list-style-type:decimal">
<li value="1" class="p_Text"><span class="f_Text">Creating a context for an OpenCL program (selecting a device, such as a video card, CPU, or any available): </span><span class="f_Text" style="font-style: italic;">CLContextCreate(CL_USE_ANY)</span><span class="f_Text">. The function will return a context descriptor (an integer, let's denote it conditionally </span><span class="f_Text" style="font-style: italic;">ContextHandle</span><span class="f_Text">).</span></li>
<li value="2" class="p_Text"><span class="f_Text">Creating an OpenCL program in the received context: it is compiled based on the source code in the OpenCL language using the </span><span class="f_Text" style="font-style: italic;">CLProgramCreate</span><span class="f_Text"> function call, to which the text of the code is passed through the parameter </span><span class="f_Text" style="font-style: italic;">Source</span><span class="f_Text">:</span><span class="f_Text" style="font-style: italic;">CLProgramCreate(ContextHandle, Source, BuildLog)</span><span class="f_Text">. The function will return the program handle (integer </span><span class="f_Text" style="font-style: italic;">ProgramHandle</span><span class="f_Text">). It is important to note here that inside the source code of this program, there must be functions (at least one) marked with a special keyword </span><span class="f_Text" style="font-style: italic;">__kernel</span><span class="f_Text"> (or simply </span><span class="f_Text" style="font-style: italic;">kernel</span><span class="f_Text">): they contain the parts of the algorithm to be parallelized (see example below). Of course, in order to simplify (decompose the source code), the programmer can divide the logical subtasks of the kernel function into other auxiliary functions and call them from the kernel: at the same time, there is no need to mark the auxiliary functions with the word </span><span class="f_Text" style="font-style: italic;">kernel</span><span class="f_Text">.</span></li>
<li value="3" class="p_Text"><span class="f_Text">Registering a kernel to execute by the name of one of those functions that are marked in the code of the OpenCL program as kernel-forming: </span><span class="f_Text" style="font-style: italic;">CLKernelCreate(ProgramHandle, KernelName)</span><span class="f_Text">. Calling this function will return a handle to the kernel (an integer, let's say, </span><span class="f_Text" style="font-style: italic;">KernelHandle</span><span class="f_Text">). You can prepare many different functions in OpenCL code and register them as different kernels.</span></li>
<li value="4" class="p_Text"><span class="f_Text">If necessary, creating buffers for data arrays passed by reference to the kernel and for returned values/arrays: </span><span class="f_Text" style="font-style: italic;">CLBufferCreate(ContextHandle, Size * sizeof(double), CL_MEM_READ_WRITE),</span><span class="f_Text"> etc. Buffers are also identified and managed with descriptors.</span></li>
</ol>
<p class="p_Text"><span class="f_Text">Next, once or several times, if necessary, (for example, in indicator or Expert Advisor event handlers), calculations are performed directly according to the following scheme:</span></p>
<ol style="list-style-type:upper-roman">
<li value="1" class="p_Text"><span class="f_Text">Passing input data and/or binding input/output buffers with </span><span class="f_Text" style="font-style: italic;">CLSetKernelArg(KernelHandle,...)</span><span class="f_Text"> and/or </span><span class="f_Text" style="font-style: italic;">CLSetKernelArgMem(KernelHandle,..., BufferHandle)</span><span class="f_Text">. The first function provides the setting of a scalar value, and the second is equivalent to passing or receiving a value (or an array of values) by reference. At this stage, data is moved from MQL5 to the OpenCL execution core. </span><span class="f_Text" style="font-style: italic;">CLBufferWrite(BufferHandle,...)</span><span class="f_Text"> writes data to the buffer. Parameters and buffers will become available to the OpenCL program during kernel execution.</span></li>
<li value="2" class="p_Text"><span class="f_Text">Performing Parallel Computations by Calling a Specific Kernel </span><span class="f_Text" style="font-style: italic;">CLExecute(KernelHandle,...)</span><span class="f_Text">. The kernel function will be able to write the results of its work to the output buffer.</span></li>
<li value="3" class="p_Text"><span class="f_Text">Getting results with </span><span class="f_Text" style="font-style: italic;">CLBufferRead(BufferHandle)</span><span class="f_Text">. At this stage, data is moved back from OpenCL to MQL5.</span></li>
</ol>
<p class="p_Text"><span class="f_Text">After completion of calculations, all descriptors should be released: </span><span class="f_Text" style="font-style: italic;">CLBufferFree(BufferHandle)</span><span class="f_Text">,</span><span class="f_Text" style="font-style: italic;">CLKernelFree(KernelHandle)</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">CLProgramFree(ProgramHandle)</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">CLContextFree(ContextHandle)</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">This sequence is conventionally indicated in the following diagram.</span></p>
<p class="p_ImageCaption"><img class="help" alt="Scheme of interaction between an MQL program and an OpenCL attachment" title="Scheme of interaction between an MQL program and an OpenCL attachment" width="600" height="544" style="margin:0 auto 0 auto;width:600px;height:544px;border:none" src="mql5-opencl-x.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">Scheme of interaction between an MQL program and an OpenCL attachment</span></p>
<p class="p_Text"><span class="f_Text">It is recommended to write the OpenCL source code in separate text files, which can then be connected to the MQL5 program using <a href="7_1_3_resources_variables.htm" class="topiclink">resource variables</a>.</span></p>
<p class="p_Text"><span class="f_Text">The standard header library supplied with the terminal contains a wrapper class for working with OpenCL: </span><span class="f_Text" style="font-style: italic;">MQL5/Include/OpenCL/OpenCL.mqh</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Examples of using OpenCL can be found in the folder </span><span class="f_Text" style="font-style: italic;">MQL5/Scripts/Examples/OpenCL/</span><span class="f_Text">. In particular, there is the </span><span class="f_Text" style="font-style: italic;">MQL5/Scripts/Examples/OpenCL/Double/Wavelet.mq5</span><span class="f_Text"> script, which produces a wavelet transform of the time series (you can take an artificial curve according to the stochastic Weierstrass model or the increment in prices of the current financial instrument). In any case, the initial data for the algorithm is an array which is a two-dimensional image of a series.</span></p>
<p class="p_Text"><span class="f_Text">When running this script, same as when running any other MQL program with OpenCL code, the terminal will select the fastest device (if there are several of them, and the specific device was not selected in the program itself or was not already defined earlier). Information about this is displayed in the </span><span class="f_Text" style="font-style: italic;">Journal</span><span class="f_Text"> tab (terminal log, not experts).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Scripts&nbsp;script&nbsp;Wavelet&nbsp;(EURUSD,H1)&nbsp;loaded&nbsp;successfully</span>
<br><span class="f_CodeExample">OpenCL&nbsp;&nbsp;device&nbsp;#0:&nbsp;GPU&nbsp;NVIDIA&nbsp;Corporation&nbsp;NVIDIA&nbsp;GeForce&nbsp;GTX&nbsp;1650&nbsp;with&nbsp;OpenCL&nbsp;3.0&nbsp;(16&nbsp;units,&nbsp;1560&nbsp;MHz,&nbsp;4095&nbsp;Mb,&nbsp;version&nbsp;512.72)</span>
<br><span class="f_CodeExample">OpenCL&nbsp;&nbsp;device&nbsp;#1:&nbsp;GPU&nbsp;Intel(R)&nbsp;Corporation&nbsp;Intel(R)&nbsp;UHD&nbsp;Graphics&nbsp;630&nbsp;with&nbsp;OpenCL&nbsp;3.0&nbsp;(24&nbsp;units,&nbsp;1150&nbsp;MHz,&nbsp;6491&nbsp;Mb,&nbsp;version&nbsp;27.20.100.8935)</span>
<br><span class="f_CodeExample">OpenCL&nbsp;&nbsp;device&nbsp;performance&nbsp;test&nbsp;started</span>
<br><span class="f_CodeExample">OpenCL&nbsp;&nbsp;device&nbsp;performance&nbsp;test&nbsp;successfully&nbsp;finished</span>
<br><span class="f_CodeExample">OpenCL&nbsp;&nbsp;device&nbsp;#0:&nbsp;GPU&nbsp;NVIDIA&nbsp;Corporation&nbsp;NVIDIA&nbsp;GeForce&nbsp;GTX&nbsp;1650&nbsp;with&nbsp;OpenCL&nbsp;3.0&nbsp;(16&nbsp;units,&nbsp;1560&nbsp;MHz,&nbsp;4095&nbsp;Mb,&nbsp;version&nbsp;512.72,&nbsp;rating&nbsp;129)</span>
<br><span class="f_CodeExample">OpenCL&nbsp;&nbsp;device&nbsp;#1:&nbsp;GPU&nbsp;Intel(R)&nbsp;Corporation&nbsp;Intel(R)&nbsp;UHD&nbsp;Graphics&nbsp;630&nbsp;with&nbsp;OpenCL&nbsp;3.0&nbsp;(24&nbsp;units,&nbsp;1150&nbsp;MHz,&nbsp;6491&nbsp;Mb,&nbsp;version&nbsp;27.20.100.8935,&nbsp;rating&nbsp;136)</span>
<br><span class="f_CodeExample">Scripts&nbsp;script&nbsp;Wavelet&nbsp;(EURUSD,H1)&nbsp;removed</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">As a result of execution, the script displays in the </span><span class="f_Text" style="font-style: italic;">Experts</span><span class="f_Text"> tab records with calculation speed measurements in the usual way (in series, on the CPU) and in parallel (on OpenCL cores).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">OpenCL:&nbsp;GPU&nbsp;device&nbsp;'Intel(R)&nbsp;UHD&nbsp;Graphics&nbsp;630'&nbsp;selected</span>
<br><span class="f_CodeExample">time&nbsp;CPU=5235&nbsp;ms,&nbsp;time&nbsp;GPU=125&nbsp;ms,&nbsp;CPU/GPU&nbsp;ratio:&nbsp;41.880000</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The ratio of speeds, depending on the specifics of the task, can reach tens.</span></p>
<p class="p_Text"><span class="f_Text">The script displays on the chart the original image, its derivative in the form of increments, and the result of the wavelet transform.</span></p>
<p class="p_ImageCaption"><img class="help" alt="The original simulated series, its increments and wavelet transform" title="The original simulated series, its increments and wavelet transform" width="600" height="400" style="margin:0 auto 0 auto;width:600px;height:400px;border:none" src="wavelet.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">The original simulated series, its increments and wavelet transform</span></p>
<p class="p_Text"><span class="f_Text">Please note that the graphic objects remain on the chart after the script finished working. They will need to be removed manually.</span></p>
<p class="p_Text"><span class="f_Text">Here is how the source OpenCL code of the wavelet transform looks like, implemented in a separate file </span><span class="f_Text" style="font-style: italic;">MQL5/Scripts/Examples/OpenCL/Double/Kernels/wavelet.cl</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="font-style: italic;">//&nbsp;increased&nbsp;calculation&nbsp;accuracy&nbsp;double&nbsp;is&nbsp;required</span>
<br><span class="f_CodeExample" style="font-style: italic;">//&nbsp;(by&nbsp;default,&nbsp;without&nbsp;this&nbsp;directive&nbsp;we&nbsp;get&nbsp;float)</span>
<br><span class="f_CodeExample">#pragma&nbsp;OPENCL&nbsp;EXTENSION&nbsp;cl_khr_fp64&nbsp;:&nbsp;enable</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="font-style: italic;">//&nbsp;Helper&nbsp;function&nbsp;Morlet</span>
<br><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">Morlet(</span><span class="f_CodeExample" style="font-weight: bold;">const</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">t)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">return</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">exp(-t</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">t</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">0.5)</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">cos(M_2_PI</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">t);</span>
<br><span class="f_CodeExample">}</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="font-style: italic;">//&nbsp;OpenCL&nbsp;kernel&nbsp;function</span>
<br><span class="f_CodeExample">__kernel</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">void</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">Wavelet_GPU(__global</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*data,</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">int</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">datacount,</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">int</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">x_size,</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">int</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">y_size,</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">__global</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*result)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">size_t</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">i</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">get_global_id(0);</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">size_t</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">j</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">get_global_id(1);</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a1</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)10e-10;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a2</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)15.0;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">da</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(a2</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a1)</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)y_size;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">db</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">((</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)datacount</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)0.0)</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">x_size;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a1</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">+</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">j</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">da;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">b</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">0</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">+</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">i</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">db;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">B</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)1.0;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">B_inv</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)1.0</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">B;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a_inv</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)1.0</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">dt</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)1.0;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">coef</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample">)0.0;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">int</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">0;</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">datacount;</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k++)</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">arg</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(dt</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">b)</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a_inv;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">arg</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">-B_inv</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">arg</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">arg;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">coef</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">coef</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">+</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">exp(arg);</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">}</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">sum</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">float</span><span class="f_CodeExample">)0.0;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">int</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">0;</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">datacount;</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k++)</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold;">double</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">arg</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(dt</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">k</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">b)</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">a_inv;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">sum</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">+=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">data[k]</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">Morlet(arg);</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">}</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">sum</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">sum</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">coef;</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">uint</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">pos</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold;">int</span><span class="f_CodeExample">)(j</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">x_size</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">+</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">i);</span>
<br><span class="f_CodeExample" style="color: #ffffff;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">result[pos]</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;">&nbsp;</span><span class="f_CodeExample">sum;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Full information about the OpenCL syntax, built-in functions and principles of operation can be found on the official website of <a href="https://www.khronos.org/opencl/" target="_blank" class="weblink" title="OpenCL docs, specs, guides">Khronos Group</a>.</span></p>
<p class="p_Text"><span class="f_Text">In particular, it is interesting to note that OpenCL supports not only the usual scalar numeric data types (starting from </span><span class="f_Text" style="font-style: italic;">char</span><span class="f_Text"> and ending with </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text">) but also vector </span><span class="f_Text" style="font-style: italic;">(u)charN, (u)shortN, (u)intN, (u)longN, floatN, doubleN</span><span class="f_Text">, where N = {2|3|4|8|16} and denotes the length of the vector. In this example, this is not used.</span></p>
<p class="p_Text"><span class="f_Text">In addition to the mentioned keyword </span><span class="f_Text" style="font-style: italic;">kernel</span><span class="f_Text">, an important role in the organization of parallel computing is played by the </span><span class="f_Text" style="font-style: italic;">get_global_id</span><span class="f_Text"> function: it allows you to find in the code the number of the computational subtask that is currently running. Obviously, the calculations in different subtasks should be different (otherwise it would not make sense to use many cores). In this example, since the task involves the analysis of a two-dimensional image, it is more convenient to identify its fragments using two orthogonal coordinates. In the above code, we get them using two calls, </span><span class="f_Text" style="font-style: italic;">get_global_id(0)</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">get_global_id(1)</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Actually, we set the data dimension for the task ourselves when calling the MQL5 function </span><span class="f_Text" style="font-style: italic;">CLExecute</span><span class="f_Text"> (see further).</span></p>
<p class="p_Text"><span class="f_Text">In the file </span><span class="f_Text" style="font-style: italic;">Wavelet.mq5</span><span class="f_Text">, the OpenCL source code is included using the directive:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#resource</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Kernels/wavelet.cl&quot;</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">as</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">cl_program</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The image size is set by macros:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SIZE_X</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">600</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SIZE_Y</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">200</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">To manage OpenCL, the standard library with the class </span><span class="f_Text" style="font-style: italic;">COpenCL</span><span class="f_Text"> is used. Its methods have similar names and internally use the corresponding built-in OpenCL functions from the MQL5 API. It is suggested that you familiarize yourself with it.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#include</span><span class="f_CodeExample">&nbsp;&lt;</span><span class="f_CodeExample" style="color: #333333;">OpenCL</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">mqh</span><span class="f_CodeExample">&gt;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In a simplified form (without error checking and visualization), the MQL code that launches the transformation is shown below. Wavelet transform-related actions are summarized in the </span><span class="f_Text" style="font-style: italic;">CWavelet</span><span class="f_Text"> class.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">CWavelet</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_xsize</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;image&nbsp;dimensions&nbsp;along&nbsp;the&nbsp;axes</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_ysize</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_wavelet_data_GPU</span><span class="f_CodeExample">[];&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;result&nbsp;goes&nbsp;here</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">COpenCL</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;wrapper&nbsp;object</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The main parallel computing is organized by its method </span><span class="f_Text" style="font-style: italic;">CalculateWavelet_GPU</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">CWavelet</span><span class="f_CodeExample">::</span><span class="f_CodeExample" style="color: #333333;">CalculateWavelet_GPU</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">datacount</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">);&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;image&nbsp;size&nbsp;(number&nbsp;of&nbsp;dots)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;compile&nbsp;the&nbsp;cl-program&nbsp;according&nbsp;to&nbsp;its&nbsp;source&nbsp;code</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">Initialize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">cl_program</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;register&nbsp;a&nbsp;single&nbsp;kernel&nbsp;function&nbsp;from&nbsp;the&nbsp;cl&nbsp;file</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">SetKernelsCount</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">KernelCreate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Wavelet_GPU&quot;</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;register&nbsp;2&nbsp;buffers&nbsp;for&nbsp;input&nbsp;and&nbsp;output&nbsp;data,&nbsp;write&nbsp;the&nbsp;input&nbsp;array</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">SetBuffersCount</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">BufferFromArray</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">datacount</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">CL_MEM_READ_ONLY</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">BufferCreate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_xsize</span><span class="f_CodeExample">&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_ysize</span><span class="f_CodeExample">&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">sizeof</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">),&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">CL_MEM_READ_WRITE</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">SetArgumentBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">SetArgumentBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">4</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">m_wavelet_data_GPU</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_xsize</span><span class="f_CodeExample">&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_ysize</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">work</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;task&nbsp;of&nbsp;analyzing&nbsp;a&nbsp;two-dimensional&nbsp;image&nbsp;-&nbsp;hence&nbsp;the&nbsp;dimension&nbsp;2</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">offset</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">]&nbsp;=&nbsp;{</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">};&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;start&nbsp;from&nbsp;the&nbsp;very&nbsp;beginning&nbsp;(or&nbsp;you&nbsp;can&nbsp;skip&nbsp;something)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">work</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_xsize</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">work</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_ysize</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;set&nbsp;input&nbsp;data&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">SetArgument</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">datacount</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">SetArgument</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_xsize</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">SetArgument</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_ysize</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">GetTickCount</span><span class="f_CodeExample">();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;cutoff&nbsp;time&nbsp;for&nbsp;speed&nbsp;measurement</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;start&nbsp;computing&nbsp;on&nbsp;the&nbsp;GPU,&nbsp;two-dimensional&nbsp;task</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">Execute</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">offset</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">work</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;get&nbsp;results&nbsp;into&nbsp;output&nbsp;buffer</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">BufferRead</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_wavelet_data_GPU</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_xsize</span><span class="f_CodeExample">&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_ysize</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">GetTickCount</span><span class="f_CodeExample">()&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">m_OpenCL</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">Shutdown</span><span class="f_CodeExample">();&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;free&nbsp;all&nbsp;resources&nbsp;-&nbsp;call&nbsp;all&nbsp;necessary&nbsp;functions&nbsp;CL***Free</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the source code of the example, there is a commented out line calling </span><span class="f_Text" style="font-style: italic;">PreparePriceData</span><span class="f_Text"> to prepare an input array based on real prices: you can activate it instead of the previous line with the </span><span class="f_Text" style="font-style: italic;">PrepareModelData</span><span class="f_Text"> call (which generates an artificial number).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">momentum_period</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">8</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">price_data</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">momentum_data</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PrepareModelData</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">price_data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SIZE_X</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">momentum_period</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;PreparePriceData(&quot;EURUSD&quot;,&nbsp;PERIOD_M1,&nbsp;price_data,&nbsp;SIZE_X&nbsp;+&nbsp;momentum_period);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PrepareMomentumData</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">price_data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">momentum_data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">momentum_period</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;visualization&nbsp;of&nbsp;the&nbsp;series&nbsp;and&nbsp;increments</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">CWavelet</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">wavelet</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">time_gpu</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">wavelet</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">CalculateWavelet_GPU</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">momentum_data</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">time_gpu</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;visualization&nbsp;of&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;wavelet&nbsp;transform</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">A special set of error codes (with the ERR_OPENCL_ prefix, starting with code 5100, ERR_OPENCL_NOT_SUPPORTED) has been allocated for operations with OpenCL. The codes are described in the <a href="https://www.mql5.com/en/docs/constants/errorswarnings/errorcodes" target="_blank" class="weblink" title="Error codes in MQL5 Help">help</a>. If there are problems with the execution of OpenCL programs, the terminal outputs detailed diagnostics to the log, indicating error codes.</span></p>

</div>

</body>
</html>
