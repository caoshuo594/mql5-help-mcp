<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>7.5.6 Checking socket status</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part7.htm"> Part 7. Advanced language tools </a> / <a class="h_m" href="7_5_network.htm"> 7.5 Network functions </a>/ 7.5.6 Checking socket status
          </td>
          <td width="70" align="right">
          <a href="7_5_5_network_socket_create_connect.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="7_5_7_network_socket_timeouts.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">7.5.6 Checking socket status</span></p>
<p class="p_Text"><span class="f_Text">When working with a socket, it becomes necessary to check its status because distributed networks are not as reliable as a file system. In particular, the connection may be lost for one reason or another. The </span><span class="f_Text" style="font-style: italic;">SocketIsConnected</span><span class="f_Text"> function allows you to find this out.</span></p>
<p class="p_H4"><span class="f_H4">bool SocketIsConnected(const int socket)</span></p>
<p class="p_Text"><span class="f_Text">The function checks if the socket with the specified handle (obtained from </span><span class="f_Text" style="font-style: italic;"><a href="7_5_5_network_socket_create_connect.htm" class="topiclink">SocketCreate</a></span><span class="f_Text">) is connected to its network resource (specified in </span><span class="f_Text" style="font-style: italic;"><a href="7_5_5_network_socket_create_connect.htm" class="topiclink">Socket Connect</a></span><span class="f_Text">) and returns </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text"> in case of success.</span></p>
<p class="p_Text"><span class="f_Text">Another function, </span><span class="f_Text" style="font-style: italic;">SocketIsReadable</span><span class="f_Text">, lets you know if there is any data to read in the system buffer associated with the socket. This means that the computer, to which we connected at the network address, sent (and may continue to send) data to us.</span></p>
<p class="p_H4"><span class="f_H4">uint SocketIsReadable(const int socket)</span></p>
<p class="p_Text"><span class="f_Text">The function returns the number of bytes that can be read from the socket. In case of error, 0 is returned.</span></p>
<p class="p_Quote"><span class="f_Quote">Programmers familiar with the Windows/Linux socket system APIs know that a value of 0 can also be a normal state when there is no incoming data in the socket's internal buffer. However, this function behaves differently in MQL5. With an empty system socket buffer, it speculatively returns 1, deferring the actual check for data availability until the next call to one of the read functions. In particular, this situation with a dummy result of 1 byte occurs, as a rule, the first time a function is called on a socket when the receiving internal buffer is still empty.</span></p>
<p class="p_Text"><span class="f_Text">When executing this function, an error may occur, meaning that the connection established through </span><span class="f_Text" style="font-style: italic;">SocketConnect</span><span class="f_Text">, was broken (in </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> we will get code 5273, ERR_NETSOCKET_IO_ERROR).</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">SocketIsReadable</span><span class="f_Text"> function is useful in programs that are designed for &quot;non-blocking&quot; reading of data using </span><span class="f_Text" style="font-style: italic;"><a href="7_5_8_network_socket_send_read.htm" class="topiclink">SocketRead</a></span><span class="f_Text">. The point is that the </span><span class="f_Text" style="font-style: italic;">SocketRead</span><span class="f_Text"> function when there is no data in the receive buffer, will wait for their arrival, suspending the execution of the program (by the specified timeout value).</span></p>
<p class="p_Text"><span class="f_Text">On the other hand, a blocking read is more reliable in the sense that your program will &quot;wake up&quot; as soon as new data arrives, but checking for their presence with </span><span class="f_Text" style="font-style: italic;">SocketIsReadable</span><span class="f_Text"> needs to be done periodically, according to some other events (usually, on a timer or in a loop).</span></p>
<p class="p_Text"><span class="f_Text">Particular care should be taken when using the </span><span class="f_Text" style="font-style: italic;">SocketIsReadable</span><span class="f_Text"> function in <a href="7_5_10_network_socket_tls_send_read.htm" class="topiclink">TLS secure mode</a>. The function returns the amount of &quot;raw&quot; data, which in TLS mode is an encrypted block. If the &quot;raw&quot; data has not yet been accumulated in the size of the decryption block, then the subsequent call of the read function </span><span class="f_Text" style="font-style: italic;"><a href="7_5_10_network_socket_tls_send_read.htm" class="topiclink">SocketTlsRead</a></span><span class="f_Text"> will block program execution, waiting for the missing fragment. If the &quot;raw&quot; data already contains a block ready for decryption, the read function will return fewer decrypted bytes than the number of &quot;raw&quot; bytes. In this regard, with TLS enabled, it is recommended to always use the </span><span class="f_Text" style="font-style: italic;">SocketIsReadable</span><span class="f_Text"> function in conjunction with </span><span class="f_Text" style="font-style: italic;"><a href="7_5_10_network_socket_tls_send_read.htm" class="topiclink">SocketTlsReadAvailable</a></span><span class="f_Text">. Otherwise, the behavior of the program will differ from what is expected. Unfortunately, MQL5 does not provide the </span><span class="f_Text" style="font-style: italic;">SocketTlsIsReadable</span><span class="f_Text"> function, which is compatible with the TLS mode and does not impose the described conventions.</span></p>
<p class="p_Text"><span class="f_Text">The similar </span><span class="f_Text" style="font-style: italic;">SocketIsWritable</span><span class="f_Text"> function checks if the given socket can be written to at the current time.</span></p>
<p class="p_H4"><span class="f_H4">bool SocketIsWritable(const int socket)</span></p>
<p class="p_Text"><span class="f_Text">The function returns an indication of success (</span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">) or error (</span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">). In the latter case, the connection established through </span><span class="f_Text" style="font-style: italic;">SocketConnect</span><span class="f_Text"> will be broken.</span></p>
<p class="p_Text"><span class="f_Text">Here is a simple script </span><span class="f_Text" style="font-style: italic;">SocketIsConnected.mq5</span><span class="f_Text"> to test the functions. In the input parameters, we will provide the opportunity to enter the address and port.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Server</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;www.mql5.com&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Port</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">443</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> handler, we create a socket, connect to the site, and start checking the status of the socket in a loop. After the second iteration, we forcibly close the socket, and this should lead to an exit from the loop.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Server</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">Port</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">socket</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">SocketCreate</span><span class="f_CodeExample">());</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">SocketConnect</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">socket</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Server</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Port</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">5000</span><span class="f_CodeExample">)))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">while</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">SocketIsConnected</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">socket</span><span class="f_CodeExample">))&nbsp;&amp;&amp;&nbsp;!</span><span class="f_CodeExample" style="color: #0000ff;">IsStopped</span><span class="f_CodeExample">())</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">SocketIsReadable</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">socket</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">SocketIsWritable</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">socket</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Sleep</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">1000</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(++</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&gt;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">SocketClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">socket</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The following entries are displayed in the log.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Server=www.mql5.com&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">Port=443&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketCreate()=1&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketConnect(socket,Server,Port,5000)=true&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketIsConnected(socket)=true&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketIsReadable(socket)=0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketIsWritable(socket)=true&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketIsConnected(socket)=true&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketIsReadable(socket)=0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketIsWritable(socket)=true&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketClose(socket)=true&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">SocketIsConnected(socket)=false&nbsp;/&nbsp;NETSOCKET_INVALIDHANDLE(5270)</span></p>
</td>
</tr>
</table>
</div>

</div>

</body>
</html>
