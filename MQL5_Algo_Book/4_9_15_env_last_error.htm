<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>4.9.15 Handling Runtime Errors</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part4.htm"> Part 4. Common APIs </a> / <a class="h_m" href="4_9_environment.htm"> 4.9 MQL program execution environment </a>/ 4.9.15 Handling runtime errors
          </td>
          <td width="70" align="right">
          <a href="4_9_14_env_terminal_close.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="4_9_16_env_user_error.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">4.9.15 Handling runtime errors</span></p>
<p class="p_Text"><span class="f_Text">Any program written correctly enough to compile without errors is still not immune to runtime errors. They can occur both due to an oversight of the developer and due to unforeseen circumstances that have arisen in the software environment (such as Internet connection loss, running out of memory, etc.). But no less likely is the situation when the error occurs due to incorrect application of the program. In all these cases, the program must be able to analyze the essence of the problem and process it adequately.</span></p>
<p class="p_Text"><span class="f_Text">Each MQL5 statement is a potential source of runtime errors. If such an error occurs, the terminal saves a descriptive code to the special </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> variable. Make sure to analyze the code immediately after each statement, since potential errors in subsequent statements can overwrite this value.</span></p>
<p class="p_Text"><span class="f_Text">Please note that there are a number of critical errors that will immediately abort program execution when they occur:</span></p>
<ul>
<li class="p_li"><span class="f_li">Zero divide</span></li>
<li class="p_li"><span class="f_li">Index out of range</span></li>
<li class="p_li"><span class="f_li">Incorrect object pointer</span></li>
</ul>
<p class="p_Text"><span class="f_Text">For a complete list of error codes and what they mean, see the <a href="https://www.mql5.com/en/docs/constants/errorswarnings/errorcodes" target="_blank" class="weblink" title="Error codes on mql5.com">documentation</a>.</span></p>
<p class="p_Text"><span class="f_Text">In the <a href="4_5_3_files_open_close.htm" class="topiclink">Opening and closing files</a> section, we've already addressed the problem of diagnosing errors as part of writing a useful PRTF macro. There, in particular, we have seen an auxiliary header file </span><span class="f_Text" style="font-style: italic;">MQL5/Include/MQL5Book/MqlError.mqh</span><span class="f_Text">, in which the MQL_ERROR enumeration allow easy conversion of the numeric error code into a name using </span><span class="f_Text" style="font-style: italic;">EnumToString</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">enum</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">MQL_ERROR</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SUCCESS</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">INTERNAL_ERROR</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">4001</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WRONG_INTERNAL_PARAMETER</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">4002</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">INVALID_PARAMETER</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">4003</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">NOT_ENOUGH_MEMORY</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">4004</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample" style="color: #808080;">&nbsp;&nbsp;&nbsp;//&nbsp;start&nbsp;of&nbsp;area&nbsp;for&nbsp;errors&nbsp;defined&nbsp;by&nbsp;the&nbsp;programmer&nbsp;(see&nbsp;next&nbsp;section)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">USER_ERROR_FIRST</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">65536</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">E2S</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">EnumToString</span><span class="f_CodeExample">((</span><span class="f_CodeExample" style="color: #333333;">MQL_ERROR</span><span class="f_CodeExample">)(</span><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">))</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here, as the </span><span class="f_Text" style="font-style: italic;">X</span><span class="f_Text"> parameter of the </span><span class="f_Text" style="font-style: italic;">E2S</span><span class="f_Text"> macro, we should have the </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> variable or its equivalent </span><span class="f_Text" style="font-style: italic;">GetLastError</span><span class="f_Text"> function.</span></p>
<p class="p_H4"><span class="f_H4">int GetLastError() &#8801; int _LastError</span></p>
<p class="p_Text"><span class="f_Text">The function returns the code of the last error that occurred in the MQL program statements. Initially, while there are no errors, the value is 0. The difference between reading </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> and calling the </span><span class="f_Text" style="font-style: italic;">GetLastError</span><span class="f_Text"> function is purely syntactic (choose the appropriate option in accordance with the preferred style).</span></p>
<p class="p_Text"><span class="f_Text">It should be borne in mind that regular error-free execution of statements does not reset the error code. Calling </span><span class="f_Text" style="font-style: italic;">GetLastError</span><span class="f_Text"> also does not do it.</span></p>
<p class="p_Text"><span class="f_Text">Thus, if there is a sequence of actions, in which only one will set an error flag, this flag will be returned by the function for subsequent (successful) actions. For example,</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #808080;">//&nbsp;_LastError&nbsp;=&nbsp;0&nbsp;by&nbsp;default</span>
<br><span class="f_CodeExample">action</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;ok,&nbsp;_LastError&nbsp;doe&nbsp;not&nbsp;change</span>
<br><span class="f_CodeExample">action</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;error,&nbsp;_LastError&nbsp;=&nbsp;X</span>
<br><span class="f_CodeExample">action</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;ok,&nbsp;_LastError&nbsp;does&nbsp;not&nbsp;change,&nbsp;i.e.&nbsp;is&nbsp;still&nbsp;equal&nbsp;to&nbsp;X</span>
<br><span class="f_CodeExample">action</span><span class="f_CodeExample" style="color: #333333;">4</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;another&nbsp;error,&nbsp;_LastError&nbsp;=&nbsp;Y</span>
<br><span class="f_CodeExample">action</span><span class="f_CodeExample" style="color: #333333;">5</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;ok,&nbsp;_LastError&nbsp;does&nbsp;not&nbsp;change,&nbsp;that&nbsp;is,&nbsp;it&nbsp;is&nbsp;still&nbsp;equal&nbsp;to&nbsp;Y</span>
<br><span class="f_CodeExample">action</span><span class="f_CodeExample" style="color: #333333;">6</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;ok,&nbsp;_LastError&nbsp;does&nbsp;not&nbsp;change,&nbsp;that&nbsp;is,&nbsp;it&nbsp;is&nbsp;still&nbsp;equal&nbsp;to&nbsp;Y</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This behavior would make it difficult to localize the problem area. To avoid this, there is a separate </span><span class="f_Text" style="font-style: italic;">ResetLastError</span><span class="f_Text"> function that resets the </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> variable to 0.</span></p>
<p class="p_H4"><span class="f_H4">void ResetLastError()</span></p>
<p class="p_Text"><span class="f_Text">The function sets the value of the built-in </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> variable to zero.</span></p>
<p class="p_Text"><span class="f_Text">It is recommended to call the function before any action that can lead to an error and after which you are going to analyze errors using </span><span class="f_Text" style="font-style: italic;">GetLastError</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">A good example of using both functions is the already mentioned PRTF macro (PRTF.mqh file). Its code is shown below:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#include</span><span class="f_CodeExample">&nbsp;&lt;</span><span class="f_CodeExample" style="color: #333333;">MQL5Book</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">MqlError</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">mqh</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">A</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ResultPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">#A</span><span class="f_CodeExample">,&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">A</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">template</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ResultPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">retval</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">NULL</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">snapshot</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #800080;">_LastError</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;recording&nbsp;_LastError&nbsp;at&nbsp;input</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">err</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">E2S</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">snapshot</span><span class="f_CodeExample">)&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;(&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">snapshot</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;)&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;=&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">retval</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;/&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">snapshot</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">&nbsp;?&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;ok&quot;</span><span class="f_CodeExample">&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">err</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ResetLastError</span><span class="f_CodeExample">();&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;clear&nbsp;the&nbsp;error&nbsp;flag&nbsp;for&nbsp;the&nbsp;next&nbsp;calls</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">retval</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The purpose of the macro and of the </span><span class="f_Text" style="font-style: italic;">ResultPrint</span><span class="f_Text"> function wrapped into it is to log the passed value, which is the current error code, and to immediately clear the error code. Thus, successive application of PRTF on a number of statements always ensures that the error (or success indication) printed to the log corresponds to the last statement with which the value of the </span><span class="f_Text" style="font-style: italic;">retval</span><span class="f_Text"> parameter was obtained.</span></p>
<p class="p_Text"><span class="f_Text">We need to save </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> in the intermediate local variable </span><span class="f_Text" style="font-style: italic;">snapshot</span><span class="f_Text"> because </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> can change its value almost anywhere in the evaluation of an expression if any operation fails. In this particular example, the E2S macro uses the </span><span class="f_Text" style="font-style: italic;">EnumToString</span><span class="f_Text"> function which may raise its own error code if a value that is not in the enumeration is passed as an argument. Then, in the subsequent parts of the same expression, when forming a string, we will see not the initial error but the raised one.</span></p>
<p class="p_Text"><span class="f_Text">There may be several places in any statement where </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> suddenly changes. In this regard, it is desirable to record the error code immediately after the desired action.</span></p>

</div>

</body>
</html>
