<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>5.9 Interactive events on charts</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part5.htm"> Part 5. Creating application programs </a>/ 5.9 Interactive events on charts
          </td>
          <td width="70" align="right">
          <a href="5_8_30_objects_get_time_value.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="5_9_1_events_onchartevent.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H2"><span class="f_H2">5.9 Interactive events on charts</span></p>
<p class="p_Text"><span class="f_Text">MetaTrader 5 charts not only provide a visual representation of data and are the execution environment for MQL programs, but also support the mechanism of interactive events, which allows programs to respond to the actions of the user and other programs. This is done by a special event type – </span><span class="f_Text" style="font-style: italic;">OnChartEvent</span><span class="f_Text"> – which we already discussed in the <a href="5_1_3_runtime_events_overview.htm" class="topiclink">Overview of event handling functions</a>.</span></p>
<p class="p_Text"><span class="f_Text">Any indicator or Expert Advisor can receive such events provided that the event processing function of the same name with a predefined signature is described in the code. In some of the indicator examples that we considered earlier, we have already had to take advantage of this opportunity. In this chapter, we will look at the event system in detail.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">OnChartEvent</span><span class="f_Text"> event is generated by the client terminal during the following chart manipulations performed by the user:</span></p>
<ul>
<li class="p_li"><span class="f_li">Changing the chart size or settings</span></li>
<li class="p_li"><span class="f_li">Keystrokes when the chart window is in focus</span></li>
<li class="p_li"><span class="f_li">Mouse cursor movement</span></li>
<li class="p_li"><span class="f_li">Mouse clicks on the chart</span></li>
<li class="p_li"><span class="f_li">Mouse clicks on graphical objects</span></li>
<li class="p_li"><span class="f_li">Creating a graphical object</span></li>
<li class="p_li"><span class="f_li">Deleting a graphical object</span></li>
<li class="p_li"><span class="f_li">Moving a graphical object with the mouse</span></li>
<li class="p_li"><span class="f_li">Finishing to edit the test in the input field of the OBJ_EDIT object</span></li>
</ul>
<p class="p_Text"><span class="f_Text">The MQL program receives the listed events only from the chart on which it is running. Like other event types, they are added to a queue. All events are then processed one by one in the order of arrival. If there is already an </span><span class="f_Text" style="font-style: italic;">OnChartEvent </span><span class="f_Text">event of a particular type in the MQL program queue or it is being processed, a new event of the same type is not queued (discarded).</span></p>
<p class="p_Text"><span class="f_Text">Some event types are always active, while others are disabled by default and must be explicitly enabled by setting the appropriate chart properties using the </span><span class="f_Text" style="font-style: italic;"><a href="5_7_5_charts_properties_overview.htm" class="topiclink">ChartSetInteger</a></span><span class="f_Text"> call. Such disabled events include, in particular, mouse movements and mouse wheel scrolling. All of them are characterized by the fact that they can generate massive event streams, and in order to save resources, it is recommended to enable them only when necessary.</span></p>
<p class="p_Text"><span class="f_Text">In addition to standard events, there is the concept of &quot;custom events&quot;. The meaning and content of parameters for such events are assigned and interpreted by the MQL program itself (one or several, if we are talking about the interaction of a complex of programs). An MQL program can send &quot;user events&quot; to a chart (including another one) using the function </span><span class="f_Text" style="font-style: italic;"><a href="5_9_7_events_custom.htm" class="topiclink">EventChartCustom</a></span><span class="f_Text">. Such events are also handled by the </span><span class="f_Text" style="font-style: italic;">OnChartEvent</span><span class="f_Text"> function.</span></p>
<p class="p_Text"><span class="f_Text">If there are several MQL programs on the chart with the </span><span class="f_Text" style="font-style: italic;">OnChartEvent</span><span class="f_Text"> handler, they will all receive the same stream of events.</span></p>
<p class="p_Quote"><span class="f_Quote">All MQL programs run in threads other than the main thread of the application. The main terminal thread is responsible for processing all Windows system messages, and as a result of this processing, in turn, it generates Windows messages for its own application. For example, dragging a chart with the mouse generates several WM_MOUSE_MOVE system messages (in terms of the Windows API) for subsequent drawing of the application window, and also sends internal messages to Expert Advisors and indicators launched on this chart. In this case, a situation may arise that the main thread of the application has not yet managed to process the system message about redrawing the WM_PAINT window (and therefore has not yet changed the appearance of the chart), and the Expert Advisor or indicator has already received an event about moving the mouse cursor. Then the chart property <a href="5_7_12_charts_scale_time.htm" class="topiclink">CHART_FIRST_VISIBLE_BAR</a> will be changed only after the chart is drawn.</span></p>
<p class="p_Text"><span class="f_Text">Since of the two types of interactive MQL programs, we have studied only indicators so far, all the examples in this chapter will be built on the basis of indicators. The second type, Expert Advisors, will be described in the next Part of the book. However, the principles of working with events in them completely coincide with those presented here.</span></p>

</div>

</body>
</html>
