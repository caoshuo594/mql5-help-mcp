<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>4.5.3 Opening and closing files</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part4.htm"> Part 4. Common APIs </a> / <a class="h_m" href="4_5_files.htm"> 4.5 Working with files </a>/ 4.5.3 Opening and closing files
          </td>
          <td width="70" align="right">
          <a href="4_5_2_files_save_load.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="4_5_4_files_handles.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">4.5.3 Opening and closing files</span></p>
<p class="p_Text"><span class="f_Text">To write and read data from a file, most MQL5 functions require that the file be opened first. For this purpose, there is the </span><span class="f_Text" style="font-style: italic;">FileOpen</span><span class="f_Text"> function. After performing the required operations, the open file should be closed using the </span><span class="f_Text" style="font-style: italic;">FileClose</span><span class="f_Text"> function. The fact is that an open file may, depending on the applied options, be blocked for access from other programs. In addition, file operations are buffered in memory (cache) for performance reasons, and without closing the file, new data may not be physically uploaded to it for some time. This is especially critical if the data being written is waiting for an external program (for example, when integrating an MQL program with other systems). We learn about an alternative way to flush the buffer to disk from the description of the </span><span class="f_Text" style="font-style: italic;"><a href="4_5_12_files_flush.htm" class="topiclink">FileFlush</a></span><span class="f_Text"> function.</span></p>
<p class="p_Text"><span class="f_Text">A special integer referred to as the descriptor is associated with an open file in an MQL program. It is returned by the </span><span class="f_Text" style="font-style: italic;">FileOpen</span><span class="f_Text"> function. All operations related to accessing or modifying the internal contents of a file require this identifier to be specified in the corresponding API functions. Those functions that operate on the entire file (copy, delete, move, check for existence) do not require a descriptor. You do not need to open the file to perform these steps.</span></p>
<p class="p_H4"><span class="f_H4" style="letter-spacing: -1px;">int FileOpen(const string filename, int flags, const short delimiter = '\t', uint codepage = CP_ACP)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4" style="letter-spacing: -1px;">int FileOpen(const string filename, int flags, const string delimiter, uint codepage = CP_ACP)</span></p>
<p class="p_Text"><span class="f_Text">The function opens a file with the specified name, in the mode specified by the </span><span class="f_Text" style="font-style: italic;">flags</span><span class="f_Text"> parameter. The </span><span class="f_Text" style="font-style: italic;">filename</span><span class="f_Text"> parameter may contain subfolders before the actual file name. In this case, if the file is opened for writing and the required folder hierarchy does not yet exist, it will be created.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">flags</span><span class="f_Text"> parameter must contain a combination of constants describing the required mode of working with the file. The combination is performed using the operations of <a href="2_5_7_operators_bitwise.htm" class="topiclink">bitwise OR</a>. Below is a table of available constants.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table" style="width:15%;"><p class="p_BoldTitlesInTables" style="text-align: right;"><span class="f_BoldTitlesInTables">Value</span></p>
</th>
<th class="table" style="width:60%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_READ</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">1</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">The file is opened for reading</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_WRITE</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">2</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">The file is opened for writing</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_BIN</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">4</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">Binary read-write mode, no data conversion from string to string</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_CSV</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">8</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">File of CSV type; the data being written is converted to text of the appropriate type (Unicode or ANSI, see below), and when reading, the reverse conversion is performed from the text to the required type (specified in the reading function); one CSV record is a single line of text, delimited by newline characters (usually CRLF); inside the CSV record, the elements are separated by a delimiter character (parameter </span><span class="f_fortable" style="font-style: italic;">delimiter</span><span class="f_fortable">);</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_TXT</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">16</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">Plain text file, similar to CSV mode, but a delimiter character is not used (the value of the parameter </span><span class="f_fortable" style="font-style: italic;">delimiter</span><span class="f_fortable"> is ignored)</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_ANSI</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">32</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">ANSI type strings (single-byte characters)</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_UNICODE</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">64</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">Unicode type strings (double-byte characters)</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_SHARE_READ</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">128</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">Shared read access from several programs</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_SHARE_WRITE</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">256</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">Shared writing access by multiple programs</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_REWRITE</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">512</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">Permission to overwrite a file (if it already exists) in functions <a href="4_5_14_files_copy_move.htm" class="topiclink">FileCopy</a> and <a href="4_5_14_files_copy_move.htm" class="topiclink">FileMove</a></span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">FILE_COMMON</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable" style="text-align: right;"><span class="f_fortable">4096</span></p>
</td>
<td class="table" style="width:60%;"><p class="p_fortable"><span class="f_fortable">File location in the shared folder of all client terminals /Terminal/Common/Files (the flag is used when opening files (FileOpen), copying files (FileCopy, FileMove) and checking the existence of files (<a href="4_5_13_files_exist_delete.htm" class="topiclink">FileIsExist</a>))</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">When opening a file, one of the FILE_WRITE, FILE_READ flags or their combination must be specified.</span></p>
<p class="p_Text"><span class="f_Text">The FILE_SHARE_READ and FILE_SHARE_WRITE flags do not replace or cancel the need to specify the FILE_READ and FILE_WRITE flags.</span></p>
<p class="p_Quote"><span class="f_Quote">The MQL program execution environment always buffers files for reading, which is equivalent to implicitly adding the FILE_READ flag. Because of this, FILE_SHARE_READ should always be used to work properly with shared files (even if another process is known to have a write-only file open).</span></p>
<p class="p_Text"><span class="f_Text">If none of the FILE_CSV, FILE_BIN, FILE_TXT flags is specified, FILE_CSV is assumed as the highest priority. If more than one of these three flags is specified, the highest priority passed is applied (they are listed above in descending order of priority).</span></p>
<p class="p_Text"><span class="f_Text">For text files, the default mode is FILE_UNICODE.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">delimiter</span><span class="f_Text"> parameter affecting only CSV, could be of type </span><span class="f_Text" style="font-style: italic;">ushort</span><span class="f_Text"> or </span><span class="f_Text" style="font-style: italic;">string</span><span class="f_Text">. In the second case, if the length of the string is greater than 1, only its first character will be used.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">codepage</span><span class="f_Text"> parameter only affects files opened in text mode (FILE_TXT or FILE_CSV), and only if FILE_ANSI mode is selected for strings. If the strings are stored in Unicode (FILE_UNICODE), the code page is not important.</span></p>
<p class="p_Text"><span class="f_Text">If successful, the function returns a file descriptor, a positive integer. It is unique only within a particular MQL program; it makes no sense to share it with other programs. For further work with the file, the descriptor is passed to calls to other functions.</span></p>
<p class="p_Text"><span class="f_Text">On error, the result is INVALID_HANDLE (-1). The essence of the error should be clarified from the code returned by the </span><span class="f_Text" style="font-style: italic;"><a href="4_9_15_env_last_error.htm" class="topiclink">GetLastError</a></span><span class="f_Text"> function.</span></p>
<p class="p_Text"><span class="f_Text">All operating mode settings made at the time the file is opened remain unchanged for as long as the file is open. If it becomes necessary to change the mode, the file should be closed and reopened with the new parameters.</span></p>
<p class="p_Text"><span class="f_Text">For each open file, the MQL program execution environment maintains an internal pointer, i.e. the current position within the file. Immediately after opening the file, the pointer is set to the beginning (position 0). In the process of writing or reading, the position is shifted appropriately, according to the amount of data transmitted or received from various file functions. It is also possible to directly influence the position (move back or forward). All these opportunities will be discussed in the following sections.</span></p>
<p class="p_Text"><span class="f_Text">FILE_READ and FILE_WRITE in various combinations allow you to achieve several scenarios:</span></p>
<ul>
<li class="p_li"><span class="f_li">FILE_READ – open a file only if it exists; otherwise, the function returns an error and no new file is created.</span></li>
<li class="p_li"><span class="f_li">FILE_WRITE – creating a new file if it does not already exist, or opening an existing file, and its contents are cleared and the size is reset to zero.</span></li>
<li class="p_li"><span class="f_li">FILE_READ|FILE_WRITE – open an existing file with all its contents or create a new file if it does not already exist.</span></li>
</ul>
<p class="p_Text"><span class="f_Text">As you can see, some scenarios are inaccessible only due to flags. In particular, you cannot open a file for writing only if it already exists. This can be achieved using additional functions, for example, </span><span class="f_Text" style="font-style: italic;"><a href="4_5_13_files_exist_delete.htm" class="topiclink">FileIsExist</a></span><span class="f_Text">. Also, it will not be possible to &quot;automatically&quot; reset a file opened for a combination of reading and writing: in this case, MQL5 always leaves the contents.</span></p>
<p class="p_Text"><span class="f_Text">To append data to a file, one must not only open the file in FILE_READ|FILE_WRITE mode, but also move the current position within the file to its end by calling </span><span class="f_Text" style="font-style: italic;"><a href="4_5_10_files_cursor.htm" class="topiclink">FileSeek</a></span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">The correct description of the shared access to the file is a prerequisite for successful execution of </span><span class="f_Text" style="font-style: italic;">File Open</span><span class="f_Text">. This aspect is managed as follows.</span></p>
<ul>
<li class="p_li"><span class="f_li">If neither of the FILE_SHARE_READ and FILE_SHARE_WRITE flags is specified, then the current program gets exclusive access to the file if it opens it first. If the same file has already been opened by someone before (by another program,or by the same program), the function call will fail.</span></li>
<li class="p_li"><span class="f_li">When the FILE_SHARE_READ flag is set, the program allows subsequent requests to open the same file for reading. If at the time of the function call the file is already open for reading by another or the same program, and this flag is not set, the function will fail.</span></li>
<li class="p_li"><span class="f_li">When the FILE_SHARE_WRITE flag is set, the program allows subsequent requests to open the same file for writing. If at the time of the function call the file is already open for writing by another or the same program, and this flag is not set, the function will fail.</span></li>
</ul>
<p class="p_Text"><span class="f_Text">Access sharing is checked not only in relation to other MQL programs or processes external to MetaTrader 5, but also in relation to the same MQL program if it reopens the file.</span></p>
<p class="p_Text"><span class="f_Text">Thus, the least conflicting mode implies that both flags are specified, but it still does not guarantee that the file will be opened if someone has already been issued a descriptor to it with no sharing. However, more stringent rules should be followed depending on the planned reads or writes.</span></p>
<p class="p_Text"><span class="f_Text">For example, when opening a file for reading, it makes sense to leave the opportunity for others to read it. Additionally, you can probably allow others to write to it, if it is a file that is being replenished (for example, a journal). However, when opening a file for writing, it is hardly worth leaving write access to others: this would lead to unpredictable data overlay. &nbsp;</span></p>
<p class="p_H4"><span class="f_H4">void FileClose(int handle)</span></p>
<p class="p_Text"><span class="f_Text">The function closes a previously opened file by its handle.</span></p>
<p class="p_Text"><span class="f_Text">After the file is closed, its handle in the program becomes invalid: an attempt to call any file function on it will result in an error. However, you can use the same variable to store a different handle if you reopen the same or a different file.</span></p>
<p class="p_Text"><span class="f_Text">When the program terminates, open files are forcibly closed, and the write buffer, if it is not empty, is written to disk. However, it is recommended to close files explicitly.</span></p>
<p class="p_Text"><span class="f_Text">Closing a file when you're finished working with it is an important rule to follow. This is due not only to the caching of the information being written, which may remain in RAM for some time and not saved to disk (as already mentioned above), if the file is not closed. In addition, an open file consumes some internal resource of the operating system, and we are not talking about disk space. The number of simultaneously open files is limited (maybe several hundred or thousands depending on Windows settings). If many programs keep a large number of files open, this limit may be reached and attempts to open new files will fail.</span></p>
<p class="p_Text"><span class="f_Text">In this regard, it is desirable to protect yourself from the possible loss of descriptors using a wrapper class that would open a file and receive a descriptor when creating an object, and the descriptor would be released and the file closed automatically in the destructor.</span></p>
<p class="p_Text"><span class="f_Text">We will create a wrapper class after testing the pure </span><span class="f_Text" style="font-style: italic;">FileOpen</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">FileClose</span><span class="f_Text"> functions.</span></p>
<p class="p_Text"><span class="f_Text">But before diving into file specifics, let's prepare a new version of the macro to illustrate an output of our functions to the call log. The new version was required because, until now, macros like PRT and PRTS (used in previous sections) &quot;absorbed&quot; function return values during printing. For example, we wrote:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #ff0000;">PRT</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileLoad</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">filename</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">read</span><span class="f_CodeExample">));</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here the result of the </span><span class="f_Text" style="font-style: italic;">FileLoad</span><span class="f_Text"> call is sent to the log, but it is not possible to get it in the calling string of code. To tell the truth, we did not need it. But now the </span><span class="f_Text" style="font-style: italic;">FileOpen</span><span class="f_Text"> function will return a file descriptor, and should be stored in a variable for further manipulation of the file.</span></p>
<p class="p_Text"><span class="f_Text">There are two problems with the old macros. First, they are based on the function </span><span class="f_Text" style="font-style: italic;">Print</span><span class="f_Text">, which consumes the passed data (sending it to the log) but does not itself return anything. Second, any value for a variable with a result can only be obtained from an expression, and a </span><span class="f_Text" style="font-style: italic;">Print</span><span class="f_Text"> call cannot be made a part of an expression due to the fact that it has the type </span><span class="f_Text" style="font-style: italic;">void</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">To solve these problems, we need a print helper function that returns a printable value. And we will pack its call into a new PRTF macro:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#include</span><span class="f_CodeExample">&nbsp;&lt;</span><span class="f_CodeExample" style="color: #333333;">MQL5Book</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">MqlError</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">mqh</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">A</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ResultPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">#A</span><span class="f_CodeExample">,&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">A</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">template</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ResultPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">retval</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">err</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">E2S</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">_LastError</span><span class="f_CodeExample">)&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;(&quot;</span><span class="f_CodeExample">&nbsp;+&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #0000ff;">_LastError</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;)&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;=&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">retval</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;/&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">_LastError</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">&nbsp;?&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;ok&quot;</span><span class="f_CodeExample">&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">err</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ResetLastError</span><span class="f_CodeExample">();</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;clear&nbsp;the&nbsp;error&nbsp;flag&nbsp;for&nbsp;the&nbsp;next&nbsp;call</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">retval</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Using the '#' magic string conversion operator, we get a detailed descriptor of the code fragment (expression A) that is passed as the first argument to </span><span class="f_Text" style="font-style: italic;">ResultPrint</span><span class="f_Text">. The expression itself (the macro argument) is evaluated (if there is a function, it is called), and its result is passed as the second argument to </span><span class="f_Text" style="font-style: italic;">ResultPrint</span><span class="f_Text">. Next, the usual Print function comes into play, and finally, the same result is returned to the calling code.</span></p>
<p class="p_Text"><span class="f_Text">In order not to look into the Help for decoding error codes, an E2S macro was prepared that uses the MQL_ERROR enumeration with all MQL5 errors. It can be found in the header file </span><span class="f_Text" style="font-style: italic;">MQL5/Include/MQL5Book/MqlError.mqh</span><span class="f_Text">. The new macro and the </span><span class="f_Text" style="font-style: italic;">ResultPrint</span><span class="f_Text"> function are defined in the PRTF.mqh file, next to the test scripts.</span></p>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">FileOpenClose.mq5 </span><span class="f_Text">script, let's try to open different files, and, in particular, the same file will open several times in parallel. This is usually avoided in real programs. A single handle to a particular file in a program instance is sufficient for most tasks.</span></p>
<p class="p_Text"><span class="f_Text">One of the files, </span><span class="f_Text" style="font-style: italic;">MQL5Book/rawdata</span><span class="f_Text">, must already exist since it was created by a script from the section <a href="4_5_2_files_save_load.htm" class="topiclink">Writing and reading files in simplified mode</a>. Another file will be created during the test.</span></p>
<p class="p_Text"><span class="f_Text">We will choose the file type FILE_BIN. working with FILE_TXT or FILE_CSV would be similar at this stage.</span></p>
<p class="p_Text"><span class="f_Text">Let's reserve an array for file descriptors so that at the end of the script we close all files at once.</span></p>
<p class="p_Text"><span class="f_Text">First, let's open </span><span class="f_Text" style="font-style: italic;">MQL5Book/rawdata</span><span class="f_Text"> in reading mode without access sharing. Assuming that the file is not in use by any third party application, we can expect the handle to be successfully received.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">4</span><span class="f_CodeExample">]&nbsp;=&nbsp;{};&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;array&nbsp;for&nbsp;test&nbsp;file&nbsp;handles&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;this&nbsp;file&nbsp;must&nbsp;exist&nbsp;after&nbsp;running&nbsp;FileSaveLoad.mq5</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rawdata</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/rawdata&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">rawdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1&nbsp;/&nbsp;ok</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">If we try to open the same file again, we will encounter an error because neither the first nor the second call allows sharing.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">rawdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;-1&nbsp;/&nbsp;CANNOT_OPEN_FILE(5004)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Let's close the first handle, open the file again, but with shared read permissions, and make sure that reopening now works (although it also needs to allow shared reading):</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">rawdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_SHARE_READ</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">rawdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_SHARE_READ</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;2&nbsp;/&nbsp;ok</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Opening a file for writing (FILE_WRITE) will not work, because the two previous calls of </span><span class="f_Text" style="font-style: italic;">FileOpen</span><span class="f_Text"> only allow FILE_SHARE_READ.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">rawdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_SHARE_READ</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;-1&nbsp;/&nbsp;CANNOT_OPEN_FILE(5004)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Now let's try to create a new file </span><span class="f_Text" style="font-style: italic;">MQL5Book/newdata</span><span class="f_Text">. If you open it as read-only, the file will not be created.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">newdata</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/newdata&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">newdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;-1&nbsp;/&nbsp;CANNOT_OPEN_FILE(5004)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">To create a file, you must specify the FILE_WRITE mode (the presence of FILE_READ is not critical here, but it makes the call more universal: as we remember, in this combination, the instruction guarantees that either the old file will be opened, if it exists, or a new one will be created).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">newdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;3&nbsp;/&nbsp;ok</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Let's try to write something to a new file using the function </span><span class="f_Text" style="font-style: italic;"><a href="4_5_2_files_save_load.htm" class="topiclink">FileSave</a></span><span class="f_Text"> known to us. It acts as an &quot;external player&quot;, since it works with the file bypassing our descriptor, in much the same way as it could be done by another MQL program or a third-party application.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">]&nbsp;=&nbsp;{</span><span class="f_CodeExample" style="color: #333333;">0x123456789ABCDEF0</span><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileSave</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">newdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;false</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This call fails because the handle was opened without sharing permissions. Close and reopen the file with maximum &quot;permissions&quot;.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">newdata</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_BIN&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_SHARE_READ&nbsp;</span><span class="f_CodeExample">|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_SHARE_WRITE</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;3&nbsp;/&nbsp;ok</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This time </span><span class="f_Text" style="font-style: italic;">FileSave</span><span class="f_Text"> works as expected.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileSave</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">newdata</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;true</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">You can look in the folder </span><span class="f_Text" style="font-style: italic;">MQL5/Files/MQL5Book/</span><span class="f_Text"> and find there the </span><span class="f_Text" style="font-style: italic;">newdata</span><span class="f_Text"> file, 8 bytes long.</span></p>
<p class="p_Text"><span class="f_Text">Note that after we close the file, its descriptor is returned to the free descriptor pool, and the next time a file (maybe another file) is opened, the same number comes into play again.</span></p>
<p class="p_Text"><span class="f_Text">For a neat shutdown, we will explicitly close all open files.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">);&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INVALID_HANDLE</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ha</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>

</div>

</body>
</html>
