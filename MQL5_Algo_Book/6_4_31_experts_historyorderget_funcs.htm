<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>6.4.31 Functions for reading order properties from history</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part6.htm"> Part 6. Trading automation </a> / <a class="h_m" href="6_4_experts.htm"> 6.4 Creating Expert Advisors </a>/ 6.4.31 Functions for reading order properties from history
          </td>
          <td width="70" align="right">
          <a href="6_4_30_experts_history_select.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="6_4_32_experts_historydealget_funcs.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">6.4.31 Functions for reading order properties from history</span></p>
<p class="p_Text"><span class="f_Text">The functions for reading properties of historical orders are divided into 3 groups according to the basic type of property values, in accordance with the division of identifiers of available properties into three enumerations: </span><span class="f_Text" style="letter-spacing: -1px;">ENUM_ORDER_PROPERTY_INTEGER</span><span class="f_Text">, </span><span class="f_Text" style="letter-spacing: -1px;">ENUM_ORDER_PROPERTY_DOUBLE</span><span class="f_Text"> and </span><span class="f_Text" style="letter-spacing: -1px;">ENUM_ORDER_PROPERTY_STRING</span><span class="f_Text"> discussed earlier in a <a href="6_4_23_experts_order_properties.htm" class="topiclink">separate section</a> when exploring active orders.</span></p>
<p class="p_Text"><span class="f_Text">Before calling these functions, you need to somehow <a href="6_4_30_experts_history_select.htm" class="topiclink">select the appropriate set of tickets in the history</a>.</span></p>
<p class="p_Text"><span class="f_Text">If you try to read the properties of an order or a deal having tickets outside the selected history context, the environment may generate a WRONG_INTERNAL_PARAMETER (4002) error, which can be analyzed via </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">For each base property type, there are two function forms: one directly returns the value of the requested property, the second one writes it into a parameter passed by reference and returns a success indicator (</span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">) or errors (</span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">For integer and compatible types (</span><span class="f_Text" style="font-style: italic;">datetime</span><span class="f_Text">, enums) of properties there is a dedicated function </span><span class="f_Text" style="font-style: italic;">HistoryOrderGetInteger</span><span class="f_Text">.</span></p>
<p class="p_H4"><span class="f_H4">long HistoryOrderGetInteger(ulong ticket, ENUM_ORDER_PROPERTY_INTEGER property)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool HistoryOrderGetInteger(ulong ticket, ENUM_ORDER_PROPERTY_INTEGER property,</span><br>
<span class="f_H4"> &nbsp; long &amp;value)</span></p>
<p class="p_Text"><span class="f_Text">The function allows you to find out the order </span><span class="f_Text" style="font-style: italic;">property</span><span class="f_Text"> from the selected history by its ticket number.</span></p>
<p class="p_Text"><span class="f_Text">For real properties, the </span><span class="f_Text" style="font-style: italic;">HistoryOrderGetDouble</span><span class="f_Text"> function is assigned.</span></p>
<p class="p_H4"><span class="f_H4">double HistoryOrderGetDouble(ulong ticket, ENUM_ORDER_PROPERTY_DOUBLE property)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool HistoryOrderGetDouble(ulong ticket, ENUM_ORDER_PROPERTY_DOUBLE property,</span><br>
<span class="f_H4"> &nbsp; double &amp;value)</span></p>
<p class="p_Text"><span class="f_Text">Finally, string properties can be read with </span><span class="f_Text" style="font-style: italic;">HistoryOrderGetString</span><span class="f_Text">.</span></p>
<p class="p_H4"><span class="f_H4">string HistoryOrderGetString(ulong ticket, ENUM_ORDER_PROPERTY_STRING property)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool HistoryOrderGetString(ulong ticket, ENUM_ORDER_PROPERTY_STRING property,</span><br>
<span class="f_H4"> &nbsp; string &amp;value)</span></p>
<p class="p_Text"><span class="f_Text">Now we can supplement the </span><span class="f_Text" style="font-style: italic;">OrderMonitor</span><span class="f_Text"> class (</span><span class="f_Text" style="font-style: italic;">OrderMonitor.mqh</span><span class="f_Text">) for working with historical orders. First, let's add a boolean variable to the </span><span class="f_Text" style="font-style: italic;">history</span><span class="f_Text"> class, which we will fill in the constructor based on the segment in which the order with the passed ticket was selected: among the active ones (</span><span class="f_Text" style="font-style: italic;">OrderSelect</span><span class="f_Text">) or in history (</span><span class="f_Text" style="font-style: italic;">HistoryOrderSelect</span><span class="f_Text">).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">OrderMonitor</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">OrderMonitorInterface</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">history</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">OrderMonitor</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">):&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">),&nbsp;</span><span class="f_CodeExample" style="color: #333333;">history</span><span class="f_CodeExample">(!</span><span class="f_CodeExample" style="color: #0000ff;">OrderSelect</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">history</span><span class="f_CodeExample">&nbsp;&amp;&amp;&nbsp;!</span><span class="f_CodeExample" style="color: #0000ff;">HistoryOrderSelect</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Error:&nbsp;OrderSelect(%lld)&nbsp;failed:&nbsp;%s&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">E2S</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">_LastError</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ResetLastError</span><span class="f_CodeExample">();</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ready</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">We need to call the </span><span class="f_Text" style="font-style: italic;">ResetLastError</span><span class="f_Text"> function in a successful </span><span class="f_Text" style="font-style: italic;">if</span><span class="f_Text"> branch in order to reset the possible error that could be set by the </span><span class="f_Text" style="font-style: italic;">OrderSelect</span><span class="f_Text"> function (if the order is in history).</span></p>
<p class="p_Text"><span class="f_Text">In fact, this version of the constructor contains a serious logical error, and we will return to it after a few paragraphs.</span></p>
<p class="p_Text"><span class="f_Text">To read properties in get methods, we now call different built-in functions, depending on the value of the </span><span class="f_Text" style="font-style: italic;">history</span><span class="f_Text"> variable.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">virtual</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">long</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">get</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">const</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #ff0000;">ENUM_ORDER_PROPERTY_INTEGER</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">)&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">const</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">override</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;{</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">return</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">history</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;?&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">HistoryOrderGetInteger</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #333333;">ticket</span><span class="f_CodeExampleCondensed" style="color: #000000;">,&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">)&nbsp;:&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">OrderGetInteger</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">);</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;}</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">virtual</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">double</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">get</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">const</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #ff0000;">ENUM_ORDER_PROPERTY_DOUBLE</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">)&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">const</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">override</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;{</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">return</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">history</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;?&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">HistoryOrderGetDouble</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #333333;">ticket</span><span class="f_CodeExampleCondensed" style="color: #000000;">,&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">)&nbsp;:&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">OrderGetDouble</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">);</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;}</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">virtual</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">string</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">get</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">const</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #ff0000;">ENUM_ORDER_PROPERTY_STRING</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">)&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">const</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">override</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;{</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">return</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">history</span><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;?&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">HistoryOrderGetString</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #333333;">ticket</span><span class="f_CodeExampleCondensed" style="color: #000000;">,&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">)&nbsp;:&nbsp;</span><span class="f_CodeExampleCondensed" style="color: #0000ff;">OrderGetString</span><span class="f_CodeExampleCondensed" style="color: #000000;">(</span><span class="f_CodeExampleCondensed" style="color: #333333;">property</span><span class="f_CodeExampleCondensed" style="color: #000000;">);</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;}</span></p>
<p class="p_CodeExampleCondensed" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExampleCondensed" style="color: #000000;">&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The main purpose of the </span><span class="f_Text" style="font-style: italic;">OrderMonitor</span><span class="f_Text"> class is to supply data to other analytical classes. The </span><span class="f_Text" style="font-style: italic;">OrderMonitor</span><span class="f_Text"> objects are used to filter active orders in the </span><span class="f_Text" style="font-style: italic;">OrderFilter</span><span class="f_Text"> class, and we need a similar class for selecting orders by arbitrary conditions on the history: </span><span class="f_Text" style="font-style: italic;">HistoryOrderFilter</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Let's write this class in the same file </span><span class="f_Text" style="font-style: italic;">OrderFilter.mqh</span><span class="f_Text">. It uses two new functions for working with history: </span><span class="f_Text" style="font-style: italic;">HistoryOrdersTotal</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">HistoryOrderGetTicket</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">HistoryOrderFilter</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">TradeFilter</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">OrderMonitor</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">ENUM_ORDER_PROPERTY_INTEGER</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">ENUM_ORDER_PROPERTY_DOUBLE</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">ENUM_ORDER_PROPERTY_STRING</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">virtual</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">()&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">override</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">HistoryOrdersTotal</span><span class="f_CodeExample">();</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">virtual</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">override</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">HistoryOrderGetTicket</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This simple code inherits from the template class </span><span class="f_Text" style="font-style: italic;">TradeFilter</span><span class="f_Text">, where the class is passed as the first parameter of the template </span><span class="f_Text" style="font-style: italic;">OrderMonitor</span><span class="f_Text"> to read the properties of the corresponding objects (we saw an analog for positions, and will soon create one for deals).</span></p>
<p class="p_Text"><span class="f_Text">Here lies the problem with the </span><span class="f_Text" style="font-style: italic;">OrderMonitor</span><span class="f_Text"> constructor. As we learned in the section <a href="6_4_30_experts_history_select.htm" class="topiclink">Selecting orders and deals from history</a>, to analyze the account we must first set up the context with one of the functions such as </span><span class="f_Text" style="font-style: italic;">HistorySelect</span><span class="f_Text">. So here in the source code </span><span class="f_Text" style="font-style: italic;">HistoryOrderFilter</span><span class="f_Text"> it is assumed that the MQL program has already selected the required history fragment. However, the new, intermediate version of the </span><span class="f_Text" style="font-style: italic;">OrderMonitor</span><span class="f_Text"> constructor uses the </span><span class="f_Text" style="font-style: italic;">HistoryOrderSelect</span><span class="f_Text"> call to check the existence of a ticket in history. Meanwhile, this function resets the previous context of historical orders and selects a single order.</span></p>
<p class="p_Text"><span class="f_Text">So we need a helper method </span><span class="f_Text" style="font-style: italic;">historyOrderSelectWeak</span><span class="f_Text"> to validate the ticket in a &quot;soft&quot; way without breaking the existing context. To do this, we can simply check if the ORDER_TICKET property is equal to the passed ticket </span><span class="f_Text" style="font-style: italic;">t</span><span class="f_Text">: </span><span class="f_Text" style="font-style: italic;">(HistoryOrderGetInteger(t, ORDER_TICKET) == t)</span><span class="f_Text">. If such a ticket has already been selected (available), the check will succeed, and the monitor does not need to manipulate the history.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">OrderMonitor</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">OrderMonitorInterface</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">historyOrderSelectWeak</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;(((</span><span class="f_CodeExample" style="color: #0000ff;">HistoryOrderGetInteger</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">ORDER_TICKET</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">)&nbsp;||</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">HistorySelect</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">LONG_MAX</span><span class="f_CodeExample">)&nbsp;&amp;&amp;&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">HistoryOrderGetInteger</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">ORDER_TICKET</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">))));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">history</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">OrderMonitor</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">):&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">),&nbsp;</span><span class="f_CodeExample" style="color: #333333;">history</span><span class="f_CodeExample">(!</span><span class="f_CodeExample" style="color: #0000ff;">OrderSelect</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">history</span><span class="f_CodeExample">&nbsp;&amp;&amp;&nbsp;!</span><span class="f_CodeExample" style="color: #333333;">historyOrderSelectWeak</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Error:&nbsp;OrderSelect(%lld)&nbsp;failed:&nbsp;%s&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ticket</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">E2S</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">_LastError</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ResetLastError</span><span class="f_CodeExample">();</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ready</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">An example of applying order filtering on history will be considered in the next section after we prepare a similar functionality for deals.</span></p>

</div>

</body>
</html>
