<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>4.5 Working with files</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part4.htm"> Part 4. Common APIs </a>/ 4.5 Working with files
          </td>
          <td width="70" align="right">
          <a href="4_4_11_maths_byte_swap.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="4_5_1_files_modes_bin_txt.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H2"><span class="f_H2">4.5 Working with files</span></p>
<p class="p_Text"><span class="f_Text">It is difficult to find a program that does not use data input-output. We already know that MQL programs can receive settings via <a href="2_3_6_input_variables.htm" class="topiclink">input variables</a> and output information to the log as we used the latter in almost all test scripts. But in most cases, this is not enough.</span></p>
<p class="p_Text"><span class="f_Text">For example, quite a significant part of program customization includes amounts of data that cannot be accommodated in the input parameters. A program may need to be integrated with some external analytical tools, i.e., uploading market information in a standard or specialized format, processing and then loading it into the terminal in a new form, in particular, as trading signals, a set of neural network weights or decision tree coefficients. Furthermore, it can be convenient to maintain a separate log for an MQL program.</span></p>
<p class="p_Text"><span class="f_Text">The file subsystem provides the most universal opportunities for such tasks. The MQL5 API provides a wide range of functions for working with files, including functions to create, delete, search, write, and read the files. We will study all this in this chapter.</span></p>
<p class="p_Text"><span class="f_Text">All file operations in MQL5 are limited to a special area on the disk, which is called a sandbox. This is done for security reasons so that no MQL program can be used for malicious purposes and harm your computer or operating system.</span></p>
<p class="p_Quote"><span class="f_Quote">Advanced users can avoid this limitation using special measures, which we will discuss later. But this should only be done in exceptional cases while observing precautions and accepting all responsibility.</span></p>
<p class="p_Text"><span class="f_Text">For each instance of the terminal installed on the computer, the sandbox root directory is located at </span><span class="f_Text" style="font-style: italic;">&lt;terminal_data_folder&gt;/MQL5/Files/</span><span class="f_Text">. From the MetaEditor, you can open the data folder using the command </span><span class="f_Text" style="font-style: italic;">File -&gt; Open Data Folder</span><span class="f_Text">. If you have sufficient access rights on the computer, this directory is usually the same place where the terminal is installed. If you do not have the required permissions, the path will look like this:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">:/</span><span class="f_CodeExample" style="color: #333333;">Users</span><span class="f_CodeExample">/&lt;</span><span class="f_CodeExample" style="color: #333333;">user_name</span><span class="f_CodeExample">&gt;/</span><span class="f_CodeExample" style="color: #333333;">AppData</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Roaming</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">MetaQuotes</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Terminal</span><span class="f_CodeExample">/&lt;</span><span class="f_CodeExample" style="color: #333333;">instance_id</span><span class="f_CodeExample">&gt;/</span><span class="f_CodeExample" style="color: #333333;">MQL5</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Files</span><span class="f_CodeExample">/</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here </span><span class="f_Text" style="font-style: italic;">X</span><span class="f_Text"> is a drive letter where the system is installed, </span><span class="f_Text" style="font-style: italic;">&lt;user_name&gt;</span><span class="f_Text"> is the Windows user login, </span><span class="f_Text" style="font-style: italic;">&lt;instance_id&gt;</span><span class="f_Text"> is a unique identifier of the terminal instance. The </span><span class="f_Text" style="font-style: italic;">Users</span><span class="f_Text"> folder also has an alias &quot;</span><span class="f_Text" style="font-style: italic;">Documents and Settings</span><span class="f_Text">&quot;.</span></p>
<p class="p_Quote"><span class="f_Quote">Please note that in the case of a remote connection to a computer via RDP (Remote Desktop Protocol), the terminal will always use the </span><span class="f_Quote" style="font-style: italic;">Roaming</span><span class="f_Quote"> directory and its subdirectories even if you have administrator rights.</span></p>
<p class="p_Text"><span class="f_Text">Let's recall that the MQL5 folder in the data directory is the place where all MQL programs are stored: both their source codes and compiled ex5 files. Each type of MQL program, including indicators, Expert Advisors, scripts, and others, has a dedicated subfolder in the MQL5 folder. So the </span><span class="f_Text" style="font-style: italic;">Files</span><span class="f_Text"> folder for working files is next to them.</span></p>
<p class="p_Text"><span class="f_Text">In addition to this individual sandbox of each copy of the terminal on the computer, there is a common, shared sandbox for all terminals: they can communicate through it. The path to it runs through the home folder of the Windows user and may differ depending on the version of the operating system. For example, in standard installations of Windows 7, 8, and 10, it looks like this:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">:/</span><span class="f_CodeExample" style="color: #333333;">Users</span><span class="f_CodeExample">/&lt;</span><span class="f_CodeExample" style="color: #333333;">user_name</span><span class="f_CodeExample">&gt;/</span><span class="f_CodeExample" style="color: #333333;">AppData</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Roaming</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">MetaQuotes</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Terminal</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Common</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Files</span><span class="f_CodeExample">/</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Again, the folder can be easily accessed through MetaTrader: run the command </span><span class="f_Text" style="font-style: italic;">File -&gt; Open Shared Data Folder</span><span class="f_Text">, and you will be inside the Common folder.</span></p>
<p class="p_Text"><span class="f_Text">Some types of MQL programs (Expert Advisors and indicators) can be executed not only in the terminal but also in the tester. When running in it, the shared sandbox remains accessible, and instead of a single instance sandbox, a folder inside the test agent is used. As a rule, it looks like:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">:/&lt;</span><span class="f_CodeExample" style="color: #0000ff;">terminal_path</span><span class="f_CodeExample">&gt;/</span><span class="f_CodeExample" style="color: #333333;">Tester</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Agent</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">IP</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">port</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">MQL5</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">Files</span><span class="f_CodeExample">/</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This may not be visible in the MQL program itself, i.e., all file functions work in exactly the same way. However, from the user's point of view, it may seem that there is some kind of problem. For example, if the program saves the results of its work to a file, it will be deleted in the tester's agent folder after the run is completed (as if the file had never been created). This routine approach is designed to prevent potentially valuable data of one program from leaking into another program that can be tested on the same agent some time later (especially since agents can be shared). Other technologies are provided for transferring files to agents and returning results from agents to the terminal, which we will discuss in the fifth Part of the book.</span></p>
<p class="p_Text"><span class="f_Text">To get around the sandbox limitation, you can use Windows' ability to assign symbolic links to file system objects. In our case, the connections (junction) are best suited for redirecting access to folders on the local computer. They are created using the following command (meaning the Windows command line):</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">mklink</span><span class="f_CodeExample">&nbsp;/</span><span class="f_CodeExample" style="color: #333333;">J</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">new_name</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">existing_target</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The parameter </span><span class="f_Text" style="font-style: italic;">new_name</span><span class="f_Text"> is the name of the new virtual folder that will point to the real folder </span><span class="f_Text" style="font-style: italic;">existing_target</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">To create connections to external folders outside the sandbox, it is recommended to create a dedicated folder inside MQL5/Files, for example, </span><span class="f_Text" style="font-style: italic;">Links</span><span class="f_Text">. Then, having entered it, you can execute the above command by selecting </span><span class="f_Text" style="font-style: italic;">new_name</span><span class="f_Text"> and substituting the real path outside the sandbox as </span><span class="f_Text" style="font-style: italic;">existing_target</span><span class="f_Text">. For example, the following command will create in the folder </span><span class="f_Text" style="font-style: italic;">Links</span><span class="f_Text"> a new link named </span><span class="f_Text" style="font-style: italic;">Settings</span><span class="f_Text">, which will provide access to the MQL5/Presets folder:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">mklink</span><span class="f_CodeExample">&nbsp;/</span><span class="f_CodeExample" style="color: #333333;">J</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Settings</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;..\..\Presets\&quot;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The relative path &quot;..\..\&quot; assumes that the command is executed in the specified MQL5/Files/Links folder. A combination of two dots &quot;..&quot; indicates the transition from the current folder to the parent. Specified twice, this combination instructs to go up the path hierarchy twice. As a result, the target folder (</span><span class="f_Text" style="font-style: italic;">existing_target</span><span class="f_Text">) will be generated as MQL5/Presets. But in the </span><span class="f_Text" style="font-style: italic;">existing_target</span><span class="f_Text"> parameter, you can also specify an absolute path.</span></p>
<p class="p_Text"><span class="f_Text">You can delete symbolic links like regular files (but, of course, you should first make sure that it is the folder with the arrow icon in its lower left corner that is being deleted, i.e. the link, and not the original folder). It is recommended to do this immediately, as soon as you no longer need to go beyond the sandbox. The fact is that the created virtual folders become available to all MQL programs, not just yours, and it is not known how other people's programs can use the additional freedom.</span></p>
<p class="p_Text"><span class="f_Text">Many sections of the chapter deal with file names. They act as file system element identifiers and have similar rules, including some restrictions.</span></p>
<p class="p_Text"><span class="f_Text">Please note that the file name cannot contain some characters that play special roles in the file system ('&lt;', '&gt;', '/', '\\', '&quot;', ':', '|', '* ', '?'), as well as any characters with codes from 0 to 31 inclusive.</span></p>
<p class="p_Text"><span class="f_Text">The following file names are also reserved for special use in the operating system and cannot be used: CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, LPT9.</span></p>
<p class="p_Text"><span class="f_Text">It should be noted that the Windows file system does not see the fundamental difference between letters in different cases, so names like &quot;Name&quot;, &quot;NAME&quot;, and &quot;name&quot; refer to the same element.</span></p>
<p class="p_Text"><span class="f_Text">Windows allows both backslashes '\\' and forward slashes '/' to be used as a separator character between path components (subfolders and files). However, the backslash needs to be screened (that is, actually written twice) in MQL5 strings, because the '\' character itself is special: it is used to construct control character sequences, such as '\r', '\n', '\t' and others (see section <a href="2_2_3_characters.htm" class="topiclink">Character types</a>). For example, the following paths are equivalent: &quot;MQL5Book/file.txt&quot; and &quot;MQL5Book\\file.txt&quot;.</span></p>
<p class="p_Text"><span class="f_Text">The dot character '.' serves as a separator between the name and the extension. If a file system element has multiple dots in its identifier, then the extension is the fragment to the right of the rightmost dot, and everything to the left of it is the name. The title (before the dot) or extension (after the dot) can be empty. For example, the file name without an extension is &quot;text&quot;, and the file without a name (only with the extension) is &quot;.txt&quot;.</span></p>
<p class="p_Quote"><span class="f_Quote">The total length of the path and file name in Windows has limitations. At the same time, to manage files in MQL5, it should be taken into account that the path to the sandbox will be added to their path and name, i.e., even less space will be allocated for the names of file objects in MQL function calls. By default, the overall length limit is the system constant MAX_PATH, which is equal 260. Starting from Windows 10 (build 1607), you can increase this limit to 32767. To do this, you need to save the following text in a .reg file and run it by adding it to the Windows Registry.</span><br>
<span class="f_Quote">&nbsp;</span><br>
<span class="f_PseudoCode">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem]</span><br>
<span class="f_PseudoCode">&quot;LongPathsEnabled&quot;=dword:00000001</span><br>
<span class="f_PseudoCode">&nbsp;</span><br>
<span class="f_Quote">For other versions of Windows, you can use workarounds from the command line. In particular, you can shorten the path using the connections discussed above (by creating a virtual folder with a short path). You can also use the shell command -</span><span class="f_Quote" style="font-style: italic;">subst</span><span class="f_Quote">, For example, </span><span class="f_Quote" style="font-style: italic;">subst z: c:\very\long\path</span><span class="f_Quote"> (see Windows Help for details).</span></p>

</div>

</body>
</html>
