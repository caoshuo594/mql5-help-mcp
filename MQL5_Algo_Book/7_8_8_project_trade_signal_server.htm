<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>7.8.8 Trading signal service and test web page</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part7.htm"> Part 7. Advanced language tools </a> / <a class="h_m" href="7_8_project.htm"> 7.8 Projects </a>/ 7.8.8 Trading signal service and test web page
          </td>
          <td width="70" align="right">
          <a href="7_8_7_project_echo_chat_mql5.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="7_8_9_project_trade_signal_client_mql5.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">7.8.8 Trading signal service and test web page</span></p>
<p class="p_Text"><span class="f_Text">The trading signal service is technically identical to the chat service, however, its users (or rather client connections) must perform one of two roles:</span></p>
<ul>
<li class="p_li"><span class="f_li">Message provider</span></li>
<li class="p_li"><span class="f_li">Message consumer</span></li>
</ul>
<p class="p_Text"><span class="f_Text">In addition, the information should not be available to everyone but work according to some subscription scheme.</span></p>
<p class="p_Text"><span class="f_Text">To ensure this, when connecting to the service, users will be required to provide certain identifying information that differs depending on the role.</span></p>
<p class="p_Text"><span class="f_Text">The provider must specify a public signal identifier (PUB_ID) that is unique among all signals. Basically, the same person could potentially generate more than one signal and should therefore be able to obtain multiple identifiers. In this sense, we will not complicate the service by introducing separate provider identifiers (as a specific person) and identifiers of its signals. Instead, only signal identifiers will be supported. For a real signal service, this issue needs to be worked out, along with authorization, which we left outside of this book.</span></p>
<p class="p_Text"><span class="f_Text">The identifier will be required in order to advertise it or simply pass it on to persons interested in subscribing to this signal. But &quot;everyone you meet&quot; should not be able to access the signal knowing only the public identifier. In the simplest case, this would be acceptable for open account monitoring, but we will demonstrate the option of restricting access specifically in the context of signals.</span></p>
<p class="p_Text"><span class="f_Text">For this purpose, the provider must provide the server with a secret key (PUB_KEY) known only to them but not to the public. This key will be required to generate a specific subscriber's access key.</span></p>
<p class="p_Text"><span class="f_Text">The consumer (subscriber) must also have a unique identifier (SUB_ID, and here we will also do without authorization). To subscribe to the desired signal, the user must tell the signal provider the identifier (in practice, it is understood that at the same stage, it is necessary to confirm the payment, and usually this is all automated by the server). The provider forms a snapshot consisting of the provider's identifier, the subscriber's identifier, and the secret key. In our service, this will be done by calculating the SHA256 hash from the PUB_ID:PUB_KEY:SUB_ID string, after which the resulting bytes are converted to a hexadecimal format string. This will be the access key (SUB_KEY or ACCESS_KEY) to the signal of a particular provider for a particular subscriber. The provider (and in real systems, the server itself automatically) forwards this key to the subscriber.</span></p>
<p class="p_Text"><span class="f_Text">Thus, when connecting to the service, the subscriber will have to specify the subscriber identifier (SUB_ID), the identifier of the desired signal (PUB_ID), and the access key (SUB_KEY). Because the server knows the provider's secret key, it can recalculate the access key for the given combination of PUB_ID and SUB_ID, and compare it with the provided SUB_KEY. A match means the normal messaging process continues. The difference will result in an error message and disconnecting the pseudo-subscriber from the service.</span></p>
<p class="p_Text"><span class="f_Text">It is important to note that in our demo, for the sake of simplicity, there is no normal registration of users and signals, and therefore the choice of identifiers is arbitrary. It is only important for us to keep track of the uniqueness of identifiers in order to know to whom and from whom to send information online. So, our service does not guarantee that the identifier, for example, &quot;Super Trend&quot; belongs to the same user yesterday, today, and tomorrow. Reservation of names is made according to the principle that the early bird catches the worm. As long as a provider is continuously connected under the given identifier, the signal is delivered. If the provider disconnects, then the identifier becomes available for selection in any next connection.</span></p>
<p class="p_Text"><span class="f_Text">The only identifier that will always be busy is &quot;Server&quot;: the server uses it to send out its connection status messages.</span></p>
<p class="p_Text"><span class="f_Text">To generate access keys in the server folder, there is a simple JavaScript </span><span class="f_Text" style="font-style: italic;">access.js</span><span class="f_Text">. When you run it on the command line, you need to pass as the only parameter a string of the above type PUB_ID:PUB_KEY:SUB_ID (identifiers and the secret key between them, connected by the ':' symbol)</span></p>
<p class="p_Text"><span class="f_Text">If the parameter is not specified, the script generates an access key for some demo identifiers (PUB_ID_001, SUB_ID_100) and a secret (PUB_KEY_FFF).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #808080;">//&nbsp;JavaScript</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">args</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">process</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">argv</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">slice</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">args</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">length</span><span class="f_CodeExample">&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">&nbsp;?&nbsp;</span><span class="f_CodeExample" style="color: #333333;">args</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">]&nbsp;:&nbsp;'</span><span class="f_CodeExample" style="color: #333333;">PUB_ID_001</span><span class="f_CodeExample">:</span><span class="f_CodeExample" style="color: #333333;">PUB_KEY_FFF</span><span class="f_CodeExample">:</span><span class="f_CodeExample" style="color: #333333;">SUB_ID_100</span><span class="f_CodeExample">';</span>
<br><span class="f_CodeExample" style="color: #333333;">console</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">log</span><span class="f_CodeExample">('Hashing&nbsp;&quot;',&nbsp;input,&nbsp;'&quot;');</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">crypto</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">require</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">crypto</span><span class="f_CodeExample">');</span>
<br><span class="f_CodeExample" style="color: #333333;">console</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">log</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">crypto</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">createHash</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">sha256</span><span class="f_CodeExample">').</span><span class="f_CodeExample" style="color: #333333;">update</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">).</span><span class="f_CodeExample" style="color: #333333;">digest</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">hex</span><span class="f_CodeExample">'));</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Running the script with the command:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">node&nbsp;access.js&nbsp;PUB_ID_001:PUB_KEY_FFF:SUB_ID_100</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">we get this result:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">fd3f7a105eae8c2d9afce0a7a4e11bf267a40f04b7c216dd01cf78c7165a2a5a</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">By the way, you can check and repeat this algorithm in pure MQL5 using the </span><span class="f_Text" style="font-style: italic;"><a href="7_4_2_crypt_encode.htm" class="topiclink">CryptEncode</a></span><span class="f_Text"> function.</span></p>
<p class="p_Text"><span class="f_Text">Having analyzed the conceptual part, let's proceed to practical implementation.</span></p>
<p class="p_Text"><span class="f_Text">The server script of the signaling service will be placed in the file </span><span class="f_Text" style="font-style: italic;">MQL5/Experts/MQL5Book/p7/Web/wspubsub.js</span><span class="f_Text">. Setting up servers in it is the same as what we did earlier. However, in addition, you will need to connect the same &quot;crypto&quot; module that was used in </span><span class="f_Text" style="font-style: italic;">access.js</span><span class="f_Text">. The home page will be called </span><span class="f_Text" style="font-style: italic;">wspubsub.htm</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #808080;">//&nbsp;JavaScript</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">crypto</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">require</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">crypto</span><span class="f_CodeExample">');</span>
<br><span class="f_CodeExample">...</span>
<br><span class="f_CodeExample" style="color: #333333;">http1</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">createServer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">options</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">req</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">res</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">req</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">url</span><span class="f_CodeExample">&nbsp;==&nbsp;'/')</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">req</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">url</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;wspubsub.htm&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">});</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Instead of one map of connected clients, we will define two maps, separately for signal providers and consumers.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #808080;">//&nbsp;JavaScript</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">publishers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Map</span><span class="f_CodeExample">();</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Map</span><span class="f_CodeExample">();</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In both maps, the key is the provider ID, but the first one stores the objects of the providers, and the second one stores the objects of subscribers subscribed to each provider (arrays of objects).</span></p>
<p class="p_Text"><span class="f_Text">To transfer identifiers and keys during the handshake, we will use a special header allowed by the WebSockets specification, namely Sec-Websocket-Protocol. Let's agree that identifiers and keys will be glued together with the symbol '-': in the case of a provider, a string like X-MQL5-publisher-PUB_ID-PUB_KEY is expected, and in the case of a subscriber, we expect X-MQL5-subscriber-SUB_ID-PUB_ID-SUB_KEY.</span></p>
<p class="p_Text"><span class="f_Text">Any attempts to connect to our service without the Sec-Websocket-Protocol: X-MQL5-... header will be stopped by immediate closure.</span></p>
<p class="p_Text"><span class="f_Text">In the new client object (in the &quot;connection&quot; event handler parameter </span><span class="f_Text" style="font-style: italic;">onConnect(client)</span><span class="f_Text">) this title is easy to extract from the </span><span class="f_Text" style="font-style: italic;">client.protocol</span><span class="f_Text"> property.</span></p>
<p class="p_Text"><span class="f_Text">Let's show the procedure for registering and sending the signal provider's messages in a simplified form, without error handling (the full code is attached). It is important to note that the message text is generated in JSON format (which we will discuss in more detail in the next section). In particular, the sender of the message is passed in the &quot;origin&quot; property (moreover, when the message is sent by the service itself, this field contains the string &quot;Server&quot;), and the application data from the provider is placed in the &quot;msg&quot; property, and this may not be just text, but also nested structure of any content.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #808080;">//&nbsp;JavaScript</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">wsServer</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WebSocket</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">Server</span><span class="f_CodeExample">({&nbsp;</span><span class="f_CodeExample" style="color: #333333;">server</span><span class="f_CodeExample">&nbsp;});</span>
<br><span class="f_CodeExample" style="color: #333333;">wsServer</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">on</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">connection</span><span class="f_CodeExample">',&nbsp;</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">onConnect</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">console</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">log</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #0000ff;">New</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">user</span><span class="f_CodeExample">:',&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">protocol</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">protocol</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">startsWith</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">MQL5</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">publisher</span><span class="f_CodeExample">'))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">protocol</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">split</span><span class="f_CodeExample">('-');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">key</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">4</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">publishers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">set</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">send</span><span class="f_CodeExample">('{&quot;origin&quot;:&quot;Server&quot;,&nbsp;&quot;msg&quot;:&quot;Hello,&nbsp;publisher&nbsp;'&nbsp;+&nbsp;client.id&nbsp;+&nbsp;'&quot;}');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">on</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">',&nbsp;</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">console</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">log</span><span class="f_CodeExample">('%</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">&nbsp;:&nbsp;%</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">',&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">).</span><span class="f_CodeExample" style="color: #333333;">forEach</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">elem</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">elem</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">send</span><span class="f_CodeExample">('{&quot;origin&quot;:&quot;publisher&nbsp;'&nbsp;+&nbsp;client.id&nbsp;+&nbsp;'&quot;,&nbsp;&quot;msg&quot;:'</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">&nbsp;+&nbsp;'}');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">on</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">',&nbsp;</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">console</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">log</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">Publisher</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">disconnected</span><span class="f_CodeExample">:',&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">).</span><span class="f_CodeExample" style="color: #333333;">forEach</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">elem</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">elem</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">();</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">publishers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">delete</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Half of the algorithm for subscribers is similar, but here we have the calculation of the access key and its comparison with what the connecting client transmitted, as an addition.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #808080;">//&nbsp;JavaScript</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">protocol</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">startsWith</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">X</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">MQL5</span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #333333;">subscriber</span><span class="f_CodeExample">'))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">protocol</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">split</span><span class="f_CodeExample">('-');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">pub_id</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">4</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">access</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">parts</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">5</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">pub_id</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">var</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">publishers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">check</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">crypto</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">createHash</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">sha256</span><span class="f_CodeExample">').</span><span class="f_CodeExample" style="color: #333333;">update</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">&nbsp;+&nbsp;':'&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">key</span><span class="f_CodeExample">&nbsp;+&nbsp;':'</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">).</span><span class="f_CodeExample" style="color: #333333;">digest</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">hex</span><span class="f_CodeExample">');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">check</span><span class="f_CodeExample">&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">access</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">console</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">log</span><span class="f_CodeExample">(`</span><span class="f_CodeExample" style="color: #333333;">Bad</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">credentials</span><span class="f_CodeExample">:&nbsp;'</span><span class="f_CodeExample" style="color: #008100;">$</span><span class="f_CodeExample">{</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">access</span><span class="f_CodeExample">}'&nbsp;</span><span class="f_CodeExample" style="color: #333333;">vs</span><span class="f_CodeExample">&nbsp;'</span><span class="f_CodeExample" style="color: #008100;">$</span><span class="f_CodeExample">{</span><span class="f_CodeExample" style="color: #333333;">check</span><span class="f_CodeExample">}'`);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">send</span><span class="f_CodeExample">('{&quot;origin&quot;:&quot;Server&quot;,&nbsp;&quot;msg&quot;:&quot;Bad&nbsp;credentials,&nbsp;subscriber&nbsp;'</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;client.id&nbsp;+&nbsp;'&quot;}');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">();</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">var</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">undefined</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">&nbsp;=&nbsp;[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">push</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">set</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">send</span><span class="f_CodeExample">('{&quot;origin&quot;:&quot;Server&quot;,&nbsp;&quot;msg&quot;:&quot;Hello,&nbsp;subscriber&nbsp;'</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;client.id&nbsp;+&nbsp;'&quot;}');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">send</span><span class="f_CodeExample">('{&quot;origin&quot;:&quot;Server&quot;,&nbsp;&quot;msg&quot;:&quot;New&nbsp;subscriber&nbsp;'&nbsp;+&nbsp;client.id&nbsp;+&nbsp;'&quot;}');</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">on</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">',&nbsp;</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">console</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">log</span><span class="f_CodeExample">('</span><span class="f_CodeExample" style="color: #333333;">Subscriber</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">disconnected</span><span class="f_CodeExample">:',&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">id</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">get</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">pub_id</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">length</span><span class="f_CodeExample">&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">filtered</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">list</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">filter</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">function</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">el</span><span class="f_CodeExample">)&nbsp;{&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">el</span><span class="f_CodeExample">&nbsp;!==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">;&nbsp;});</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">set</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">pub_id</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">filtered</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">subscribers</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #0000ff;">delete</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">client</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">pub_id</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The user interface on the client page </span><span class="f_Text" style="font-style: italic;">wspubsub.htm</span><span class="f_Text"> simply invites you to follow a link to one of the two pages with forms for suppliers (</span><span class="f_Text" style="font-style: italic;">wspublisher.htm + wspublisher_client.js</span><span class="f_Text">) or subscribers (</span><span class="f_Text" style="font-style: italic;">wssubscriber.htm + wssubscriber_client.js</span><span class="f_Text">).</span></p>
<p class="p_ImageCaption"><img class="help" alt="Web pages of signal service test clients" title="Web pages of signal service test clients" width="600" height="400" style="margin:0 auto 0 auto;width:600px;height:400px;border:none" src="wspubsub.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">Web pages of signal service test clients</span></p>
<p class="p_Text"><span class="f_Text">Their implementation inherits the features of the previously considered JavaScript clients, but with respect to the customization of the Sec-Websocket-Protocol: X-MQL5- header and one more nuance.</span></p>
<p class="p_Text"><span class="f_Text">Until now, we have exchanged simple text messages. But for a signaling service, you will need to transfer a lot of structured information, and JSON is better suited for this. Therefore, clients can parse JSON, although they do not use it for its intended purpose, because even if a command to buy or sell a specific ticker with a given amount is found in JSON, the browser does not know how to do this.</span></p>
<p class="p_Text"><span class="f_Text">We will need to add JSON support to our signal service client in MQL5. Meanwhile, you can run on the server </span><span class="f_Text" style="font-style: italic;">wspubsub.js</span><span class="f_Text"> and test the selective connection of signal providers and consumers in accordance with the details specified by them. We suggest you do it yourself, for your own benefit.</span></p>

</div>

</body>
</html>
