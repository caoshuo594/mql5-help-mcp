<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>3.3.6 Object type templates</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part3.htm"> Part 3. Object Oriented Programming </a> / <a class="h_m" href="3_3_templates.htm"> 3.3 Templates </a>/ 3.3.6 Object type templates
          </td>
          <td width="70" align="right">
          <a href="3_3_5_templates_functions.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="3_3_7_templates_methods.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">3.3.6 Object type templates</span></p>
<p class="p_Text"><span class="f_Text">An object type template definition begins with a header containing typed parameters (see section <a href="3_3_1_templates_header.htm" class="topiclink">Template Header</a>), and the usual definition of a class, structure, or union.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">template</span><span class="f_CodeExample">&nbsp;&lt;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;[,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Ti</span><span class="f_CodeExample">&nbsp;...]&nbsp;&gt;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">class_name</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The only difference from the standard definition is that template parameters can occur in a block of code, in all syntactic constructs of the language, where it is permissible to use a type name.</span></p>
<p class="p_Text"><span class="f_Text">Once a template is defined, working instances of it are created when the variables of the template type are declared in the code, specifying the specific types in angle brackets:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">ClassName</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Type1</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Type2</span><span class="f_CodeExample">&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">object</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #333333;">StructName</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Type1</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Type2</span><span class="f_CodeExample">,Type3&gt;&nbsp;struct;</span>
<br><span class="f_CodeExample" style="color: #333333;">ClassName</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Type1</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Type2</span><span class="f_CodeExample">&gt;&nbsp;*</span><span class="f_CodeExample" style="color: #333333;">pointer</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ClassName</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Type1</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Type2</span><span class="f_CodeExample">&gt;();</span>
<br><span class="f_CodeExample" style="color: #333333;">ClassName1</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">ClassName2</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Type</span><span class="f_CodeExample">&gt;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">object</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Unlike when calling template functions, the compiler is not able to infer actual types for object templates on its own.</span></p>
<p class="p_Text"><span class="f_Text">Declaring a template class/structure variable is not the only way to instantiate a template. An instance is also generated by the compiler if a template type is used as the base type for another, specific (non-template) class or structure.</span></p>
<p class="p_Text"><span class="f_Text">For example, the following class </span><span class="f_Text" style="font-style: italic;">Worker</span><span class="f_Text">, even if empty, is an implementation of </span><span class="f_Text" style="font-style: italic;">Base</span><span class="f_Text"> for type </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text">:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Worker</span><span class="f_CodeExample">&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Base</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This minimum definition is enough (with allowance for adding constructors if the class </span><span class="f_Text" style="font-style: italic;">Base</span><span class="f_Text"> requires them) to start compiling and validating the template code.</span></p>
<p class="p_Text"><span class="f_Text">In the <a href="3_2_12_classes_new_delete_pointers.htm" class="topiclink">Dynamic object creation</a> section, we got acquainted with the concept of a dynamic pointer to an object obtained using the operator </span><span class="f_Text" style="font-style: italic;">new</span><span class="f_Text">. This flexible mechanism has one drawback: pointers need to be monitored and &quot;manually&quot; deleted when they are no longer needed. In particular, when exiting a function or block of code, all local pointers must be cleared with a call </span><span class="f_Text" style="font-style: italic;">delete</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">To simplify the solution to this problem, let's create a template class </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> (</span><span class="f_Text" style="font-style: italic;">TemplatesAutoPtr.mq5</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">AutoPtr.mqh</span><span class="f_Text">). Its parameter T is used to describe the field </span><span class="f_Text" style="font-style: italic;">ptr</span><span class="f_Text">, which stores a pointer to an object of an arbitrary class. We will receive the pointer value through the constructor parameter (</span><span class="f_Text" style="font-style: italic;">T *p</span><span class="f_Text">) or in the overloaded operator '='. Let's entrust the main work to the destructor: in the destructor, the pointer will be deleted together with the object </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> (the static helper method </span><span class="f_Text" style="font-style: italic;">free</span><span class="f_Text"> is allocated for this).</span></p>
<p class="p_Text"><span class="f_Text">The principle of operation of </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> is simple: a local object of this class will be automatically destroyed upon exiting the block where it is described, and if it was previously instructed to &quot;follow&quot; some pointer, then </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> will free it too.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">template</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;*</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">()&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">)&nbsp;{&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;*</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">)&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">__FUNCSIG__</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;&amp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">__FUNCSIG__</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;&amp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;-&gt;&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">free</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">NULL</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;~</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">__FUNCSIG__</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;&amp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">free</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;*</span><span class="f_CodeExample" style="color: #0000ff;">operator</span><span class="f_CodeExample">=(</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;*</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">__FUNCSIG__</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;&amp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;:&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;-&gt;&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">free</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">*&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">operator</span><span class="f_CodeExample">[](</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">static</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">free</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;*</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">CheckPointer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">POINTER_DYNAMIC</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">delete</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Additionally, the class </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> implements a copy constructor (more precisely, a jump constructor, since the current object becomes the owner of the pointer), which allows you to return an </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> instance along with a controlled pointer from a function.</span></p>
<p class="p_Text"><span class="f_Text">To test the performance of </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text">, we will describe a fictitious class </span><span class="f_Text" style="font-style: italic;">Dummy</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">class</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Dummy</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">:</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Dummy</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">__FUNCSIG__</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;&amp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">value</span><span class="f_CodeExample">()&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">x</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the script, in the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> function, enter the variable </span><span class="f_Text" style="font-style: italic;">AutoPtr&lt;Dummy&gt;</span><span class="f_Text"> and get the value for it from the function </span><span class="f_Text" style="font-style: italic;">generator</span><span class="f_Text">. In the function </span><span class="f_Text" style="font-style: italic;">generator</span><span class="f_Text"> itself, we will also describe the object </span><span class="f_Text" style="font-style: italic;">AutoPtr&lt;Dummy&gt;</span><span class="f_Text"> and sequentially create and &quot;attach&quot; two dynamic objects </span><span class="f_Text" style="font-style: italic;">Dummy</span><span class="f_Text"> to it (to check the correct release memory from the &quot;old&quot; object).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Dummy</span><span class="f_CodeExample">&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">generator</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Dummy</span><span class="f_CodeExample">&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Dummy</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;pointer&nbsp;to&nbsp;1&nbsp;will&nbsp;be&nbsp;freed&nbsp;after&nbsp;execution&nbsp;of&nbsp;'='</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Dummy</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">AutoPtr</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #333333;">Dummy</span><span class="f_CodeExample">&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">generator</span><span class="f_CodeExample">();</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">ptr</span><span class="f_CodeExample">[].</span><span class="f_CodeExample" style="color: #333333;">value</span><span class="f_CodeExample">());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;2</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Since all the main methods log object descriptors (both </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> and controlled pointers </span><span class="f_Text" style="font-style: italic;">ptr</span><span class="f_Text">), we can track all &quot;transformations&quot; of pointers (for convenience, all lines are numbered).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">01&nbsp;Dummy::Dummy(int)&nbsp;3145728</span>
<br><span class="f_CodeExample">02&nbsp;&nbsp;AutoPtr&lt;Dummy&gt;::AutoPtr&lt;Dummy&gt;(Dummy*)&nbsp;2097152:&nbsp;3145728</span>
<br><span class="f_CodeExample">03&nbsp;&nbsp;Dummy::Dummy(int)&nbsp;4194304</span>
<br><span class="f_CodeExample">04&nbsp;&nbsp;Dummy*AutoPtr&lt;Dummy&gt;::operator=(Dummy*)&nbsp;2097152:&nbsp;3145728&nbsp;-&gt;&nbsp;4194304</span>
<br><span class="f_CodeExample">05&nbsp;&nbsp;Dummy::~Dummy()&nbsp;3145728</span>
<br><span class="f_CodeExample">06&nbsp;&nbsp;AutoPtr&lt;Dummy&gt;::AutoPtr&lt;Dummy&gt;(AutoPtr&lt;Dummy&gt;&amp;)&nbsp;5242880:&nbsp;0&nbsp;-&gt;&nbsp;4194304</span>
<br><span class="f_CodeExample">07&nbsp;&nbsp;AutoPtr&lt;Dummy&gt;::~AutoPtr&lt;Dummy&gt;()&nbsp;2097152:&nbsp;0</span>
<br><span class="f_CodeExample">08&nbsp;&nbsp;AutoPtr&lt;Dummy&gt;::AutoPtr&lt;Dummy&gt;(AutoPtr&lt;Dummy&gt;&amp;)&nbsp;1048576:&nbsp;0&nbsp;-&gt;&nbsp;4194304</span>
<br><span class="f_CodeExample">09&nbsp;&nbsp;AutoPtr&lt;Dummy&gt;::~AutoPtr&lt;Dummy&gt;()&nbsp;5242880:&nbsp;0</span>
<br><span class="f_CodeExample">10&nbsp;&nbsp;2</span>
<br><span class="f_CodeExample">11&nbsp;&nbsp;AutoPtr&lt;Dummy&gt;::~AutoPtr&lt;Dummy&gt;()&nbsp;1048576:&nbsp;4194304</span>
<br><span class="f_CodeExample">12&nbsp;&nbsp;Dummy::~Dummy()&nbsp;4194304</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Quote"><span class="f_Quote">Let's digress for a moment from the templates and describe in detail how the utility works because such a class can be useful to many.</span><br>
<span class="f_Quote">&nbsp;</span><br>
<span class="f_Quote">Immediately after starting </span><span class="f_Quote" style="font-style: italic;">OnStart</span><span class="f_Quote">, the function generator is called. It must return a value to initialize the object </span><span class="f_Quote" style="font-style: italic;">AutoPtr</span><span class="f_Quote"> in </span><span class="f_Quote" style="font-style: italic;">OnStart</span><span class="f_Quote">, and therefore its constructor has not yet been called. Line 02 creates an object AutoPtr#2097152 inside the function </span><span class="f_Quote" style="font-style: italic;">generator</span><span class="f_Quote"> and gets a pointer to the first Dummy#3145728. Next, a second instance of Dummy#4194304 is created (line 03), which replaces the previous copy with descriptor 3145728 (line 04) in AutoPtr#2097152, and the old copy is deleted (line 05). Line 06 creates a temporary AutoPtr#5242880 to return the value from the </span><span class="f_Quote" style="font-style: italic;">generator</span><span class="f_Quote">, and deletes the local one (07). On line 08, the copy constructor for the AutoPtr#1048576 object in the function </span><span class="f_Quote" style="font-style: italic;">OnStart</span><span class="f_Quote"> is finally used, and the pointer from the temporary object (which is immediately deleted on line 09) is transferred to it. Next, we call </span><span class="f_Quote" style="font-style: italic;">Print</span><span class="f_Quote"> with the content of the pointer. When the </span><span class="f_Quote" style="font-style: italic;">OnStart</span><span class="f_Quote"> completes, the destructor </span><span class="f_Quote" style="font-style: italic;">AutoPtr</span><span class="f_Quote"> (11) automatically fires, causing us to also delete the work object </span><span class="f_Quote" style="font-style: italic;">Dummy</span><span class="f_Quote"> (12).</span></p>
<p class="p_Text"><span class="f_Text">Template technology makes the class </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> a parameterized manager of dynamically allocated objects. But since </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> has a field </span><span class="f_Text" style="font-style: italic;">T *ptr</span><span class="f_Text">, it only applies to classes (more precisely, pointers to class objects). For example, trying to instantiate a template for a string (</span><span class="f_Text" style="font-style: italic;">AutoPtr&lt;string&gt; s</span><span class="f_Text">) will result in a lot of errors in the template text, the meaning of which is that the </span><span class="f_Text" style="font-style: italic;">string</span><span class="f_Text"> type does not support pointers.</span></p>
<p class="p_Text"><span class="f_Text">This is not a problem here, since the purpose of this template is limited to classes, but for more general templates, this nuance should be kept in mind (see the sidebar).</span></p>
<p class="p_Quote"><span class="f_Quote" style="font-weight: bold;">Pointers and references</span><br>
<span class="f_Quote" style="font-weight: bold;">&nbsp;</span><br>
<span class="f_Quote">Please note that the </span><span class="f_Quote" style="font-style: italic;">T *</span><span class="f_Quote"> construct cannot appear in templates that you plan to use, including for built-in types or structures. The point is that pointers in MQL5 are allowed only for classes. This is not to say that a template cannot in theory be written to apply to both built-in and user-defined types, but it may require some tweaking. It will probably be necessary either to abandon some of the functionality or to sacrifice a level of genericity of the template (make several templates instead of one, overload functions, etc.). </span><br>
<span class="f_Quote" style="font-style: italic;">&nbsp;</span><br>
<span class="f_Quote">The most straightforward way to &quot;inject&quot; a pointer type into a template is to include the modifier '*' along with the actual type when the template is instantiated (i.e. it must match </span><span class="f_Quote" style="font-style: italic;">T=Type*</span><span class="f_Quote">). However, some functions (such as </span><span class="f_Quote" style="font-style: italic;">CheckPointer</span><span class="f_Quote">), operators (such as </span><span class="f_Quote" style="font-style: italic;">delete</span><span class="f_Quote">), and syntactic constructs (such as casting </span><span class="f_Quote" style="font-style: italic;">((T)variable)</span><span class="f_Quote">) are sensitive to whether their arguments/operands are pointers or not. Because of this, the same template text is not always syntactically correct for both pointers and simple type values.</span><br>
<span class="f_Quote" style="font-style: italic;">&nbsp;</span><br>
<span class="f_Quote">Another significant type difference to keep in mind: objects are passed to methods by reference only, but literals (constants) of simple types cannot be passed by reference. Because of this, the presence or absence of an ampersand may be treated as an error by the compiler, depending on the inferred type of T. As one of the &quot;workarounds&quot;, you can optionally &quot;wrap&quot; argument constants into objects or variables.</span><br>
<span class="f_Quote" style="font-style: italic;">&nbsp;</span><br>
<span class="f_Quote">Another trick involves using template methods. We will see it in the next section.</span></p>
<p class="p_Text"><span class="f_Text">It should be noted that object-oriented techniques go well with patterns. Since a pointer to a base class can be used to store an object of a derived class, </span><span class="f_Text" style="font-style: italic;">AutoPtr</span><span class="f_Text"> is applicable to objects of any derived </span><span class="f_Text" style="font-style: italic;">Dummy</span><span class="f_Text"> classes.</span></p>
<p class="p_Text"><span class="f_Text">In theory, this &quot;hybrid&quot; approach is widely used in the container classes (vector, queue, map, list, etc.), which, as a rule, are templates. Container classes may, depending on the implementation, impose additional requirements on the template parameter, in particular, that the inline type must have a copy constructor and an assignment (copy) operator.</span></p>
<p class="p_Text"><span class="f_Text">The MQL5 standard library supplied with MetaTrader 5 contains many ready-made templates from this series: </span><span class="f_Text" style="font-style: italic;">Stack.mqh</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Queue.mqh</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">HashMap.mqh</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">LinkedList.mqh</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">RedBlackTree.mqh,</span><span class="f_Text"> and others. They are all located in the MQL5/Include/Generic directory. True, they do not provide control over dynamic objects (pointers).</span></p>
<p class="p_Text"><span class="f_Text">We'll look at our own example of a simple container class in <a href="3_3_7_templates_methods.htm" class="topiclink">Method templates</a>.</span></p>

</div>

</body>
</html>
