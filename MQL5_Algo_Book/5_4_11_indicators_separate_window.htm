<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>5.4.11 Indicators in separate subwindows: sizes and levels</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part5.htm"> Part 5. Creating application programs </a> / <a class="h_m" href="5_4_indicators_make.htm"> 5.4 Creating custom indicators </a>/ 5.4.11 Indicators in separate subwindows: sizes and levels
          </td>
          <td width="70" align="right">
          <a href="5_4_10_indicators_empty_value.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="5_4_12_indicators_caption_digits.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">5.4.11 Indicators in separate subwindows: sizes and levels</span></p>
<p class="p_Text"><span class="f_Text">Until now, we have limited ourselves to indicators that work in the main chart window, that is, they have the directive </span><span class="f_Text" style="font-style: italic;">#property indicator_chart_window</span><span class="f_Text">. It's time now to study the indicators placed in separate a subwindow below the price chart. Recall that they should be declared with the directive </span><span class="f_Text" style="font-style: italic;">#property indicator_separate_window</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Everything that we learned earlier applies to indicators in a subwindow, including describing and anchoring buffers, setting drawing types and styles, and using both full and shortened forms of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">, to choose from. However, they also have some features and additional settings.</span></p>
<p class="p_Text"><span class="f_Text">Since the subwindow has its value scale, MQL5 allows you to set the maximum and minimum values for it (users can set similar restrictions in the indicator settings dialog, on the tab </span><span class="f_Text" style="font-style: italic;">Scale</span><span class="f_Text">). This is done programmatically using the function </span><span class="f_Text" style="font-style: italic;">IndicatorSetDouble</span><span class="f_Text"> with the following prototype.</span></p>
<p class="p_H4"><span class="f_H4">bool IndicatorSetDouble(ENUM_CUSTOMIND_PROPERTY_DOUBLE property, double value)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool IndicatorSetDouble(ENUM_CUSTOMIND_PROPERTY_DOUBLE property, int modifier,</span><br>
<span class="f_H4"> &nbsp; double value)</span></p>
<p class="p_Text"><span class="f_Text">The function sets a </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text"> property value for an indicator. Two forms were required because some properties can be multiple, in particular, horizontal levels (they will be discussed a little later). The available properties are collected in the ENUM_CUSTOMIND_PROPERTY_DOUBLE enum.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:33%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_MINIMUM</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Minimum on the vertical axis</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_MAXIMUM</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Maximum on the vertical axis</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_LEVELVALUE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Horizontal level value (the number is set in the modifier parameter)</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">A fixed scale range is used in many oscillatory indicators, such as WPR. We will see an example with it, covering all the functions (properties) from this section.</span></p>
<p class="p_Text"><span class="f_Text">The function returns </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text"> on success and </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text"> otherwise.</span></p>
<p class="p_Text"><span class="f_Text">In addition to controlling the scale, indicators in the subwindow can, as we have already understood, have horizontal levels. To set their number and attributes, another function is used, </span><span class="f_Text" style="font-style: italic;">IndicatorSetInteger</span><span class="f_Text">. The user can perform similar actions in the indicator settings dialog on the tab </span><span class="f_Text" style="font-style: italic;">Levels</span><span class="f_Text"> tab/</span></p>
<p class="p_H4"><span class="f_H4">bool IndicatorSetInteger(ENUM_CUSTOMIND_PROPERTY_INTEGER property, int value)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool IndicatorSetInteger(ENUM_CUSTOMIND_PROPERTY_INTEGER property, int modifier,</span><br>
<span class="f_H4"> &nbsp; int value)</span></p>
<p class="p_Text"><span class="f_Text">The function also has two forms and allows you to set the value of the type property for the indicator </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text"> or equivalent (for example, </span><span class="f_Text" style="font-style: italic;">color</span><span class="f_Text"> or listing). The available properties are collected in the ENUM_CUSTOMIND_PROPERTY_INTEGER enumeration. In addition to the properties associated with levels, it contains the INDICATOR_DIGITS property, which is common for indicators of any type: we will consider it in the <a href="5_4_12_indicators_caption_digits.htm" class="topiclink">next section</a>.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:33%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_DIGITS</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Accuracy of displaying indicator values (digits after the decimal point)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_HEIGHT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Fixed height of the indicator's own window in pixels (preprocessor command </span><span class="f_fortable" style="font-style: italic;">#property indicator_height</span><span class="f_fortable">)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_LEVELS</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Number of horizontal levels in the indicator window</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_LEVELCOLOR</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Level line color (has the </span><span class="f_fortable" style="font-style: italic;">color</span><span class="f_fortable"> type, the </span><span class="f_fortable" style="font-style: italic;">modifier</span><span class="f_fortable"> parameter sets the level number)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_LEVELSTYLE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Level line style (has a type <a href="5_4_6_indicators_plotindexsetinteger.htm" class="topiclink">ENUM_LINE_STYLE</a>, the </span><span class="f_fortable" style="font-style: italic;">modifier</span><span class="f_fortable"> parameter sets the level number)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_LEVELWIDTH</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Level line thickness (1-5) (the </span><span class="f_fortable" style="font-style: italic;">modifier</span><span class="f_fortable"> parameter sets the level number)</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">Levels can have text labels. To assign them, use the </span><span class="f_Text" style="font-style: italic;">IndicatorSetString</span><span class="f_Text"> function.</span></p>
<p class="p_H4"><span class="f_H4">bool IndicatorSetString(ENUM_CUSTOMIND_PROPERTY_STRING property, string value)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool IndicatorSetString(ENUM_CUSTOMIND_PROPERTY_STRING property, int modifier,</span><br>
<span class="f_H4"> &nbsp; string value)</span></p>
<p class="p_Text"><span class="f_Text">ENUM_CUSTOMIND_PROPERTY_STRING contains the list of string indicator parameters. Pay attention to the INDICATOR_SHORTNAME property which is not related to levels: it is also common to all indicators and will be discussed in the <a href="5_4_12_indicators_caption_digits.htm" class="topiclink">next section</a>.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:33%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_SHORTNAME</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Indicator public title</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:33%;"><p class="p_fortable"><span class="f_fortable">INDICATOR_LEVELTEXT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Description of the level (the number is indicated in the modifier)</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">All mentioned functions for numeric types </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text"> are duplicated by special directives (below is a summary table).</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:25%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Directives&nbsp;for&nbsp;</span><br>
<span class="f_BoldTitlesInTables">level&nbsp;properties</span></p>
</th>
<th class="table" style="width:30%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Analog&nbsp;functions</span></p>
</th>
<th class="table" style="width:15%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Type&nbsp;of&nbsp;</span><br>
<span class="f_BoldTitlesInTables">property</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:25%;"><p class="p_fortable"><span class="f_fortable">indicator_levelN</span></p>
</td>
<td class="table" style="width:30%;"><p class="p_fortable"><span class="f_fortable">IndicatorSetDouble(</span><br>
<span class="f_fortable">INDICATOR_LEVELVALUE,</span><br>
<span class="f_fortable">N-1, value)</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable"><span class="f_fortable">double</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Value for the horizontal level number N on the vertical axis</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:25%;"><p class="p_fortable"><span class="f_fortable">indicator_levelcolor</span></p>
</td>
<td class="table" style="width:30%;"><p class="p_fortable"><span class="f_fortable">IndicatorSetInteger(</span><br>
<span class="f_fortable">INDICATOR_LEVELCOLOR,</span><br>
<span class="f_fortable">N-1, color)</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable"><span class="f_fortable">color</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Color of horizontal levels (different colors by numbers can only be set using the function)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:25%;"><p class="p_fortable"><span class="f_fortable">indicator_levelwidth</span></p>
</td>
<td class="table" style="width:30%;"><p class="p_fortable"><span class="f_fortable">IndicatorSetInteger(</span><br>
<span class="f_fortable">INDICATOR_LEVELWIDTH,</span><br>
<span class="f_fortable">N-1, width)</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable"><span class="f_fortable">int</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Line thickness of horizontal levels in pixels (different thickness by numbers can only be set using the function)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:25%;"><p class="p_fortable"><span class="f_fortable">indicator_levelstyle</span></p>
</td>
<td class="table" style="width:30%;"><p class="p_fortable"><span class="f_fortable">IndicatorSetInteger(</span><br>
<span class="f_fortable">INDICATOR_LEVELSTYLE,</span><br>
<span class="f_fortable">N-1, style)</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable"><span class="f_fortable">ENUM</span><br>
<span class="f_fortable">_LINE</span><br>
<span class="f_fortable">_STYLE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Line styles of horizontal levels (different styles by number can only be set using the function)</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:25%;"><p class="p_fortable"><span class="f_fortable">indicator_minimum</span></p>
</td>
<td class="table" style="width:30%;"><p class="p_fortable"><span class="f_fortable">IndicatorSetDouble(</span><br>
<span class="f_fortable">INDICATOR_MINIMUM, minimum)</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable"><span class="f_fortable">double</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Fixed minimum value, lower scale limit on the vertical axis</span></p>
</td>
</tr>
<tr class="table">
<td class="table" style="width:25%;"><p class="p_fortable"><span class="f_fortable">indicator_maximum</span></p>
</td>
<td class="table" style="width:30%;"><p class="p_fortable"><span class="f_fortable">IndicatorSetDouble(</span><br>
<span class="f_fortable">INDICATOR_MAXIMUM, maximum)</span></p>
</td>
<td class="table" style="width:15%;"><p class="p_fortable"><span class="f_fortable">double</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Fixed maximum value, upper scale limit on the vertical axis</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">Please note that the numbering of property instances (modifiers) when using </span><span class="f_Text" style="font-style: italic;">#property</span><span class="f_Text"> directives starts from 1 (one), while functions use numbering from 0 (zero).</span></p>
<p class="p_Text"><span class="f_Text">An attentive reader will notice that there are no directives for some properties. These include INDICATOR_LEVELTEXT, INDICATOR_SHORTNAME, INDICATOR_DIGITS. It is assumed that these properties should be filled dynamically from the MQL code, depending on the input variables and the chart on which the indicator is placed. INDICATOR_LEVELS is set indirectly by specifying several directives for levels. &nbsp;</span></p>
<p class="p_Text"><span class="f_Text">Finally, the hallmark of indicators in a subwindow is that a program can &quot;freeze&quot; the vertical size of its window.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table" style="width:30%;"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Directive&nbsp;for&nbsp;</span><br>
<span class="f_BoldTitlesInTables">subwindow&nbsp;size</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Analog&nbsp;function</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table" style="width:30%;"><p class="p_fortable"><span class="f_fortable">indicator_height</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">IndicatorSetInteger(</span><br>
<span class="f_fortable">INDICATOR_HEIGHT, height)</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Fixed height of the indicator subwindow in pixels (the user will not be able to change the height)</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">A fixed subwindow height is usually used only for control panels with controls (buttons, flags, input fields) implemented using <a href="5_8_objects.htm" class="topiclink">graphical objects</a>.</span></p>
<p class="p_Text"><span class="f_Text">For property setting functions, unfortunately, there are no inverses (</span><span class="f_Text" style="font-style: italic;">IndicatorGetInteger</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">IndicatorGetDouble</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">IndicatorGetString</span><span class="f_Text">). Among other things, this does not allow, for example, finding the number and values of horizontal levels if they have been changed by the user.</span></p>
<p class="p_Text"><span class="f_Text">As an example of working with a fixed scale and levels, consider the indicator </span><span class="f_Text" style="font-style: italic;">IndWPR.mq5</span><span class="f_Text">. In it, we will use the standard WPR algorithm: on a given number of past bars (WPR period), we will find the highs H and the lows L of the price (that is, its range). Then we calculate the ratio of the difference between the current price C and the low L, C - L (or the difference -(H - C), with a minus sign) to the entire range, and bring everything into the range from 0 to -100. Here is the canonical formula for calculating WPR:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #333333;">R</span><span class="f_CodeExample">%&nbsp;=&nbsp;(-(</span><span class="f_CodeExample" style="color: #333333;">H</span><span class="f_CodeExample">&nbsp;–&nbsp;</span><span class="f_CodeExample" style="color: #333333;">C</span><span class="f_CodeExample">)&nbsp;/&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">H</span><span class="f_CodeExample">&nbsp;–&nbsp;</span><span class="f_CodeExample" style="color: #333333;">L</span><span class="f_CodeExample">))&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #333333;">100</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Let's add some directives at the beginning of the source code. In addition to the indicator location property in its own window, let's set the value scale from 0 to -100.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_separate_window</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_maximum</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">0</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_minimum</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">100</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">0</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">One buffer and one line chart are enough to store values and display the indicator.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_buffers</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_plots</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_type1</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">DRAW_LINE</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_color1</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">clrDodgerBlue</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the WPR indicator, it is customary to single out two levels: -20 and -80, as the boundaries of overbought and oversold areas, respectively. Let's create a couple of horizontal lines for them.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_level1</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">20</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">0</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_level2</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">80</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">0</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_levelstyle</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">STYLE_DOT</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_levelcolor</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">clrSilver</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#property</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">indicator_levelwidth</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The only input variable allows you to set the calculation period for WPR.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">14</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;Period</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The array for the buffer is declared at the global level and registered with </span><span class="f_Text" style="font-style: italic;">OnInit</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRBuffer</span><span class="f_CodeExample">[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnInit</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;check&nbsp;for&nbsp;correct&nbsp;input</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Alert</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Incorrect&nbsp;Period&nbsp;value&nbsp;(%d).&nbsp;Should&nbsp;be&nbsp;1&nbsp;or&nbsp;larger&quot;</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;binding&nbsp;array&nbsp;as&nbsp;buffer</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">SetIndexBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRBuffer</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The handler </span><span class="f_Text" style="font-style: italic;">OnInit</span><span class="f_Text"> is described with type </span><span class="f_Text" style="font-style: italic;">void</span><span class="f_Text">, which implicitly implies successful initialization. However, if the period is set to less than 1, it will not allow the calculation to be made and a warning is given to the user.</span></p>
<p class="p_Text"><span class="f_Text">To simplify the function header </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">, the header file </span><span class="f_Text" style="font-style: italic;">IndCommon.mqh</span><span class="f_Text"> was prepared for indicators, with two macros describing the standard parameter lists of both forms of the event handler.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ON_CALCULATE_STD_FULL_PARAM_LIST</span><span class="f_CodeExample">&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">prev_calculated</span><span class="f_CodeExample">,&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">[],&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">open</span><span class="f_CodeExample">[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">tick_volume</span><span class="f_CodeExample">[],&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">volume</span><span class="f_CodeExample">[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">spread</span><span class="f_CodeExample">[]</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">#define</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ON_CALCULATE_STD_SHORT_PARAM_LIST</span><span class="f_CodeExample">&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">prev_calculated</span><span class="f_CodeExample">,&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">begin</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">[]</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Now we can use the concise definition of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> in this and other indicators (provided that we are satisfied with the proposed parameter names in macros).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#include</span><span class="f_CodeExample">&nbsp;&lt;</span><span class="f_CodeExample" style="color: #333333;">MQL5Book</span><span class="f_CodeExample">/</span><span class="f_CodeExample" style="color: #333333;">IndCommon</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">mqh</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample">&nbsp;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnCalculate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ON_CALCULATE_STD_FULL_PARAM_LIST</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;||&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">At the beginning of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">, we check if it is possible to calculate using the current values of </span><span class="f_Text" style="font-style: italic;">WPRPeriod</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text">. If there is not enough data or the period is too short, it returns 0, which will leave the indicator window empty.</span></p>
<p class="p_Text"><span class="f_Text">Next, we fill in the first few bars for which it is impossible to calculate the WPR of a given period with an empty value.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnCalculate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ON_CALCULATE_STD_FULL_PARAM_LIST</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">prev_calculated</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayFill</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">WPRBuffer</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">EMPTY_VALUE</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Finally, we run the WPR calculations and buffer the results. Note that the last bar is updated on every tick: this is achieved by starting the loop with </span><span class="f_Text" style="font-style: italic;">prev_calculated - 1</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnCalculate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ON_CALCULATE_STD_FULL_PARAM_LIST</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">fmax</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">prev_calculated</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">&nbsp;&amp;&amp;&nbsp;!</span><span class="f_CodeExample" style="color: #0000ff;">IsStopped</span><span class="f_CodeExample">();&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">++)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">max_high</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #0000ff;">fmax</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">ArrayMaximum</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">),&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">min_low</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #0000ff;">fmax</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">ArrayMinimum</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRPeriod</span><span class="f_CodeExample">),&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">max_high</span><span class="f_CodeExample">&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">min_low</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRBuffer</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;=&nbsp;-(</span><span class="f_CodeExample" style="color: #333333;">max_high</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">])&nbsp;*&nbsp;</span><span class="f_CodeExample" style="color: #333333;">100</span><span class="f_CodeExample">&nbsp;/&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">max_high</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">min_low</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRBuffer</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">WPRBuffer</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text" style="font-style: italic;">ArrayMaximum</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">ArrayMinimum</span><span class="f_Text"> functions allow searching for the indexes of the highest </span><span class="f_Text" style="font-style: italic;">high</span><span class="f_Text"> and the lowest </span><span class="f_Text" style="font-style: italic;">low</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">The indicator appears in a separate window as follows.</span></p>
<p class="p_Text" style="text-align: center;"><img class="help" alt="WPR indicator" title="WPR indicator" width="600" height="400" style="margin:0 auto 0 auto;width:600px;height:400px;border:none" src="eurusdh1-wpr1.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">WPR indicator</span></p>
<p class="p_Text"><span class="f_Text">In the following sections, we will continue to improve this indicator, gradually adding other commonly used properties.</span></p>

</div>

</body>
</html>
