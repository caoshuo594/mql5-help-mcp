<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>1.9 Error fixing and debugging</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part1.htm"> Part 1. Introduction to MQL5 and development environment </a>/ 1.9 Error fixing and debugging
          </td>
          <td width="70" align="right">
          <a href="1_8_data_input.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="1_a_data_output.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H2"><span class="f_H2">1.9 Error fixing and debugging</span></p>
<p class="p_Text"><span class="f_Text">Programming art relies on the ability to instruct the program what and how it must do and also to protect it against potentially doing something wrong. The latter one is unfortunately much more difficult to execute due to multiple not very obvious factors affecting the program behavior. Incorrect data, insufficient resources, somebody else's and one's own coding errors are just to name some of the problems.</span></p>
<p class="p_Text"><span class="f_Text">Nobody is insured against errors in coding programs. Errors may occur at different stages and are conveniently divided into:</span></p>
<ul>
<li class="p_li"><span class="f_li">Compilation errors returned by the compiler when identifying a source code that does not meet the required syntax (we have already learned about such errors above); it is easiest to fix them because the compiler searches for them;</span></li>
<li class="p_li"><span class="f_li">Program runtime errors returned by the terminal, if an incorrect condition occurs in the program, such as division by zero, computing the square root of a negative, or an attempt to refer to a non-existing element of the array, as in our case; they are more difficult to detect since they usually occur not at any values of input parameters, but only in specific conditions;</span></li>
<li class="p_li"><span class="f_li">Program designing errors that lead to its complete shutdown without any tips from the terminal, such as sticking at an infinite loop; such errors may turn out to be the most complex in terms of locating and reproducing them, while the reproducibility of a problem in the program is a necessary condition for fixing it afterward; and</span></li>
<li class="p_li"><span class="f_li">Hidden errors, where the program seems to work smoothly, but the result provided is not correct; it is easy to detect if 2*2 is not 4, while it is much more difficult to notice the discrepancies.</span></li>
</ul>
<p class="p_Text"><span class="f_Text">But let's get back to the specific situation with our script. According to the error message provided to us by the MQL program runtime environment, the following statement is wrong:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">messages</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">hour</span><span class="f_CodeExample">&nbsp;/&nbsp;</span><span class="f_CodeExample" style="color: #333333;">8</span><span class="f_CodeExample">]</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In computing the index of an element from the array, depending on the value of the </span><span class="f_Text" style="font-style: italic;">hour</span><span class="f_Text"> variable, a value may be obtained that goes beyond the array size of three.</span></p>
<p class="p_Text"><span class="f_Text">The debugger embedded in MetaEditor allows making sure that it really happens. All its commands are collected in the Debug menu. They provide many useful functions. Here we are going to only settle on two: </span><span class="f_Text" style="font-style: italic;">Debut -&gt; Start on Real Data</span><span class="f_Text"> (F5) and </span><span class="f_Text" style="font-style: italic;">Debug -&gt; Start on History Data</span><span class="f_Text"> (Ctrl+F5). You can read about the other ones in the MetaEditor Help.</span></p>
<p class="p_Text"><span class="f_Text">Both commands compile the program in a special manner – with the debugging information. Such a version of the program is not optimized as in standard compilation (more details on optimization, please see Documentation), while at the same time, it allows using the debugging information to 'look inside' the program during execution: See the states of variables and function call stacks.</span></p>
<p class="p_Text"><span class="f_Text">The difference between debugging on real data and on history data consists in starting the program on an online chart with the former one and on the tester chart in a visual mode with the latter one. To instruct the editor on what exactly chart and with which settings to use, i.e., symbol, timeframe, date range, etc., you should preliminarily open the dialog </span><span class="f_Text" style="font-style: italic;">Settings -&gt; Debug</span><span class="f_Text"> and fill out the required fields in it. Option </span><span class="f_Text" style="font-style: italic;">Use specified settings</span><span class="f_Text"> must be enabled. If it is disabled, the first symbol from the </span><span class="f_Text" style="font-style: italic;">Market Watch</span><span class="f_Text"> and timeframe H1 will be used in online debugging, while tester settings are used when debugging on history data.</span></p>
<p class="p_Text"><span class="f_Text">Please note that only indicators and Expert Advisors can be debugged in the tester. Only online debugging is available to scripts.</span></p>
<p class="p_Text"><span class="f_Text">Let's run our script using F5 and enter 100 in parameter </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> to reproduce the above problem situation. The script will start executing, and the terminal will practically immediately display an error message and request for opening the debugger.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Critical&nbsp;error&nbsp;while&nbsp;running&nbsp;script&nbsp;'GoodTime1&nbsp;(EURUSD,H1)'.</span>
<br><span class="f_CodeExample">Array&nbsp;out&nbsp;of&nbsp;range.</span>
<br><span class="f_CodeExample">Continue&nbsp;in&nbsp;debugger?</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Having responded in the affirmative, we will get into MetaEditor where the current string is highlighted in the source code, in which the error has occurred (please give a notice of the green arrow in the left field).</span></p>
<p class="p_ImageCaption"><img class="help" alt="MetaEditor in the debugging mode in case of an error" title="MetaEditor in the debugging mode in case of an error" width="600" height="396" style="margin:0 auto 0 auto;width:600px;height:396px;border:none" src="me_debug_en.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">MetaEditor in the debugging mode in case of an error</span></p>
<p class="p_Text"><span class="f_Text">The current call stack is displayed in the lower left window part: All functions are listed in it (in bottom-up order), which had been called before the code execution stopped at the current string. In particular, in our script, the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> function was called (by the terminal itself), and the </span><span class="f_Text" style="font-style: italic;">Greeting</span><span class="f_Text"> function was called from it (we called it from our code). An overview panel is in the lower right part of the window. Names of variables can be entered into it, or the entire expressions into the </span><span class="f_Text" style="font-style: italic;">Expression</span><span class="f_Text"> column, and watch their values in the </span><span class="f_Text" style="font-style: italic;">Values</span><span class="f_Text"> columns in the same string.</span></p>
<p class="p_Text"><span class="f_Text">For instance, we can use the </span><span class="f_Text" style="font-style: italic;">Add</span><span class="f_Text"> command of the context menu or double-click with the mouse on the first free string to enter the expression &quot;hour / 8&quot; and make sure that it is equal to 12.</span></p>
<p class="p_Text"><span class="f_Text">Since debugging stopped resulting from an error, there is no sense to continue the program; therefore we can execute the </span><span class="f_Text" style="font-style: italic;">Debug -&gt; Stop</span><span class="f_Text"> command (Shift+F5).</span></p>
<p class="p_Text"><span class="f_Text">In more complex cases of a not so obvious problem source, the debugger allows the string-by-string monitoring of the sequence of executing the statements and the contents of variables.</span></p>
<p class="p_Text"><span class="f_Text">To solve the problem, it is necessary to ensure that, in the code, the element index always falls within the range of 0-2, i.e., complies with the array size. Strictly speaking, we should have written some additional statements checking the data entered for correctness (in our case, </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> can only take a value within the range of 0-23), and then either display a tip or fix it automatically in case of violation of the conditions.</span></p>
<p class="p_Text"><span class="f_Text">Within this introductory project, we will not go beyond a simple correction: We will improve the expression that computes the element index so that its result always falls within the required range. For this purpose, let's learn about one more operator – the modulus operator that only works for integers. To denote this operation, we use symbol '%'. The result of the modulus operation is the remainder of the integer division of dividend by the divisor. For example:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">11&nbsp;%&nbsp;5&nbsp;=&nbsp;1</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here, with the integer division of 11 by 5, we would obtain 2, which corresponds with the largest factor of 5 within 11, which is 10. The remainder between 11 and 10 is exactly 1.</span></p>
<p class="p_Text"><span class="f_Text">To fix the error in function </span><span class="f_Text" style="font-style: italic;">Greeting</span><span class="f_Text">, suffice to preliminarily perform the modulus division of </span><span class="f_Text" style="font-style: italic;">hour</span><span class="f_Text"> by 24, which will ensure that the hour number will range within 0-23. Function </span><span class="f_Text" style="font-style: italic;">Greeting</span><span class="f_Text"> will look as follows:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Greeting</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">hour</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">messages</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">]&nbsp;=&nbsp;{</span><span class="f_CodeExample" style="color: #008080;">&quot;Good&nbsp;morning&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Good&nbsp;afternoon&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Good&nbsp;evening&quot;</span><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">messages</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">hour</span><span class="f_CodeExample">&nbsp;%&nbsp;</span><span class="f_CodeExample" style="color: #333333;">24</span><span class="f_CodeExample">&nbsp;/&nbsp;</span><span class="f_CodeExample" style="color: #333333;">8</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Although this correction will surely work well (we are going to check it in a minute), it does not concern another problem that is left beyond our focus. The matter is that the </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> parameter is of the </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text"> type, i.e., it can take both positive and negative values. If we tried to enter -&#8204;8, for instance, or a 'more negative' number, then we would get the same runtime error, i.e., going beyond the array; just, in this case, the index does not exceed the highest value (array size) but becomes smaller than the lowest one (particularly, -8 leads to referring to the -1st element, interestingly, the values from -7 to -1 being displayed onto the 0th element and do not cause any error).</span></p>
<p class="p_Text"><span class="f_Text">To fix this problem, we will replace the type of parameter </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> with the unsigned integer: We will use </span><span class="f_Text" style="font-style: italic;">uint</span><span class="f_Text"> instead of </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text"> (we will tell about all available types in part two, and here it is </span><span class="f_Text" style="font-style: italic;">uint</span><span class="f_Text"> that we need). Guided by the limit for the non-negativity of values, built in at the compiler level for </span><span class="f_Text" style="font-style: italic;">uint</span><span class="f_Text">, MQL5 will independently ensure that neither the user (in the properties dialog) nor the program (in its computation) &quot;goes negative.&quot;</span></p>
<p class="p_Text"><span class="f_Text">Let's save the new version of the script as </span><span class="f_Text" style="font-style: italic;">GoodTime2</span><span class="f_Text">, compile, and launch it. We enter the value of 100 for the </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> parameter and make sure that, this time, the script is executed without any errors, while the greeting &quot;Good morning&quot; is printed in the terminal log. It is the expected (correct) behavior since we can use a calculator and check that the remainder of the modulus division of 100 by 24 gives 4, while the integer division of 4 by 8 is 0, which means morning, in our case. From the user's point of view, of course, this behavior can be considered as unexpected. However, entering 100 as the hour number was also an unexpected user action. The user probably thought that our program would go down. But this did not happen, and this is a good point. Of course, with real programs, the values entered must be validated and the user must be notified about bugs.</span></p>
<p class="p_Text"><span class="f_Text">As an additional measure of preventing from entering a wrong number, we will also use a special MQL5 feature to give a more detailed and friendly name to the input parameter. For this purpose, we will use a comment after the input parameter description in the same string. For example, like this:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">GreetingHour</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;Greeting&nbsp;Hour&nbsp;(0-23)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Please note that we have written the words from the variable name separately in the comment (it is not an identifier in the code anymore, but a tip for the user in it). Moreover, we added the range of valid values in parentheses. When launching the script, the previous </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> will appear in the dialog to enter the parameters as follows:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Greeting&nbsp;Hour&nbsp;(0-23)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Now we can be sure that, if 100 is entered as the hour, it is not our fault.</span></p>
<p class="p_Text"><span class="f_Text">A careful reader may wonder why we have defined the </span><span class="f_Text" style="font-style: italic;">Greeting</span><span class="f_Text"> function with the </span><span class="f_Text" style="font-style: italic;">hour</span><span class="f_Text"> parameter and send </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> into it if we could use the input parameter in it directly. Function, as a discrete logical fragment of a code, is formed for both dividing the program into visible and easy-to-understand parts and reusing them subsequently. Functions are usually called from several parts of the program or are part of a library that is connected to multiple different programs. Therefore, a properly written function must be independent of the external context and can be moved among programs.</span></p>
<p class="p_Text"><span class="f_Text">For instance, if we need to transfer our function </span><span class="f_Text" style="font-style: italic;">Greeting</span><span class="f_Text"> into another script, it will stop being compiled, since there won't be the </span><span class="f_Text" style="font-style: italic;">GreetingHour</span><span class="f_Text"> parameter in it. It is not quite correct to require adding it, because the other script can compute the time in another manner. In other words, when writing a function, we should do our best to avoid unnecessary external dependencies. Instead, we should declare the function parameters that can be filled out with the calling code.</span></p>

</div>

</body>
</html>
