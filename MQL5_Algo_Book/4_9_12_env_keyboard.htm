<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>4.9.12 Checking Keyboard Status</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part4.htm"> Part 4. Common APIs </a> / <a class="h_m" href="4_9_environment.htm"> 4.9 MQL program execution environment </a>/ 4.9.12 Checking keyboard status
          </td>
          <td width="70" align="right">
          <a href="4_9_11_env_signature.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="4_9_13_env_stop.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">4.9.12 Checking keyboard status</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">TerminalInfoInteger</span><span class="f_Text"> function can be used to find out the state of the control keys, which are also called virtual. These include, in particular, </span><span class="f_Text" style="font-style: italic;">Ctrl</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Alt</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Shift</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Enter</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Ins</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Del</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Esc</span><span class="f_Text">, arrows, and so on. They are called virtual because keyboards, as a rule, provide several ways to generate the same control action. For example, </span><span class="f_Text" style="font-style: italic;">Ctrl</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">Shift</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">Alt</span><span class="f_Text"> are duplicated to the left and right of the spacebar, while the cursor can be moved both by dedicated keys and by the main ones when </span><span class="f_Text" style="font-style: italic;">Fn</span><span class="f_Text"> is pressed. Thus, this function cannot distinguish between control methods at the physical level (for example, the left and right </span><span class="f_Text" style="font-style: italic;">Shift</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">The API defines constants for the following keys:</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 7px 17px 6px 17px;"><table class="table" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="table">
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Identifier</span></p>
</th>
<th class="table"><p class="p_BoldTitlesInTables"><span class="f_BoldTitlesInTables">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_LEFT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Left Arrow</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_UP</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Up Arrow</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_RIGHT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Right Arrow</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_DOWN</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Down Arrow</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_SHIFT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Shift</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_CONTROL</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Ctrl</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_MENU</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Windows</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_CAPSLOCK</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">CapsLock</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_NUMLOCK</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">NumLock</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_SCRLOCK</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">ScrollLock</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_ENTER</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Enter</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_INSERT</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Insert</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_DELETE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Delete</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_HOME</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Home</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_END</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">End</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_TAB</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Tab</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_PAGEUP</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">PageUp</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_PAGEDOWN</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">PageDown</span></p>
</td>
</tr>
<tr class="table">
<td class="table"><p class="p_fortable"><span class="f_fortable">TERMINAL_KEYSTATE_ESCAPE</span></p>
</td>
<td class="table"><p class="p_fortable"><span class="f_fortable">Escape</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Text"><span class="f_Text">The function returns a two-byte integer value that reports the current state of the requested key using a pair of bits.</span></p>
<p class="p_Text"><span class="f_Text">The least significant bit keeps track of keystrokes since the last function call. For example, if </span><span class="f_Text" style="font-style: italic;">TerminalInfoInteger(TERMINAL_KEYSTATE_ESCAPE)</span><span class="f_Text"> returned 0 at some point, and then the user pressed </span><span class="f_Text" style="font-style: italic;">Escape</span><span class="f_Text">, then on the next call, </span><span class="f_Text" style="font-style: italic;">TerminalInfoInteger(TERMINAL_KEYSTATE_ESCAPE)</span><span class="f_Text"> will return 1. If the key is pressed again, the value will return to 0.</span></p>
<p class="p_Text"><span class="f_Text">For keys responsible for switching input modes, such as </span><span class="f_Text" style="font-style: italic;">CapsLock</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">NumLock</span><span class="f_Text">, and S</span><span class="f_Text" style="font-style: italic;">crollLock</span><span class="f_Text">, the position of the bit indicates whether the corresponding mode is enabled or disabled.</span></p>
<p class="p_Text"><span class="f_Text">The most significant bit of the second byte (0x8000) is set if the key is pressed (and not released) at the current moment.</span></p>
<p class="p_Text"><span class="f_Text">This feature cannot be used to track pressing of alphanumeric and functional keys. For this purpose, it is necessary to implement the </span><span class="f_Text" style="font-style: italic;"><a href="5_9_1_events_onchartevent.htm" class="topiclink">OnChartEvent</a></span><span class="f_Text"> handler and intercept messages with the CHARTEVENT_KEYDOWN code in the program. Please note that events are generated on the chart and are only available for Expert Advisors and indicators. Programs of other types (scripts and services) do not support the event programming model.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">EnvKeys.mq5</span><span class="f_Text"> script includes a loop through all TERMINAL_KEYSTATE constants.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">ENUM_TERMINAL_INFO_INTEGER</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">TERMINAL_KEYSTATE_TAB</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">TERMINAL_KEYSTATE_SCRLOCK</span><span class="f_CodeExample">;&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">e</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">EnumToString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;skip&nbsp;values&nbsp;that&nbsp;are&nbsp;not&nbsp;enum&nbsp;elements</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringFind</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">e</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;ENUM_TERMINAL_INFO_INTEGER&quot;</span><span class="f_CodeExample">)&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">continue</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;%s=%4X&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">e</span><span class="f_CodeExample">,&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">ushort</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #0000ff;">TerminalInfoInteger</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">You can experiment with keystrokes and enable/disable keyboard modes to see how the values change in the log.</span></p>
<p class="p_Text"><span class="f_Text">For example, if capitalization is disabled by default, we will see the following log:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">TERMINAL_KEYSTATE_SCRLOCK=&nbsp;0</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">If we press the ScrollLock key and, without releasing it, run the script again, we get the following log:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">TERMINAL_KEYSTATE_CAPSLOCK=8001</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">That is, the mode is already on and the key is pressed. Let's release the key, and the next time the script will return:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">TERMINAL_KEYSTATE_SCRLOCK=&nbsp;1</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The mode remained on, but the key was released.</span></p>
<p class="p_Text"><span class="f_Text" style="font-style: italic;">TerminalInfoInteger</span><span class="f_Text"> is not suitable for checking the status of keys (TERMINAL_KEYSTATE_XYZ) in dependent indicators created by the </span><span class="f_Text" style="font-style: italic;"><a href="5_5_2_indicators_icustom.htm" class="topiclink">iCustom</a></span><span class="f_Text"> or </span><span class="f_Text" style="font-style: italic;"><a href="5_5_8_indicators_indicatorcreate.htm" class="topiclink">IndicatorCreate</a></span><span class="f_Text"> call. In them, the function always returns 0, even if the indicator was added to the chart using </span><span class="f_Text" style="font-style: italic;"><a href="5_7_22_charts_indicators.htm" class="topiclink">ChartIndicatorAdd</a></span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Also, the function does not work when the MQL program chart is not active (the user has switched to another one). MQL5 does not provide means for permanent control of the keyboard.</span></p>

</div>

</body>
</html>
