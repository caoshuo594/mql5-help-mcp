<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>6.5.8 Auto-tuning: ParameterGetRange and ParameterSetRange</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part6.htm"> Part 6. Trading automation </a> / <a class="h_m" href="6_5_tester.htm"> 6.5 Testing and optimization of Expert Advisors </a>/ 6.5.8 Auto-tuning: ParameterGetRange and ParameterSetRange
          </td>
          <td width="70" align="right">
          <a href="6_5_7_tester_ontester.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="6_5_9_tester_ontester_init_pass_deinit.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">6.5.8 Auto-tuning: ParameterGetRange and ParameterSetRange</span></p>
<p class="p_Text"><span class="f_Text">In the previous section, we learned how to pass an optimization criterion to the tester. However, we missed one important point. If you look into our optimization logs, you can see a lot of error messages there, like the ones below.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">...</span>
<br><span class="f_CodeExample">Best&nbsp;result&nbsp;90.61004580175876&nbsp;produced&nbsp;at&nbsp;generation&nbsp;25.&nbsp;Next&nbsp;generation&nbsp;26</span>
<br><span class="f_CodeExample">genetic&nbsp;pass&nbsp;(26,&nbsp;388)&nbsp;tested&nbsp;with&nbsp;error&nbsp;&quot;incorrect&nbsp;input&nbsp;parameters&quot;&nbsp;in&nbsp;0:00:00.021</span>
<br><span class="f_CodeExample">genetic&nbsp;pass&nbsp;(26,&nbsp;436)&nbsp;tested&nbsp;with&nbsp;error&nbsp;&quot;incorrect&nbsp;input&nbsp;parameters&quot;&nbsp;in&nbsp;0:00:00.007</span>
<br><span class="f_CodeExample">genetic&nbsp;pass&nbsp;(26,&nbsp;439)&nbsp;tested&nbsp;with&nbsp;error&nbsp;&quot;incorrect&nbsp;input&nbsp;parameters&quot;&nbsp;in&nbsp;0:00:00.007</span>
<br><span class="f_CodeExample">genetic&nbsp;pass&nbsp;(26,&nbsp;363)&nbsp;tested&nbsp;with&nbsp;error&nbsp;&quot;incorrect&nbsp;input&nbsp;parameters&quot;&nbsp;in&nbsp;0:00:00.008</span>
<br><span class="f_CodeExample">genetic&nbsp;pass&nbsp;(26,&nbsp;365)&nbsp;tested&nbsp;with&nbsp;error&nbsp;&quot;incorrect&nbsp;input&nbsp;parameters&quot;&nbsp;in&nbsp;0:00:00.008</span>
<br><span class="f_CodeExample">...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In other words, every few test passes, something is wrong with the input parameters, and such a pass is not performed. The </span><span class="f_Text" style="font-style: italic;">OnInit</span><span class="f_Text"> handler contains the following check:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">FastOsMA</span><span class="f_CodeExample">&nbsp;&gt;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowOsMA</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INIT_PARAMETERS_INCORRECT</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">On our part, it is quite logical to impose such a restriction that the period of the slow MA should be greater than the period of the fast one. However, the tester does not know such things about our algorithm therefore tries to sort through a variety of combinations of periods, including incorrect ones. This might be a common situation for optimization which, however, has a negative consequence.</span></p>
<p class="p_Text"><span class="f_Text">Since we apply genetic optimization, there are several rejected samples in each generation that do not participate in further mutations. The MetaTrader 5 optimizer does not make up for these losses, i.e., it does not generate a replacement for them. Then, a smaller population size can negatively affect quality. Thus, it is necessary to come up with a way to ensure that the input settings are enumerated only in the correct combinations. And here two MQL5 API functions come to our aid: </span><span class="f_Text" style="font-style: italic;">ParameterGetRange</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">ParameterSetRange</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Both functions have two overloaded prototypes that differ in parameter types: </span><span class="f_Text" style="font-style: italic;">long</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text">. This is how the two variants of the </span><span class="f_Text" style="font-style: italic;">ParameterGetRange</span><span class="f_Text"> function are described.</span></p>
<p class="p_H4"><span class="f_H4">bool ParameterGetRange(const string name, bool &amp;enable, long &amp;value, long &amp;start, long &amp;step, long &amp;stop)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool ParameterGetRange(const string name, bool &amp;enable, double &amp;value, double &amp;start, double &amp;step, double &amp;stop)</span></p>
<p class="p_Text"><span class="f_Text">For the input variable specified by name, the function receives information about its current value (</span><span class="f_Text" style="font-style: italic;">value</span><span class="f_Text">), range of values (</span><span class="f_Text" style="font-style: italic;">start</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">stop</span><span class="f_Text">), and change step (</span><span class="f_Text" style="font-style: italic;">step</span><span class="f_Text">) during optimization. In addition, an attribute is written to the </span><span class="f_Text" style="font-style: italic;">enable</span><span class="f_Text"> variable of whether the optimization is enabled for the input variable named 'name'.</span></p>
<p class="p_Text"><span class="f_Text">The function returns an indication of success (</span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">) or error (</span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">The function can only be called from three special optimization-related handlers: </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">OnTesterPass</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">OnTesterDeinit</span><span class="f_Text">. We will talk about them in the <a href="6_5_9_tester_ontester_init_pass_deinit.htm" class="topiclink">next section</a>. As you can guess from the names, </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text"> is called before optimization starts, </span><span class="f_Text" style="font-style: italic;">OnTesterDeinit</span><span class="f_Text"> – after completion of optimization, and </span><span class="f_Text" style="font-style: italic;">OnTesterPass</span><span class="f_Text"> – after each pass in the optimization process. For now, we are only interested in </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text">. Just like the other two functions, it has no parameters and can be declared with the type </span><span class="f_Text" style="font-style: italic;">void</span><span class="f_Text">, i.e., it returns nothing.</span></p>
<p class="p_Text"><span class="f_Text">Two versions of the </span><span class="f_Text" style="font-style: italic;">ParameterSetRange</span><span class="f_Text"> function have similar prototypes and perform the opposite action: they set the optimization properties of the Expert Advisor's input parameter.</span></p>
<p class="p_H4"><span class="f_H4">bool ParameterSetRange(const string name, bool enable, long value, long start, long step, long stop)</span></p>
<p class="p_H4" style="margin: 0 23px 1px 17px;"><span class="f_H4">bool ParameterSetRange(const string name, bool enable, double value, double start, double step, double stop)</span></p>
<p class="p_Text"><span class="f_Text">The function sets the modification rules of the </span><span class="f_Text" style="font-style: italic;">input</span><span class="f_Text"> variable with the </span><span class="f_Text" style="font-style: italic;">name</span><span class="f_Text"> name when optimizing: value, change step, start and end values.</span></p>
<p class="p_Text"><span class="f_Text">This function can only be called from the </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text"> handler when starting optimization in the strategy tester.</span></p>
<p class="p_Text"><span class="f_Text">Thus, using the </span><span class="f_Text" style="font-style: italic;">ParameterGetRange</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">ParameterSetRange</span><span class="f_Text"> functions, you can analyze and set new range and step values, as well as completely exclude, or, vice versa, include certain parameters from optimization, despite the settings in the strategy tester. This allows you to create your own scripts to manage the space of input parameters during optimization.</span></p>
<p class="p_Text"><span class="f_Text">The function allows you to use in optimization even those variables that are declared with the </span><span class="f_Text" style="font-style: italic;">sinput</span><span class="f_Text"> modifier (they are not available for inclusion in the optimization by the user).</span></p>
<p class="p_Quote"><span class="f_Quote">Attention! After the call of </span><span class="f_Quote" style="font-style: italic;">ParameterSetRange</span><span class="f_Quote"> with a change in the settings of a specific input variable, subsequent calls of </span><span class="f_Quote" style="font-style: italic;">ParameterGetRange</span><span class="f_Quote"> will not &quot;see&quot; these changes and will still return to the original settings. This makes it impossible to use functions together in complex software products, where settings can be handled by different classes and <a href="7_7_libraries.htm" class="topiclink">libraries</a> from independent developers.</span></p>
<p class="p_Text"><span class="f_Text">Let's improve the </span><span class="f_Text" style="font-style: italic;">BandOsMA</span><span class="f_Text"> Expert Advisor using the new functions. The updated version is named </span><span class="f_Text" style="font-style: italic;">BandOsMApro.mq5</span><span class="f_Text"> (&quot;pro&quot; can be conditionally decoded as &quot;parameter range optimization&quot;).</span></p>
<p class="p_Text"><span class="f_Text">So, we have the </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text"> handler, in which we read the settings for the </span><span class="f_Text" style="font-style: italic;">FastOsMA</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">SlowOsMA</span><span class="f_Text"> parameters, and check if they are included in the optimization. If so, you need to turn them off and offer something in return.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnTesterInit</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">enabled1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">enabled2</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">value1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop1</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">value2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop2</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">ParameterGetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;FastOsMA&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">enabled1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">value1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ParameterGetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;SlowOsMA&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">enabled2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">value2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop2</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">enabled1</span><span class="f_CodeExample">&nbsp;&amp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">enabled2</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(!</span><span class="f_CodeExample" style="color: #0000ff;">ParameterSetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;FastOsMA&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">false</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">value1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;!</span><span class="f_CodeExample" style="color: #0000ff;">ParameterSetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;SlowOsMA&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">false</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">value2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop2</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Can't&nbsp;disable&nbsp;optimization&nbsp;by&nbsp;FastOsMA&nbsp;and&nbsp;SlowOsMA:&nbsp;&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">E2S</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">_LastError</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Can't&nbsp;adjust&nbsp;optimization&nbsp;by&nbsp;FastOsMA&nbsp;and&nbsp;SlowOsMA:&nbsp;&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">E2S</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">_LastError</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Unfortunately, due to the addition of </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text">, the compiler also requires you to add </span><span class="f_Text" style="font-style: italic;">OnTesterDeinit</span><span class="f_Text">, although we do not need this function. But we are forced to agree and add an empty handler.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnTesterDeinit</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The presence of the </span><span class="f_Text" style="font-style: italic;">OnTesterInit/OnTesterDeinit</span><span class="f_Text"> functions in the code will lead to the fact that when the optimization is started, an additional chart will open in the terminal with a copy of our Expert Advisor running on it. It works in a special mode that allows you to receive additional data (the so-called </span><span class="f_Text" style="font-style: italic;">frames</span><span class="f_Text">) from tested copies on agents, but we will explore this possibility later. For now, it is important for us to note that all operations with files, logs, charts, and objects work in this auxiliary copy of the Expert Advisor directly in the terminal, as usual (and not on the agent). In particular, all error messages and </span><span class="f_Text" style="font-style: italic;">Print</span><span class="f_Text"> calls will be displayed in the log on the </span><span class="f_Text" style="font-style: italic;">Experts</span><span class="f_Text"> tab of the terminal.</span></p>
<p class="p_Text"><span class="f_Text">We have information about the change ranges and steps of these parameters, we can literally recalculate all the correct combinations. This task is assigned to a separate </span><span class="f_Text" style="font-style: italic;">Iterate</span><span class="f_Text"> function because a similar operation will have to be reproduced by copies of the Expert Advisor on agents, in the </span><span class="f_Text" style="font-style: italic;">OnInit</span><span class="f_Text"> handler.</span></p>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">Iterate</span><span class="f_Text"> function, we have two nested loops over the periods of fast and slow MA in which we count the number of valid combinations, i.e. when the </span><span class="f_Text" style="font-style: italic;">i</span><span class="f_Text"> period is less than </span><span class="f_Text" style="font-style: italic;">j</span><span class="f_Text">. We need the optional </span><span class="f_Text" style="font-style: italic;">find</span><span class="f_Text"> parameter when calling </span><span class="f_Text" style="font-style: italic;">Iterate</span><span class="f_Text"> from </span><span class="f_Text" style="font-style: italic;">OnInit</span><span class="f_Text"> to return the pair by the sequence number of the combination </span><span class="f_Text" style="font-style: italic;">i</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">j</span><span class="f_Text">. Since it is required to return 2 numbers, we declared the </span><span class="f_Text" style="font-style: italic;">PairOfPeriods</span><span class="f_Text"> structure for them.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PairOfPeriods</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">slow</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #333333;">PairOfPeriods</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Iterate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step1</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step2</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">find</span><span class="f_CodeExample">&nbsp;=&nbsp;-</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">start1</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">stop1</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;+=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">step1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">start2</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">&nbsp;&lt;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">stop2</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">&nbsp;+=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">step2</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">find</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PairOfPeriods</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">&nbsp;=&nbsp;{</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">j</span><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PairOfPeriods</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">&nbsp;=&nbsp;{</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">When calling </span><span class="f_Text" style="font-style: italic;">Iterate</span><span class="f_Text"> from </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text">, we don't use the </span><span class="f_Text" style="font-style: italic;">find</span><span class="f_Text"> parameter and keep counting until the very end, and return the resulting amount in the first field of the structure. This will be the range of values of some new shadow parameter, for which we must enable optimization. Let's call it </span><span class="f_Text" style="font-style: italic;">FastSlowCombo4Optimization</span><span class="f_Text"> and add to the new group of auxiliary input parameters. More will be added here soon.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">group</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;A&nbsp;U&nbsp;X&nbsp;I&nbsp;L&nbsp;I&nbsp;A&nbsp;R&nbsp;Y&quot;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">sinput</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastSlowCombo4Optimization</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;(reserved&nbsp;for&nbsp;optimization)</span>
<br><span class="f_CodeExample">...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Let's go back to </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text"> and organize an MQL5 optimization by the </span><span class="f_Text" style="font-style: italic;">FastSlowCombo4Optimization</span><span class="f_Text"> parameter in the desired range using </span><span class="f_Text" style="font-style: italic;">ParameterSetRange</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnTesterInit</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PairOfPeriods</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Iterate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">start1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stop2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step2</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ParameterSetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;FastSlowCombo4Optimization&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Parameter&nbsp;FastSlowCombo4Optimization&nbsp;is&nbsp;enabled&nbsp;with&nbsp;maximum:&nbsp;%d&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Please note that the resulting number of iterations for the new parameter should be displayed in the terminal log.</span></p>
<p class="p_Text"><span class="f_Text">When testing on the agent, use the number in </span><span class="f_Text" style="font-style: italic;">FastSlowCombo4Optimization</span><span class="f_Text"> to get a couple of periods by calling </span><span class="f_Text" style="font-style: italic;">Iterate</span><span class="f_Text"> again, this time with the filled </span><span class="f_Text" style="font-style: italic;">find</span><span class="f_Text"> parameter. But the problem is that for this operation, it is required to know the initial ranges and the </span><span class="f_Text" style="font-style: italic;">FastOsMA</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">SlowOsMA</span><span class="f_Text"> parameter change step. This information is present only in the terminal. So, we need to somehow transfer it to the agent.</span></p>
<p class="p_Text"><span class="f_Text">Now we will apply the only solution we know so far: we will add 3 more shadow optimization parameters and set some values for them. In the future, we will get acquainted with the technology of transferring files to agents (see <a href="6_5_12_tester_directives.htm" class="topiclink">Preprocessor directives for the tester</a>). Then we will be able to write to the file the entire array of indexes calculated by the </span><span class="f_Text" style="font-style: italic;">Iterate</span><span class="f_Text"> function and send it to agents. This will avoid three extra shadow optimization parameters.</span></p>
<p class="p_Text"><span class="f_Text">So, let's add three input parameters:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">sinput</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastShadow4Optimization</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;(reserved&nbsp;for&nbsp;optimization)</span>
<br><span class="f_CodeExample" style="color: #0000ff;">sinput</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowShadow4Optimization</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;(reserved&nbsp;for&nbsp;optimization)</span>
<br><span class="f_CodeExample" style="color: #0000ff;">sinput</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">StepsShadow4Optimization</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;(reserved&nbsp;for&nbsp;optimization)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">We use the </span><span class="f_Text" style="font-style: italic;">ulong</span><span class="f_Text"> type to be more economical: to pack 2 </span><span class="f_Text" style="font-style: italic;">int</span><span class="f_Text"> numbers into each value. This is how they are filled in </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnTesterInit</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start1</span><span class="f_CodeExample">&nbsp;|&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">stop1</span><span class="f_CodeExample">&nbsp;&lt;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">16</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">slow</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">start2</span><span class="f_CodeExample">&nbsp;|&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">stop2</span><span class="f_CodeExample">&nbsp;&lt;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">16</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ulong</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step1</span><span class="f_CodeExample">&nbsp;|&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">step2</span><span class="f_CodeExample">&nbsp;&lt;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">16</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ParameterSetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;FastShadow4Optimization&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">false</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ParameterSetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;SlowShadow4Optimization&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">false</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">slow</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">slow</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">slow</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ParameterSetRange</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;StepsShadow4Optimization&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">false</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">step</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;...</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">All 3 parameters are non-optimizable (</span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text"> in the second argument).</span></p>
<p class="p_Text"><span class="f_Text">This concludes our operations with the </span><span class="f_Text" style="font-style: italic;">OnTesterInit</span><span class="f_Text"> function. Let's move to the receiving side: the </span><span class="f_Text" style="font-style: italic;">OnInit</span><span class="f_Text"> handler.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnInit</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;keep&nbsp;the&nbsp;check&nbsp;for&nbsp;single&nbsp;tests</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">FastOsMA</span><span class="f_CodeExample">&nbsp;&gt;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowOsMA</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INIT_PARAMETERS_INCORRECT</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;when&nbsp;optimizing,&nbsp;we&nbsp;require&nbsp;the&nbsp;presence&nbsp;of&nbsp;shadow&nbsp;parameters</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">MQLInfoInteger</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">MQL_OPTIMIZATION</span><span class="f_CodeExample">)&nbsp;&amp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">StepsShadow4Optimization</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INIT_PARAMETERS_INCORRECT</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PairOfPeriods</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">&nbsp;=&nbsp;{</span><span class="f_CodeExample" style="color: #333333;">FastOsMA</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowOsMA</span><span class="f_CodeExample">};&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;by&nbsp;default&nbsp;we&nbsp;work&nbsp;with&nbsp;normal&nbsp;parameters</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">FastShadow4Optimization</span><span class="f_CodeExample">&nbsp;&amp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowShadow4Optimization</span><span class="f_CodeExample">&nbsp;&amp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">StepsShadow4Optimization</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;if&nbsp;the&nbsp;shadow&nbsp;parameters&nbsp;are&nbsp;full,&nbsp;decode&nbsp;them&nbsp;into&nbsp;periods</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastStart</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)(</span><span class="f_CodeExample" style="color: #333333;">FastShadow4Optimization</span><span class="f_CodeExample">&nbsp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0xFFFF</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastStop</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)((</span><span class="f_CodeExample" style="color: #333333;">FastShadow4Optimization</span><span class="f_CodeExample">&nbsp;&gt;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">16</span><span class="f_CodeExample">)&nbsp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0xFFFF</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowStart</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)(</span><span class="f_CodeExample" style="color: #333333;">SlowShadow4Optimization</span><span class="f_CodeExample">&nbsp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0xFFFF</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowStop</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)((</span><span class="f_CodeExample" style="color: #333333;">SlowShadow4Optimization</span><span class="f_CodeExample">&nbsp;&gt;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">16</span><span class="f_CodeExample">)&nbsp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0xFFFF</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastStep</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)(</span><span class="f_CodeExample" style="color: #333333;">StepsShadow4Optimization</span><span class="f_CodeExample">&nbsp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0xFFFF</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowStep</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)((</span><span class="f_CodeExample" style="color: #333333;">StepsShadow4Optimization</span><span class="f_CodeExample">&nbsp;&gt;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">16</span><span class="f_CodeExample">)&nbsp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0xFFFF</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Iterate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">FastStart</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastStop</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastStep</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowStart</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowStop</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SlowStep</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">FastSlowCombo4Optimization</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;MA&nbsp;periods&nbsp;are&nbsp;restored&nbsp;from&nbsp;shadow:&nbsp;FastOsMA=%d&nbsp;SlowOsMA=%d&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">slow</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">strategy</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SimpleStrategy</span><span class="f_CodeExample">(</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BandOsMaSignal</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">fast</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">p</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">slow</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">SignalOsMA</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PriceOsMA</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BandsMA</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BandsShift</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">BandsDeviation</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">PeriodMA</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ShiftMA</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">MethodMA</span><span class="f_CodeExample">),</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Magic</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">StopLoss</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Lots</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INIT_SUCCEEDED</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Using the </span><span class="f_Text" style="font-style: italic;">MQLInfoInteger</span><span class="f_Text"> function, we can determine all Expert Advisor modes, including those related to the tester and optimization. Having specified one of the elements of the ENUM_MQL_INFO_INTEGER enumeration as a parameter, we will get a logical sign as a result (</span><span class="f_Text" style="font-style: italic;">true/false</span><span class="f_Text">):</span></p>
<ul>
<li class="p_li"><span class="f_li">MQL_TESTER – the program works in the tester</span></li>
<li class="p_li"><span class="f_li">MQL_VISUAL_MODE – the tester is running in the visual mode</span></li>
<li class="p_li"><span class="f_li">MQL_OPTIMIZATION – the test pass is performed during optimization (not separately)</span></li>
<li class="p_li"><span class="f_li">MQL_FORWARD – the test pass is performed on the forward period after optimization (if specified by optimization settings)</span></li>
<li class="p_li"><span class="f_li">MQL_FRAME_MODE – the Expert Advisor is running in a special service mode on the terminal chart (and not on the agent) to control optimization (more on this in the <a href="6_5_9_tester_ontester_init_pass_deinit.htm" class="topiclink">next section</a>)</span></li>
</ul>
<p class="p_ImageCaption"><img class="help" alt="Tester Modes of MQL Programs" title="Tester Modes of MQL Programs" width="600" height="400" style="margin:0 auto 0 auto;width:600px;height:400px;border:none" src="tester_modes.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">Tester modes of MQL programs</span></p>
<p class="p_Text"><span class="f_Text">Everything is ready to start optimization. As soon as it starts, with the mentioned settings </span><span class="f_Text" style="font-style: italic;">Presets/MQL5Book/BandOsMA.set</span><span class="f_Text">, we will see a message in the </span><span class="f_Text" style="font-style: italic;">Experts</span><span class="f_Text"> log in the terminal:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">Parameter&nbsp;FastSlowCombo4Optimization&nbsp;is&nbsp;enabled&nbsp;with&nbsp;maximum:&nbsp;698</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This time there should be no errors in the optimization log and all generations are generated without crashing.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">...</span>
<br><span class="f_CodeExample">Best&nbsp;result&nbsp;91.02452934181422&nbsp;produced&nbsp;at&nbsp;generation&nbsp;39.&nbsp;Next&nbsp;generation&nbsp;42</span>
<br><span class="f_CodeExample">Best&nbsp;result&nbsp;91.56338892567393&nbsp;produced&nbsp;at&nbsp;generation&nbsp;42.&nbsp;Next&nbsp;generation&nbsp;43</span>
<br><span class="f_CodeExample">Best&nbsp;result&nbsp;91.71026391877101&nbsp;produced&nbsp;at&nbsp;generation&nbsp;43.&nbsp;Next&nbsp;generation&nbsp;44</span>
<br><span class="f_CodeExample">Best&nbsp;result&nbsp;91.71026391877101&nbsp;produced&nbsp;at&nbsp;generation&nbsp;43.&nbsp;Next&nbsp;generation&nbsp;45</span>
<br><span class="f_CodeExample">Best&nbsp;result&nbsp;92.48460871443507&nbsp;produced&nbsp;at&nbsp;generation&nbsp;45.&nbsp;Next&nbsp;generation&nbsp;46</span>
<br><span class="f_CodeExample">...</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This can be determined even by the increased overall optimization time: earlier, some passes were rejected at an early stage, and now they are all processed in full.</span></p>
<p class="p_Text"><span class="f_Text">But our solution has one drawback. Now the working settings of the Expert Advisor include not just a couple of periods in the </span><span class="f_Text" style="font-style: italic;">FastOsMA</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">SlowOsMA</span><span class="f_Text"> parameters, but also the ordinal number of their combination among all possible (</span><span class="f_Text" style="font-style: italic;">FastSlowCombo4Optimization</span><span class="f_Text">). The only thing we can do is output the periods decoded in the </span><span class="f_Text" style="font-style: italic;">OnInit</span><span class="f_Text"> function, which was demonstrated above.</span></p>
<p class="p_Text"><span class="f_Text">Thus, having found good settings with the help of optimization, the user, as usual, will perform a single run to refine the behavior of the trading system. At the beginning of the test log, an inscription of the following form should appear:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">MA&nbsp;periods&nbsp;are&nbsp;restored&nbsp;from&nbsp;shadow:&nbsp;FastOsMA=27&nbsp;SlowOsMA=175</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Then you can enter the specified periods in the parameters of the same name, and reset all shadow parameters.</span></p>

</div>

</body>
</html>
