<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>4.5.9 Writing and reading variables of built-in types (text files)</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part4.htm"> Part 4. Common APIs </a> / <a class="h_m" href="4_5_files.htm"> 4.5 Working with files </a>/ 4.5.9 Writing and reading variables (text files)
          </td>
          <td width="70" align="right">
          <a href="4_5_8_files_bin_atomic.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="4_5_10_files_cursor.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">4.5.9 Writing and reading variables (text files)</span></p>
<p class="p_Text"><span class="f_Text">Text files have their own set of functions for atomic (element-by-element) saving and for reading data. It is slightly different from the binary files set in the previous section. It should also be noted that there are no analog functions for writing/reading a structure or an array of structures to a text file. If you try to use any of these functions with a text file, they will have no effect but will raise an internal error code of 5011 (FILE_NOTBIN).</span></p>
<p class="p_Text"><span class="f_Text">As we already know, text files in MQL5 have two forms: plain text and text in CSV format. The corresponding mode, FILE_TXT or FILE_CSV, is set when the file is opened and cannot be changed without closing and reacquiring the handle. The difference between them appears only when reading files. Both modes are recorded in the same way.</span></p>
<p class="p_Text"><span class="f_Text">In the TXT mode, each call to the read function (any of the functions we'll look at in this section) finds the next newline in the file (a '\n' character or a pair of '\r\n') and processes everything up to it. The point of processing is to convert the text from the file into a value of a specific type corresponding to the called function. In the simplest case, if the </span><span class="f_Text" style="font-style: italic;">FileReadString</span><span class="f_Text"> function is called, no processing is performed (the string is returned &quot;as is&quot;).</span></p>
<p class="p_Text"><span class="f_Text">In the CSV mode, each time the read function is called, the text in the file is logically split not only by newlines but also by an additional delimiter specified when opening the file. The rest of the processing of the fragment from the current position of the file to the nearest delimiter is similar.</span></p>
<p class="p_Text"><span class="f_Text">In other words, reading the text and transferring the internal position within the file is done in fragments from delimiter to delimiter, where delimiter means not only the </span><span class="f_Text" style="font-style: italic;">delimiter</span><span class="f_Text"> character in the </span><span class="f_Text" style="font-style: italic;">FileOpen </span><span class="f_Text">parameter list but also a newline ('\n', '\r\n'), as well as the beginning and end of the file.</span></p>
<p class="p_Text"><span class="f_Text">The additional delimiter has the same effect on writing text to FILE_TXT and FILE_CSV files, but only when using the </span><span class="f_Text" style="font-style: italic;">FileWrite</span><span class="f_Text"> function: it automatically inserts this character between the recorded elements. The </span><span class="f_Text" style="font-style: italic;">FileWriteString</span><span class="f_Text"> function separator is ignored.</span></p>
<p class="p_Text"><span class="f_Text">Let's view the formal descriptions of the functions, and then consider an example in </span><span class="f_Text" style="font-style: italic;">FileTxtCsv.mq5</span><span class="f_Text">.</span></p>
<p class="p_H4"><span class="f_H4">uint FileWrite(int handle, ...)</span></p>
<p class="p_Text"><span class="f_Text">The function belongs to the category of functions that take a variable number of parameters. Such parameters are indicated in the function prototype with an ellipsis. Only built-in data types are supported. To write structures or class objects, you must dereference their elements and pass them individually.</span></p>
<p class="p_Text"><span class="f_Text">The function writes all arguments passed after the first one to a text file with the </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> descriptor. Arguments are separated by commas, as in a normal argument list. The number of arguments output to the file cannot exceed 63.</span></p>
<p class="p_Text"><span class="f_Text">When output, numeric data is converted to text format according to the rules of the standard conversion to </span><span class="f_Text" style="font-style: italic;">(string)</span><span class="f_Text">. Values or type </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text"> output to 16 significant digits, either in traditional format or scientific exponent format (the more compact option is chosen). Data of the </span><span class="f_Text" style="font-style: italic;">float</span><span class="f_Text"> type is displayed with an accuracy of 7 significant digits. To display real numbers with a different precision or in an explicitly specified format, use the </span><span class="f_Text" style="font-style: italic;">DoubleToString</span><span class="f_Text"> function (see <a href="4_1_1_conversions_numbers.htm" class="topiclink">Numbers to strings and vice versa</a>).</span></p>
<p class="p_Text"><span class="f_Text">Values of the </span><span class="f_Text" style="font-style: italic;">datetime</span><span class="f_Text"> type are output in the format &quot;YYYY.MM.DD hh:mm:ss&quot; (see <a href="4_1_3_conversions_datetime.htm" class="topiclink">Date and time</a>).</span></p>
<p class="p_Text"><span class="f_Text">A standard color (from the list of web colors) is displayed as a name, a non-standard color is displayed as a triple of RGB component values (see <a href="4_1_4_conversions_color.htm" class="topiclink">Color</a>), separated by commas (note: comma is the most common separator character in CSV).</span></p>
<p class="p_Text"><span class="f_Text">For enumerations, an integer denoting the element is displayed instead of its identifier (name). For example, when writing FRIDAY (from ENUM_DAY_OF_WEEK, see <a href="2_2_8_enums.htm" class="topiclink">Enumerations</a>) we get number 5 in the file.</span></p>
<p class="p_Text"><span class="f_Text">Values of the </span><span class="f_Text" style="font-style: italic;">bool</span><span class="f_Text"> type are output as the strings &quot;true&quot; or &quot;false&quot;.</span></p>
<p class="p_Text"><span class="f_Text">If a delimiter character other than 0 was specified when opening the file, it will be inserted between two adjacent lines resulting from the conversion of the corresponding arguments.</span></p>
<p class="p_Text"><span class="f_Text">Once all arguments are written to the file, a line terminator '\r\n' is added.</span></p>
<p class="p_Text"><span class="f_Text">The function returns the number of bytes written, or 0 in case of an error.</span></p>
<p class="p_H4"><span class="f_H4">uint FileWriteString(int handle, const string text, int length = -1)</span></p>
<p class="p_Text"><span class="f_Text">The function writes the </span><span class="f_Text" style="font-style: italic;">text</span><span class="f_Text"> string parameter to a text file with the </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> descriptor. The </span><span class="f_Text" style="font-style: italic;">length</span><span class="f_Text"> parameter is only applicable for binary files and is ignored in this context (the line is written in full).</span></p>
<p class="p_Quote"><span class="f_Quote">The </span><span class="f_Quote" style="font-style: italic;">FileWriteString</span><span class="f_Quote"> function can also work with binary files. This application of the function is described in the previous section.</span></p>
<p class="p_Text"><span class="f_Text">Any separators (between elements in a line) and newlines must be inserted/added by the programmer.</span></p>
<p class="p_Text"><span class="f_Text">The function returns the number of bytes written (in FILE_UNICODE mode this will be 2 times the length of the string in characters) or 0 in case of an error.</span></p>
<p class="p_H4"><span class="f_H4">string FileReadString(int handle, int length = -1)</span></p>
<p class="p_Text"><span class="f_Text">The function reads a string up to the next delimiter from a file with the </span><span class="f_Text" style="font-style: italic;">handle</span><span class="f_Text"> descriptor (delimiter character in a CSV file, linefeed character in any file, or until the end of the file). The </span><span class="f_Text" style="font-style: italic;">length</span><span class="f_Text"> parameter only applies to binary files and is ignored in this context.</span></p>
<p class="p_Text"><span class="f_Text">The resulting string can be converted to a value of the required type using standard <a href="2_6_3_conversion_explicit.htm" class="topiclink">reduction rules</a> or using <a href="4_1_conversions.htm" class="topiclink">conversion functions</a>. Alternatively, specialized read functions can be used: </span><span class="f_Text" style="font-style: italic;">FileReadBool</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">FileReadDatetime</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">FileReadNumber</span><span class="f_Text"> are described below.</span></p>
<p class="p_Text"><span class="f_Text">In case of an error, an empty string will be returned. The error code can be found through the variable </span><span class="f_Text" style="font-style: italic;">_LastError</span><span class="f_Text"> or function </span><span class="f_Text" style="font-style: italic;"><a href="4_9_15_env_last_error.htm" class="topiclink">GetLastError</a></span><span class="f_Text">. In particular, when the end of the file is reached, the error code will be 5027 (FILE_ENDOFFILE).</span></p>
<p class="p_H4"><span class="f_H4">bool FileReadBool(int handle)</span></p>
<p class="p_Text"><span class="f_Text">The function reads a fragment of a CSV file up to the next delimiter, or until the end of the line and converts it to a value of type </span><span class="f_Text" style="font-style: italic;">bool</span><span class="f_Text">. If the fragment contains the text &quot;true&quot; (in any case, including mixed case, for example, &quot;True&quot;), or a non-zero number, we get </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">. In other cases, we get </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">The word &quot;true&quot; must occupy the entire read element. Even if the string starts with &quot;true&quot;, but has a continuation (for example, &quot;True Volume&quot;), we get </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">.</span></p>
<p class="p_H4"><span class="f_H4">datetime FileReadDatetime(int handle)</span></p>
<p class="p_Text"><span class="f_Text">The function reads from a CSV file a string of one of the following formats: &quot;YYYY.MM.DD hh:mm:ss&quot;, &quot;YYYY.MM.DD&quot; or &quot;hh:mm:ss&quot;, and converts it to a value of the </span><span class="f_Text" style="font-style: italic;">datetime </span><span class="f_Text">type. If the fragment does not contain a valid textual representation of the date and/or time, the function will return zero or &quot;weird&quot; time, depending on what characters it can interpret as date and time fragments. For empty or non-numeric strings, we get the current date with zero time.</span></p>
<p class="p_Text"><span class="f_Text">More flexible date and time reading (with more formats supported) can be achieved by combining two functions: </span><span class="f_Text" style="font-style: italic;">StringToTime(FileReadString(handle))</span><span class="f_Text">. For further details about </span><span class="f_Text" style="font-style: italic;">StringToTime</span><span class="f_Text"> see <a href="4_1_3_conversions_datetime.htm" class="topiclink">Date and time</a>.</span></p>
<p class="p_H4"><span class="f_H4">double FileReadNumber(int handle)</span></p>
<p class="p_Text"><span class="f_Text">The function reads a fragment from the CSV file up to the next delimiter or until the end of the line, and converts it to a value of type </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text"> according to standard <a href="4_1_1_conversions_numbers.htm" class="topiclink">type casting</a> rules.</span></p>
<p class="p_Text"><span class="f_Text">Please note that the </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text"> may lose the precision of very large values, which can affect the reading of large numbers of types </span><span class="f_Text" style="font-style: italic;">long/ulong</span><span class="f_Text"> (the value after which integers inside </span><span class="f_Text" style="font-style: italic;">double</span><span class="f_Text"> are distorted is 9007199254740992: an example of such a phenomenon is given in the section <a href="3_1_8_unions.htm" class="topiclink">Unions</a>).</span></p>
<p class="p_Quote"><span class="f_Quote">Functions discussed in the previous section, including </span><span class="f_Quote" style="font-style: italic;">FileReadDouble</span><span class="f_Quote">, </span><span class="f_Quote" style="font-style: italic;">FileReadFloat</span><span class="f_Quote">, </span><span class="f_Quote" style="font-style: italic;">FileReadInteger</span><span class="f_Quote">, </span><span class="f_Quote" style="font-style: italic;">FileReadLong</span><span class="f_Quote">, and </span><span class="f_Quote" style="font-style: italic;">FileReadStruct</span><span class="f_Quote">, cannot be applied to text files.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">FileTxtCsv.mq5 </span><span class="f_Text">script demonstrates how to work with text files. Last time we uploaded quotes to a binary file. Now let's do it in TXT and CSV formats.</span></p>
<p class="p_Text"><span class="f_Text">Basically, MetaTrader 5 allows you to export and import quotes in CSV format from the &quot;Symbols&quot; dialog. But for educational purposes, we will reproduce this process. In addition, the software implementation allows you to deviate from the exact format that is generated by default. A fragment of the XAUUSD H1 history exported in the standard way is shown below.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&lt;DATE&gt;&nbsp;&raquo;&nbsp;&lt;TIME&gt;&nbsp;&raquo;&nbsp;&lt;OPEN&gt;&nbsp;&raquo;&nbsp;&lt;HIGH&gt;&nbsp;&raquo;&nbsp;&lt;LOW&gt;&nbsp;&raquo;&nbsp;&lt;CLOSE&gt;&nbsp;&raquo;&nbsp;&lt;TICKVOL&gt;&nbsp;&raquo;&nbsp;&lt;VOL&gt;&nbsp;&raquo;&nbsp;&lt;SPREAD&gt;</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;01:00:00&nbsp;&raquo;&nbsp;1909.07&nbsp;&raquo;&nbsp;1914.93&nbsp;&raquo;&nbsp;1907.72&nbsp;&raquo;&nbsp;1913.10&nbsp;&raquo;&nbsp;4230&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;02:00:00&nbsp;&raquo;&nbsp;1913.04&nbsp;&raquo;&nbsp;1913.64&nbsp;&raquo;&nbsp;1909.90&nbsp;&raquo;&nbsp;1913.41&nbsp;&raquo;&nbsp;2694&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;03:00:00&nbsp;&raquo;&nbsp;1913.41&nbsp;&raquo;&nbsp;1918.71&nbsp;&raquo;&nbsp;1912.16&nbsp;&raquo;&nbsp;1916.61&nbsp;&raquo;&nbsp;6520&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;04:00:00&nbsp;&raquo;&nbsp;1916.60&nbsp;&raquo;&nbsp;1921.89&nbsp;&raquo;&nbsp;1915.49&nbsp;&raquo;&nbsp;1921.79&nbsp;&raquo;&nbsp;3944&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;05:00:00&nbsp;&raquo;&nbsp;1921.79&nbsp;&raquo;&nbsp;1925.26&nbsp;&raquo;&nbsp;1920.82&nbsp;&raquo;&nbsp;1923.19&nbsp;&raquo;&nbsp;3293&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;06:00:00&nbsp;&raquo;&nbsp;1923.20&nbsp;&raquo;&nbsp;1923.71&nbsp;&raquo;&nbsp;1920.24&nbsp;&raquo;&nbsp;1922.67&nbsp;&raquo;&nbsp;2146&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;07:00:00&nbsp;&raquo;&nbsp;1922.66&nbsp;&raquo;&nbsp;1922.99&nbsp;&raquo;&nbsp;1918.93&nbsp;&raquo;&nbsp;1921.66&nbsp;&raquo;&nbsp;3141&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;08:00:00&nbsp;&raquo;&nbsp;1921.66&nbsp;&raquo;&nbsp;1925.60&nbsp;&raquo;&nbsp;1921.47&nbsp;&raquo;&nbsp;1922.99&nbsp;&raquo;&nbsp;3752&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;09:00:00&nbsp;&raquo;&nbsp;1922.99&nbsp;&raquo;&nbsp;1925.54&nbsp;&raquo;&nbsp;1922.47&nbsp;&raquo;&nbsp;1924.80&nbsp;&raquo;&nbsp;2895&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span>
<br><span class="f_CodeExample">2021.01.04&nbsp;&raquo;&nbsp;10:00:00&nbsp;&raquo;&nbsp;1924.85&nbsp;&raquo;&nbsp;1935.16&nbsp;&raquo;&nbsp;1924.59&nbsp;&raquo;&nbsp;1932.07&nbsp;&raquo;&nbsp;6132&nbsp;&raquo;&nbsp;0&nbsp;&raquo;&nbsp;5</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Here, in particular, we may not be satisfied with the default separator character (tab, denoted as '&quot;'), the order of the columns, or the fact that the date and time are divided into two fields.</span></p>
<p class="p_Text"><span class="f_Text">In our script, we will choose comma as a separator, and we will generate the columns in the order of the fields of the </span><span class="f_Text" style="font-style: italic;">MqlRates </span><span class="f_Text">structure. Unloading and subsequent test reading will be performed in the FILE_TXT and FILE_CSV modes.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">txtfile</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/atomic.txt&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">csvfile</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MQL5Book/atomic.csv&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">short</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">delimiter</span><span class="f_CodeExample">&nbsp;=&nbsp;',';</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Quotes will be requested at the beginning of the function </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> in the standard way:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">MqlRates</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[];&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">CopyRates</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #800080;">_Symbol</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #800080;">_Period</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">10</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;10</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">We will specify the names of the columns in the array separately, and also combine them using the helper function </span><span class="f_Text" style="font-style: italic;">StringCombine</span><span class="f_Text">. Separate titles are required because we combine them into a common title using a selectable delimiter character (an alternative solution could be based on </span><span class="f_Text" style="font-style: italic;">StringReplace</span><span class="f_Text">). We encourage you to work with the source code </span><span class="f_Text" style="font-style: italic;">StringCombine</span><span class="f_Text"> independently: it does the opposite operation with respect to the built-in </span><span class="f_Text" style="font-style: italic;"><a href="4_2_5_strings_find_replace_split.htm" class="topiclink">StringSplit</a></span><span class="f_Text">.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">columns</span><span class="f_CodeExample">[]&nbsp;=&nbsp;{</span><span class="f_CodeExample" style="color: #008080;">&quot;DateTime&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Open&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;High&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Low&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Close&quot;</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Ticks&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Spread&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;True&quot;</span><span class="f_CodeExample">};</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">caption</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">StringCombine</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">columns</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">delimiter</span><span class="f_CodeExample">)&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\r\n&quot;</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The last column should have been called &quot;Volume&quot;, but we will use its example to check the performance of the function </span><span class="f_Text" style="font-style: italic;">FileReadBool</span><span class="f_Text">. You may assume that the current name implies &quot;True Volume&quot; (but such a string would not be interpreted as </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">).</span></p>
<p class="p_Text"><span class="f_Text">Next, let's open two files in the FILE_TXT and FILE_CSV modes, and write the prepared header into them.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fh1</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">txtfile</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_TXT</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_ANSI</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">delimiter</span><span class="f_CodeExample">));</span><span class="f_CodeExample" style="color: #808080;">//1</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">csvfile</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_CSV</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_ANSI</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_WRITE</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">delimiter</span><span class="f_CodeExample">));</span><span class="f_CodeExample" style="color: #808080;">//2</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">caption</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;48</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileWriteString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">caption</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;48</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Since the </span><span class="f_Text" style="font-style: italic;">FileWriteString</span><span class="f_Text"> function does not automatically add a newline, we have added &quot;\r\n&quot; to the </span><span class="f_Text" style="font-style: italic;">caption</span><span class="f_Text"> variable.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">n</span><span class="f_CodeExample">;&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileWrite</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">open</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">tick_volume</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">spread</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">real_volume</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileWrite</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">open</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">tick_volume</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">spread</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">real_volume</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh1</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Writing structure fields from the </span><span class="f_Text" style="font-style: italic;">rates</span><span class="f_Text"> array is done in the same way, by calling </span><span class="f_Text" style="font-style: italic;">FileWrite</span><span class="f_Text"> in a loop for each of the two files. Recall that the </span><span class="f_Text" style="font-style: italic;">FileWrite</span><span class="f_Text"> function automatically inserts a delimiter character between arguments and adds &quot;\r\n&quot; at the string ends. Of course, it was possible to independently convert all output values to strings and send them to a file using </span><span class="f_Text" style="font-style: italic;">FileWriteString</span><span class="f_Text">, but then we would have to take care of separators and newlines ourselves. In some cases, they are not needed, for example, if you are writing in JSON format in a compact form (essentially in one giant line).</span></p>
<p class="p_Text"><span class="f_Text">Thus, at the recording stage, both files were managed in the same way and turned out to be the same. Here is an example of their content for XAUUSD,H1 (your results may vary):</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">DateTime,Open,High,Low,Close,Ticks,Spread,True</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;12:00:00,1785.3,1789.76,1784.75,1789.06,4831,5,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;13:00:00,1789.06,1790.02,1787.61,1789.06,3393,5,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;14:00:00,1789.08,1789.95,1786.78,1786.89,3536,5,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;15:00:00,1786.78,1789.86,1783.73,1788.82,6840,5,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;16:00:00,1788.82,1792.44,1782.04,1784.02,9514,5,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;17:00:00,1784.04,1784.27,1777.14,1780.57,8526,5,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;18:00:00,1780.55,1784.02,1780.05,1783.07,5271,6,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;19:00:00,1783.06,1783.15,1780.73,1782.59,3571,7,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;20:00:00,1782.61,1782.96,1780.16,1780.78,3236,10,0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;21:00:00,1780.79,1780.9,1778.54,1778.65,1017,13,0</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Differences in working with these files will begin to appear at the reading stage.</span></p>
<p class="p_Text"><span class="f_Text">Let's open a text file for reading and &quot;scan&quot; it using the </span><span class="f_Text" style="font-style: italic;">FileReadString</span><span class="f_Text"> function in a loop, until it returns an empty string (i.e., until the end of the file).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">read</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fh1</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">txtfile</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_TXT</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_ANSI</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">delimiter</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;=====&nbsp;Reading&nbsp;TXT&quot;</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">do</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">read</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileReadString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh1</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">while</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">read</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The log will show something like this:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">=====&nbsp;Reading&nbsp;TXT</span>
<br><span class="f_CodeExample">FileReadString(fh1)=DateTime,Open,High,Low,Close,Ticks,Spread,True&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;12:00:00,1785.3,1789.76,1784.75,1789.06,4831,5,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;13:00:00,1789.06,1790.02,1787.61,1789.06,3393,5,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;14:00:00,1789.08,1789.95,1786.78,1786.89,3536,5,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;15:00:00,1786.78,1789.86,1783.73,1788.82,6840,5,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;16:00:00,1788.82,1792.44,1782.04,1784.02,9514,5,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;17:00:00,1784.04,1784.27,1777.14,1780.57,8526,5,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;18:00:00,1780.55,1784.02,1780.05,1783.07,5271,6,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;19:00:00,1783.06,1783.15,1780.73,1782.59,3571,7,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;20:00:00,1782.61,1782.96,1780.16,1780.78,3236,10,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=2021.08.19&nbsp;21:00:00,1780.79,1780.9,1778.54,1778.65,1017,13,0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh1)=&nbsp;/&nbsp;FILE_ENDOFFILE(5027)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Every call of </span><span class="f_Text" style="font-style: italic;">FileReadString</span><span class="f_Text"> reads the entire line (up to '\r\n') in the FILE_TXT mode. To separate it into elements, we should implement additional processing. Optionally, we can use the FILE_CSV mode.</span></p>
<p class="p_Text"><span class="f_Text">Let's do the same for the CSV file.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">csvfile</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_CSV</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_ANSI</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">delimiter</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;2</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;=====&nbsp;Reading&nbsp;CSV&quot;</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">do</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">read</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileReadString</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">while</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">StringLen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">read</span><span class="f_CodeExample">)&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This time there will be many more entries in the log:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">=====&nbsp;Reading&nbsp;CSV</span>
<br><span class="f_CodeExample">FileReadString(fh2)=DateTime&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=Open&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=High&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=Low&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=Close&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=Ticks&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=Spread&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=True&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=2021.08.19&nbsp;12:00:00&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1785.3&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1789.76&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1784.75&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1789.06&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=4831&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=5&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">...</span>
<br><span class="f_CodeExample">FileReadString(fh2)=2021.08.19&nbsp;21:00:00&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1780.79&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1780.9&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1778.54&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1778.65&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=1017&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=13&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=0&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadString(fh2)=&nbsp;/&nbsp;FILE_ENDOFFILE(5027)</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The point is that the </span><span class="f_Text" style="font-style: italic;">FileReadString</span><span class="f_Text"> function in the FILE_CSV mode takes into account the delimiter character and splits the strings into elements. Every </span><span class="f_Text" style="font-style: italic;">FileReadString</span><span class="f_Text"> call returns a single value (cell) from a CSV table. Obviously, the resulting strings need to be subsequently converted to the appropriate types.</span></p>
<p class="p_Text"><span class="f_Text">This problem can be solved in a generalized form using specialized functions </span><span class="f_Text" style="font-style: italic;">FileReadDatetime</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">FileReadNumber</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">FileReadBool</span><span class="f_Text">. However, in any case, the developer must keep track of the number of the current readable column and determine its practical meaning. An example of such an algorithm is given in the third step of the test. It uses the same CSV file (for simplicity, we close it at the end of each step and open it at the beginning of the next one).</span></p>
<p class="p_Text"><span class="f_Text">To simplify the assignment of the next field in the </span><span class="f_Text" style="font-style: italic;">MqlRates</span><span class="f_Text"> structure by the column number, we have created a child structure </span><span class="f_Text" style="font-style: italic;">MqlRates</span><span class="f_Text"> that contains one template method </span><span class="f_Text" style="font-style: italic;">set</span><span class="f_Text">:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">struct</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">MqlRatesM</span><span class="f_CodeExample">&nbsp;:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">public</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">MqlRates</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">template</span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #0000ff;">typename</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&gt;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">set</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">field</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">T</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">switch</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">field</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">open</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">2</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">3</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">4</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">5</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">tick_volume</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">6</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">spread</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">case</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">7</span><span class="f_CodeExample">:&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">real_volume</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #0000ff;">long</span><span class="f_CodeExample">)</span><span class="f_CodeExample" style="color: #333333;">v</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">break</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">};</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">In the </span><span class="f_Text" style="font-style: italic;">OnStart</span><span class="f_Text"> function, we have described an array of one such structure, where we will add the incoming values. The array was required to simplify logging with </span><span class="f_Text" style="font-style: italic;">ArrayPrint</span><span class="f_Text"> (there is no ready-made function in MQL5 for printing a structure by itself).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Print</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;=====&nbsp;Reading&nbsp;CSV&nbsp;(alternative)&quot;</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">MqlRatesM</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">r</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">column</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">maxColumn</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">columns</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">count</span><span class="f_Text"> variable that counts the records was required not only for statistics but also as a means to skip the first line, which contains headers and not data. The current column number is tracked in the </span><span class="f_Text" style="font-style: italic;">column</span><span class="f_Text"> variable. Its maximum value should not exceed the number of columns </span><span class="f_Text" style="font-style: italic;">maxColumn</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Now we only have to open the file and read elements from it in a loop using various functions until an error occurs, in particular, an expected error such as 5027 (FILE_ENDOFFILE), that is, the end of the file is reached.</span></p>
<p class="p_Text"><span class="f_Text">When the column number is 0, we apply the </span><span class="f_Text" style="font-style: italic;">FileReadDatetime</span><span class="f_Text"> function. For other columns use </span><span class="f_Text" style="font-style: italic;">FileReadNumber</span><span class="f_Text">. The exception is the case of the first line with headers: for this we call the </span><span class="f_Text" style="font-style: italic;">FileReadBool</span><span class="f_Text"> function to demonstrate how it would react to the &quot;True&quot; header that was deliberately added to the last column.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">csvfile</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_CSV</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_ANSI</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">FILE_READ</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">delimiter</span><span class="f_CodeExample">));&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;1</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">do</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">column</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;demo&nbsp;for&nbsp;FileReadBool&nbsp;on&nbsp;the&nbsp;1st&nbsp;record&nbsp;with&nbsp;headers</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">r</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">set</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">column</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">PRTF</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">FileReadBool</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">)));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">r</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">set</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">column</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileReadNumber</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">));</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">else&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;0th&nbsp;column&nbsp;is&nbsp;the&nbsp;date&nbsp;and&nbsp;time</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">&nbsp;&gt;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;the&nbsp;structure&nbsp;from&nbsp;the&nbsp;previous&nbsp;line&nbsp;is&nbsp;ready</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">r</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #800080;">_Digits</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">NULL</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">r</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">].</span><span class="f_CodeExample" style="color: #333333;">time</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">FileReadDatetime</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">fh2</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">column</span><span class="f_CodeExample">&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">column</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)&nbsp;%&nbsp;</span><span class="f_CodeExample" style="color: #333333;">maxColumn</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">while</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #800080;">_LastError</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;exit&nbsp;when&nbsp;end&nbsp;of&nbsp;file&nbsp;5027&nbsp;is&nbsp;reached&nbsp;(FILE_ENDOFFILE)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;printing&nbsp;the&nbsp;last&nbsp;structure</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">column</span><span class="f_CodeExample">&nbsp;==&nbsp;</span><span class="f_CodeExample" style="color: #333333;">maxColumn</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayPrint</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">r</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #800080;">_Digits</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">NULL</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">This is what is logged:</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">=====&nbsp;Reading&nbsp;CSV&nbsp;(alternative)</span>
<br><span class="f_CodeExample">FileOpen(csvfile,FILE_CSV|FILE_ANSI|FILE_READ,delimiter)=1&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadBool(fh2)=false&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadBool(fh2)=false&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadBool(fh2)=false&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadBool(fh2)=false&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadBool(fh2)=false&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadBool(fh2)=false&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">FileReadBool(fh2)=true&nbsp;/&nbsp;ok</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;00:00:00&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;&nbsp;0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;12:00:00&nbsp;1785.30&nbsp;1789.76&nbsp;1784.75&nbsp;1789.06&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4831&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;13:00:00&nbsp;1789.06&nbsp;1790.02&nbsp;1787.61&nbsp;1789.06&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3393&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;14:00:00&nbsp;1789.08&nbsp;1789.95&nbsp;1786.78&nbsp;1786.89&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3536&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;15:00:00&nbsp;1786.78&nbsp;1789.86&nbsp;1783.73&nbsp;1788.82&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6840&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;16:00:00&nbsp;1788.82&nbsp;1792.44&nbsp;1782.04&nbsp;1784.02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9514&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;17:00:00&nbsp;1784.04&nbsp;1784.27&nbsp;1777.14&nbsp;1780.57&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8526&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;18:00:00&nbsp;1780.55&nbsp;1784.02&nbsp;1780.05&nbsp;1783.07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5271&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;19:00:00&nbsp;1783.06&nbsp;1783.15&nbsp;1780.73&nbsp;1782.59&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3571&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;20:00:00&nbsp;1782.61&nbsp;1782.96&nbsp;1780.16&nbsp;1780.78&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3236&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span>
<br><span class="f_CodeExample">2021.08.19&nbsp;21:00:00&nbsp;1780.79&nbsp;1780.90&nbsp;1778.54&nbsp;1778.65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1017&nbsp;&nbsp;&nbsp;&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">As you see, of all the headers, only the last one is converted to the </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text"> value, and all the previous ones are </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">The content of the read structures is the same as the original data.</span></p>

</div>

</body>
</html>
