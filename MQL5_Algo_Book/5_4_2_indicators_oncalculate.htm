<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>5.4.2 Main indicator event: OnCalculate</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Programming for Traders </a> / <a class="h_m" href="part5.htm"> Part 5. Creating application programs </a> / <a class="h_m" href="5_4_indicators_make.htm"> 5.4 Creating custom indicators </a>/ 5.4.2 Main indicator event: OnCalculate
          </td>
          <td width="70" align="right">
          <a href="5_4_1_indicators_features.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="5_4_3_indicators_window_chart_separate.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H3"><span class="f_H3">5.4.2 Main indicator event: OnCalculate</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> function is the main entry point to the MQL5 indicator code. It is called whenever the OnCalculate event occurs, which is generated when price data changes. For example, it can happen when a new tick for a symbol arrives or when old prices change (filling a gap in the history or downloading missing data from the server).</span></p>
<p class="p_Text"><span class="f_Text">There are two variants of the function, which differ in the source material for calculations:</span></p>
<ul style="list-style-type:disc">
<li class="p_li"><span class="f_li">Full – provides a set of standard price timeseries in the parameters (OHLC prices, volumes, spreads)</span></li>
<li class="p_li"><span class="f_li">Reduced – for one arbitrary timeseries (not necessarily standard)</span></li>
</ul>
<p class="p_Text"><span class="f_Text">An indicator should use only one of the two options, while it is impossible to combine them in one indicator.</span></p>
<p class="p_Text"><span class="f_Text">In the case of using the reduced form of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">, when placing an indicator on a chart, an additional tab becomes available in its properties dialog. It provides a drop-down list </span><span class="f_Text" style="font-style: italic;">Apply to</span><span class="f_Text">, in which you should select the initial timeseries on the basis of which the indicator will be calculated. By default, if no timeseries is selected, the calculation is based on </span><span class="f_Text" style="font-style: italic;">Close</span><span class="f_Text"> price values.</span></p>
<p class="p_Text" style="text-align: center;"><img class="help" alt="Selecting the initial timeseries for the indicator with the short form OnCalculate" title="Selecting the initial timeseries for the indicator with the short form OnCalculate" width="615" height="312" style="margin:0 auto 0 auto;width:615px;height:312px;border:none" src="ind_apply_ru.png"/></p>
<p class="p_ImageCaption"><span class="f_ImageCaption">Selecting the initial timeseries for the indicator with the short form OnCalculate</span></p>
<p class="p_Text"><span class="f_Text">The list always offers standard types of prices, but if there are other indicators on the chart, this setting allows you to select one of them as the data source for another indicator, thereby building a processing chain from indicators. We will try to build one indicator from another in the section <a href="5_4_14_indicators_begin.htm" class="topiclink">Skip drawing on initial bars</a>. When using the full form, this option is not available.</span></p>
<p class="p_Quote"><span class="f_Quote">It is forbidden to apply indicators to the following built-in indicators: Fractals, Gator, Ichimoku, and Parabolic SAR.</span></p>
<p class="p_Text"><span class="f_Text">The short form of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> has the following prototype.</span></p>
<p class="p_H4"><span class="f_H4">int OnCalculate(const int rates_total, const int prev_calculated, const int begin,</span><br>
<span class="f_H4"> &nbsp; const double &amp;data[])</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">data</span><span class="f_Text"> array contains the initial data for the calculation. This can be one of the price timeseries or a calculated buffer of another indicator. The </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> parameter specifies the size of the </span><span class="f_Text" style="font-style: italic;">data</span><span class="f_Text"> array. </span><span class="f_Text" style="font-style: italic;">ArraySize(data)</span><span class="f_Text"> or </span><span class="f_Text" style="font-style: italic;">iBars(NULL, 0)</span><span class="f_Text"> calls should give the same value as </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> parameter is designed to effectively recalculate the indicator on a small number of new bars (usually on one, the last one), instead of a full calculation on all bars. The </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> value is equal to the result of the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> function returned to the runtime from a previous function call. For example, if upon receipt of the next tick, the indicator has calculated the formula for all bars, it should return the value of </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text" style="font-size: 7pt; vertical-align: sub;"> A </span><span class="f_Text"> from </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> (here the index A means the initial moment). Then, on the next tick, upon receiving the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> event, the terminal will set </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> to the previous value </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text" style="font-size: 7pt; vertical-align: sub;">A</span><span class="f_Text">. However, the number of bars during this time may already have changed, and the new value </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> will increase; let's call it </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text" style="font-size: 7pt; vertical-align: sub;">B</span><span class="f_Text">. Thus, only bars from </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> (aka </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text" style="font-size: 7pt; vertical-align: sub;">A</span><span class="f_Text">) till </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text" style="font-size: 7pt; vertical-align: sub;">B</span><span class="f_Text"> will be calculated.</span></p>
<p class="p_Text"><span class="f_Text">However, the most common situation is when new ticks fit into the current zero bar, that is, </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> does not change, and therefore in most </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> calls, we have the equality </span><span class="f_Text" style="font-style: italic;">prev_calculated == rates_total</span><span class="f_Text">. Do we need to recalculate something in this case? It depends on the nature of the calculations. For example, if the indicator is calculated based on the bar opening prices, which do not change, then there is no point in recalculating anything. However, if the indicator uses the closing price (in fact, the price of the last known tick) or any other summary price that depends on </span><span class="f_Text" style="font-style: italic;">Close</span><span class="f_Text">, then the last bar should always be recalculated.</span></p>
<p class="p_Text"><span class="f_Text">The first time the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> function is called, the value of </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> equals 0.</span></p>
<p class="p_Text"><span class="f_Text">If since the last call of the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> function, the price data has changed (for example, a deeper history has been uploaded or gaps have been filled in), then the value of the </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> parameter will also be set to 0 by the terminal. Thus, the indicator will be given a signal for a complete recalculation over the entire available history.</span></p>
<p class="p_Text"><span class="f_Text">If the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> function returns a null value, the indicator is not drawn, and the names and values of its buffers in the </span><span class="f_Text" style="font-style: italic;">Data window</span><span class="f_Text"> will be hidden.</span></p>
<p class="p_Quote"><span class="f_Quote">Please note that the return of the full number of bars </span><span class="f_Quote" style="font-style: italic;">rates_total</span><span class="f_Quote"> is the only standard way to tell the terminal and other MQL programs which will use the indicator that its data is ready. Even if an indicator is designed to calculate and show only a limited amount of data, it should return </span><span class="f_Quote" style="font-style: italic;">rates_total</span><span class="f_Quote">.</span></p>
<p class="p_Text"><span class="f_Text">The indexing direction of the </span><span class="f_Text" style="font-style: italic;">data</span><span class="f_Text"> array can be selected by calling </span><span class="f_Text" style="font-style: italic;"><a href="4_3_8_arrays_as_series.htm" class="topiclink">ArraySetAsSeries</a></span><span class="f_Text"> (the default is </span><span class="f_Text" style="font-style: italic;">false</span><span class="f_Text">, which can be verified by calling </span><span class="f_Text" style="font-style: italic;">ArrayGetAsSeries</span><span class="f_Text">). At the same time, if we apply the </span><span class="f_Text" style="font-style: italic;"><a href="4_3_8_arrays_as_series.htm" class="topiclink">ArrayIsSeries</a> </span><span class="f_Text">function to the array, it will return </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">. This means that this array is an internal array, managed by the terminal. The indicator cannot change it in any way, but only read it, especially since there is a </span><span class="f_Text" style="font-style: italic;">const</span><span class="f_Text"> modifier in the parameter description.</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">begin</span><span class="f_Text"> parameter reports the number of initial values of the </span><span class="f_Text" style="font-style: italic;">data</span><span class="f_Text"> array which should be excluded from the calculation. The parameter is set by the system when our indicator is configured by the user in such a way that it receives </span><span class="f_Text" style="font-style: italic;">data</span><span class="f_Text"> from another indicator (see image above). For example, if the selected data source indicator calculates a moving average period </span><span class="f_Text" style="font-style: italic;">N</span><span class="f_Text">, then the first </span><span class="f_Text" style="font-style: italic;">N - 1</span><span class="f_Text"> bars, by definition, do not contain source data, since there it is impossible to average over </span><span class="f_Text" style="font-style: italic;">N</span><span class="f_Text"> bars. If the developer has set a special property in this source indicator, it will be correctly passed to us in the </span><span class="f_Text" style="font-style: italic;">begin</span><span class="f_Text"> parameter. We will soon check this aspect in practice (see section <a href="5_4_14_indicators_begin.htm" class="topiclink">Skip drawing on initial bars</a>).</span></p>
<p class="p_Text"><span class="f_Text">Let's try to create an empty indicator with a shortened form of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">. It will not be able to do anything yet but will serve as a preparation for further experiments. The original file </span><span class="f_Text" style="font-style: italic;">IndStub.mq5</span><span class="f_Text"> can be found in the folder </span><span class="f_Text" style="font-style: italic;">MQL5/Indicators/MQL5Book/p5/</span><span class="f_Text">. To make sure the indicator works, let's add the following to </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">: the possibility to output </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> values to the log and to count the number of function calls.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnCalculate</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">prev_calculated</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">begin</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">const</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">data</span><span class="f_CodeExample">[])</span>
<br><span class="f_CodeExample">{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">static</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;++</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;compare&nbsp;the&nbsp;number&nbsp;of&nbsp;bars&nbsp;on&nbsp;the&nbsp;previous&nbsp;call&nbsp;and&nbsp;the&nbsp;current&nbsp;one</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">prev_calculated</span><span class="f_CodeExample">&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;signal&nbsp;only&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;difference</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;calculated=%d&nbsp;rates=%d;&nbsp;%d&nbsp;ticks&quot;</span><span class="f_CodeExample">,&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">prev_calculated</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">count</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rates_total</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;return&nbsp;the&nbsp;number&nbsp;of&nbsp;processed&nbsp;bars</span>
<br><span class="f_CodeExample">}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Condition for the inequality of </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> ensures that the message will only appear the first time the indicator is placed on the chart, and also as new bars appear. All ticks coming during the formation of the current bar will not change the number of bars, and therefore </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> will be equal. However, we will count the total number of ticks in the count variable.</span></p>
<p class="p_Text"><span class="f_Text">The remaining parameters are still out of work, but we will gradually use all the possibilities.</span></p>
<p class="p_Text"><span class="f_Text">This source code compiles successfully, but generates two warnings.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">no&nbsp;indicator&nbsp;window&nbsp;property&nbsp;is&nbsp;defined,&nbsp;indicator_chart_window&nbsp;is&nbsp;applied</span>
<br><span class="f_CodeExample">no&nbsp;indicator&nbsp;plot&nbsp;defined&nbsp;for&nbsp;indicator</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">They indicate the absence of some </span><span class="f_Text" style="font-style: italic;">#property</span><span class="f_Text"> directives, which, although not mandatory, set the basic properties of the indicator. In particular, the first warning says that no binding method has been selected for the indicator: the main window or subwindow, and therefore the main chart window will be used by default. The second warning is related to the fact that we have not set the number of charts to display. As already mentioned, some indicators are purposely designed without buffers because they are designed to perform other actions but in our case this is a reminder to add a visual part later.</span></p>
<p class="p_Text"><span class="f_Text">We will deal with the elimination of warnings in a couple of paragraphs, but for now, we will launch the indicator on the EURUSD,M1 chart. We use the M1 timeframe because this way we can quickly see the formation of new bars and the appearance of messages in the log.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">calculated=0&nbsp;rates=10002;&nbsp;1&nbsp;ticks</span>
<br><span class="f_CodeExample">calculated=10002&nbsp;rates=10003;&nbsp;30&nbsp;ticks</span>
<br><span class="f_CodeExample">calculated=10003&nbsp;rates=10004;&nbsp;90&nbsp;ticks</span>
<br><span class="f_CodeExample">calculated=10004&nbsp;rates=10005;&nbsp;167&nbsp;ticks</span>
<br><span class="f_CodeExample">calculated=10005&nbsp;rates=10006;&nbsp;240&nbsp;ticks</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">Thus, we see that the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> handler is called as expected, and you can perform calculations in it, both on each tick and on bars. The indicator can be removed from the chart by calling the </span><span class="f_Text" style="font-style: italic;">Indicator List</span><span class="f_Text"> dialog from the chart context menu: select the desired indicator and press </span><span class="f_Text" style="font-style: italic;">Delete</span><span class="f_Text">.</span></p>
<p class="p_Text"><span class="f_Text">Now let's get back to another prototype of the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> function. We have seen tried a reduced version in practice, but we could implement exactly the same blank for the full form.</span></p>
<p class="p_Text"><span class="f_Text">The full form is designed for calculation based on standard price timeseries and has the following prototype.</span></p>
<p class="p_H4"><span class="f_H4">int OnCalculate(const int rates_total, const int prev_calculated, const datetime &amp;time[],</span><br>
<span class="f_H4"> &nbsp; const double &amp;open[], const double &amp;high[], const double &amp;low[], const double &amp;close[],</span><br>
<span class="f_H4"> &nbsp; const long &amp;tick_volume[], const long &amp;volume[], const int &amp;spread[])</span></p>
<p class="p_Text"><span class="f_Text">The </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> parameters have the same meaning as in the simple form of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">: </span><span class="f_Text" style="font-style: italic;">rates_total</span><span class="f_Text"> sets the size of the transmitted timeseries (all arrays have the same length since this is the total number of bars on the chart), and </span><span class="f_Text" style="font-style: italic;">prev_calculated</span><span class="f_Text"> contains the number of bars processed on the previous call (that is, the value that the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> function returned earlier to the terminal using the return statement).</span></p>
<p class="p_Text"><span class="f_Text">Arrays </span><span class="f_Text" style="font-style: italic;">open</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">high</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic;">low</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic;">close</span><span class="f_Text"> contain the relevant prices for the current chart bars: the timeseries of the working symbol and timeframe. The </span><span class="f_Text" style="font-style: italic;">time</span><span class="f_Text"> array contains the open time for each bar, and </span><span class="f_Text" style="font-style: italic;">tick_volume</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">volume</span><span class="f_Text"> contain trading volumes (tick and exchange) per bar.</span></p>
<p class="p_Text"><span class="f_Text">In the previous chapter, we studied <a href="5_3_timeseries.htm" class="topiclink">Timeseries</a> with standard price and volume types provided by the terminal for MQL programs through a set of functions. So, for the convenience of calculating the indicator, these timeseries are passed to the </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text"> handler directly by reference as arrays. This eliminates the need to call these functions and copy (duplicate) quotes to internal arrays. Of course, this technique is suitable only for those indicators that are calculated on one combination of a working symbol and a timeframe that matches the current chart. However, MQL5 allows you to create multi-currency, multi-timeframe indicators, as well as indicators for symbols and timeframes other than those of the current chart. In all such cases, it is already impossible to do without the functions of access to timeseries. A little later we will see how this is done.</span></p>
<p class="p_Text"><span class="f_Text">If we check for all passed arrays if they belong to the terminal using </span><span class="f_Text" style="font-style: italic;"><a href="4_3_8_arrays_as_series.htm" class="topiclink">ArrayIsSeries</a></span><span class="f_Text">, this function will return </span><span class="f_Text" style="font-style: italic;">true</span><span class="f_Text">. All arrays are read-only. The </span><span class="f_Text" style="font-style: italic;">const</span><span class="f_Text"> modifier in the parameter description also underlines it.</span></p>
<p class="p_Text"><span class="f_Text">Choose between the full and reduced forms based on which data the computational algorithm needs. For example, to smooth an array using the moving average algorithm, only one input array is required, and therefore the indicator can be built for any price type the user chooses. However, well-known indicators </span><span class="f_Text" style="font-style: italic;">ParabolicSAR</span><span class="f_Text"> or </span><span class="f_Text" style="font-style: italic;">ZigZag</span><span class="f_Text"> demand </span><span class="f_Text" style="font-style: italic;">High</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">Low</span><span class="f_Text"> prices and therefore must use the full version of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">. In the following sections, we will see examples of indicators for both, the simple version of </span><span class="f_Text" style="font-style: italic;">OnCalculate</span><span class="f_Text">, and the complete version.</span></p>

</div>

</body>
</html>
