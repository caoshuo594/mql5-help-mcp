<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>3.3 Choosing the input data</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          Neural Networks for Algorithmic Trading with MQL5 </a> / <a class="h_m" href="3_realization.htm"> 3. Building the first neural network model in MQL5 </a>/ 3.3 Choosing the input data
          </td>
          <td width="70" align="right">
          <a href="3_2_files_struct.htm"><img style="vertical-align:middle;" src="previous.png" alt="?????" width="27" height="27" border=0></a>&nbsp;
          <a href="3_4_basic.htm"><img style="vertical-align:middle;" src="next.png" alt="??????" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H2"><span class="f_H2">3.3 Choosing the input data</span></p>
<p class="p_Text"><span class="f_Text">Having defined the problem statement, let's now turn our attention to the selection of input data. There are specific approaches to this task. At first glance, it might seem like you could load all available information into the neural network and let it learn the correct dependencies during training. This approach will prolong learning indefinitely, without guaranteeing the desired outcome.</span></p>
<p class="p_Text"><span class="f_Text">The first challenge we face is the volume of information. To convey a large amount of information to the neural network, we would need a considerably large input layer of neurons with a substantial number of connections. Hence, more training time will be required.</span></p>
<p class="p_Text"><span class="f_Text">Furthermore, we will encounter the issue of data incomparability. Samples of different metrics will have very different statistical characteristics. For example, the price of an instrument will always be positive, while its change can be both positive and negative.</span></p>
<p class="p_Text"><span class="f_Text">Some indicators have normalized values and others do not. The magnitudes of values for various indicators and the amplitude of their changes can differ by orders of magnitude. However, their impact on the outcome may be comparable, or an indicator with lower values may have an even greater impact.</span></p>
<p class="p_Text"><span class="f_Text">Such a situation will significantly complicate the training process, as it will be challenging to discern the impact of small values within an array of large values.</span></p>
<p class="p_Text"><span class="f_Text">Another problem lies in the use of highly correlated features. The presence of a correlation between features can indicate either a cause-and-effect relationship between them or that both variables are dependent on a common underlying factor. Consequently, the use of correlated variables combines the two mentioned problems and their consequences. Using multiple variables depending on one factor exaggerates its impact on the overall outcome. Unnecessary neural connections complicate the model and delay learning.</span></p>
<p class="p_H3"><span class="f_H3">Selecting features</span></p>
<p class="p_Text"><span class="f_Text">Let's undertake preparatory work, taking into account the considerations mentioned above. Of course, we won't manually select and compare data, as we live in the era of computer technology. To calculate the correlation coefficient, let's create a small script in the file </span><span class="f_Text" style="font-style: italic;">initial_data.mq5</span><span class="f_Text">.</span></p>
<p class="p_Text"><a name="full_path" class="hmanchor"></a><span class="f_Text">As a reminder, according to the previously described <a href="3_2_files_struct.htm" class="topiclink">directory structure</a>, all scripts are saved in the folder </span><span class="f_Text" style="font-style: italic;">terminal_dir\MQL5\Scripts</span><span class="f_Text">. For the scripts in our book, we will create the </span><span class="f_Text" style="font-style: italic;">NeuroNetworksBook</span><span class="f_Text"> subdirectory, and for all the scripts in this chapter, we will create the </span><span class="f_Text" style="font-style: italic;">initial_data</span><span class="f_Text"> subdirectory. So the full path of the file to be created will be:</span></p>
<ul style="list-style-type:disc">
<li class="p_li"><span class="f_li" style="font-style: italic;">terminal_dir\MQL5\Scripts\NeuroNetworksBook\initial_data\initial_data.mq5</span></li>
</ul>
<p class="p_Text"><span class="f_Text">We will directly calculate the correlation coefficient using the Mathematical Statistics Library from the MetaTrader 5 platform. In the script header, include the necessary library, and in the external parameters, specify the period for analysis.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">#include</span><span class="f_CodeExample">&nbsp;&lt;</span><span class="f_CodeExample" style="color: #333333;">Math</span><span class="f_CodeExample">\</span><span class="f_CodeExample" style="color: #333333;">Stat</span><span class="f_CodeExample">\</span><span class="f_CodeExample" style="color: #333333;">Math</span><span class="f_CodeExample">.</span><span class="f_CodeExample" style="color: #333333;">mqh</span><span class="f_CodeExample">&gt;</span><br>
<span class="f_CodeExample" style="color: #808080;">//+------------------------------------------------------------------+</span><br>
<span class="f_CodeExample" style="color: #808080;">//|&nbsp;Script&nbsp;Parameters&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="f_CodeExample" style="color: #808080;">//+------------------------------------------------------------------+</span><br>
<span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Start&nbsp;</span><span class="f_CodeExample">=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">D</span><span class="f_CodeExample" style="color: #008080;">'2015.01.01&nbsp;00:00:00'</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;Period&nbsp;Start</span><br>
<span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">End&nbsp;&nbsp;</span><span class="f_CodeExample">=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">D</span><span class="f_CodeExample" style="color: #008080;">'2020.12.31&nbsp;23:59:00'</span><span class="f_CodeExample">;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;Period&nbsp;End</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">When you run a script, MetaTrader 5 generates a </span><span class="f_Text" style="font-style: italic; font-weight: bold;">Start</span><span class="f_Text"> event that is handled by the </span><span class="f_Text" style="font-style: italic; font-weight: bold;">OnStart</span><span class="f_Text"> function in the script body. At the beginning of this function, we get multiple indicator handles for further analysis.</span></p>
<p class="p_Text"><span class="f_Text">Note that first on my list of indicators is ZigZag, which we will use to get reference values when training the neural network. Here, we will use it to check the correlation of indicator readings with reference values.</span></p>
<p class="p_Text"><span class="f_Text">Indicator settings are defined by the user at the problem statement stage. The neural network will be trained on the M5 timeframe data, so I set the </span><span class="f_Text" style="font-style: italic;">Depth</span><span class="f_Text"> parameter to 48, which corresponds to four hours. In this way, I expect that the indicator will reflect 4-hour extremes.</span></p>
<p class="p_Text"><span class="f_Text">The selection of the indicators list and parameters is up to the neural network architect. Parameter tuning is also possible when assessing correlation, which we will explore a bit later. At this stage, let us specify the indicators and their parameters from our subjective considerations.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnStart</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;{</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_ZZ</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iCustom</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,&quot;</span><span class="f_CodeExample" style="color: #008080;">Examples\\ZigZag.ex5</span><span class="f_CodeExample">&quot;,</span><span class="f_CodeExample" style="color: #008000;">48</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">1</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">47</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_CCI</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iCCI</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PRICE_TYPICAL</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_RSI</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iRSI</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PRICE_TYPICAL</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_Stoh</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iStochastic</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">8</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">3</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">MODE_LWMA</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">STO_LOWHIGH</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_MACD</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iMACD</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">48</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PRICE_TYPICAL</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_ATR</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iATR</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_BB</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iBands</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">48</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">3</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PRICE_TYPICAL</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_SAR</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iSAR</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0.02</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0.2</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">h_MFI</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">iMFI</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">VOLUME_TICK</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The next step is to load historical quotes and indicator data. To obtain historical data, we will create a series of arrays with names corresponding to the names of indicators and quotes. This will help us avoid confusion while working with them.</span></p>
<p class="p_Text"><span class="f_Text">Price data in MQL5 can be obtained by </span><span class="f_Text" style="font-style: italic; font-weight: bold;">CopyOpen, CopyHigh, CopyLow</span><span class="f_Text">, and </span><span class="f_Text" style="font-style: italic; font-weight: bold;">CopyClose</span><span class="f_Text"> functions. The functions are created according to the same template, and it is clear from the function name which quotes it returns. The </span><span class="f_Text" style="font-style: italic; font-weight: bold;">CopyBuffer</span><span class="f_Text"> function is responsible for receiving data from indicator buffers. The function call is similar to the function for obtaining quotes, with the only difference being that the instrument's name and timeframe are replaced with the indicator handle and the buffer number. I'll remind you that we obtained the indicator handles a little earlier.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">open</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">[];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #8000ff;">CopyClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">open</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyHigh</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">high</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyLow</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff00ff;">_Symbol</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">low</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;&nbsp;</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">All functions write data to the specified array and return the number of copied values. So, when making the call, we check for the presence of loaded data, and if there is no data, we exit the script. In this case, we'll give the terminal some time to load quotes from the server and recalculate indicator values. After that, we will rerun the script.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">zz</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">cci</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_main</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_signal</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #333333;">rsi</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #333333;">atr</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_medium</span><span class="f_CodeExample">[];</span><br>
<span class="f_CodeExample" style="color: #333333;">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_up</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_low</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">sar</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #333333;">stoch</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #333333;">ssig</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #333333;">mfi</span><span class="f_CodeExample">[];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">datetime</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">end_zz</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">+</span><span class="f_CodeExample" style="color: #8000ff;">PeriodSeconds</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">PERIOD_M5</span><span class="f_CodeExample">)*(</span><span class="f_CodeExample" style="color: #008000;">12</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #008000;">24</span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #008000;">5</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_ZZ</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">end_zz</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">zz</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_CCI</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">cci</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_RSI</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">rsi</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_MACD</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">MAIN_LINE</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">macd_main</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_MACD</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">SIGNAL_LINE</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">macd_signal</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_ATR</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">atr</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_BB</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">BASE_LINE</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">bands_medium</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_BB</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">UPPER_BAND</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">bands_up</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_BB</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">LOWER_BAND</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">bands_low</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_SAR</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">sar</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_Stoh</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">MAIN_LINE</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">stoch</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_Stoh</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ff0000;">SIGNAL_LINE</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">ssig</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">CopyBuffer</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">h_MFI</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">Start</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">End</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">mfi</span><span class="f_CodeExample">)&lt;=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">As mentioned above, not all variables are comparable. Although linear transformations will not significantly affect the correlation coefficient, we still need to preprocess some values.</span></p>
<p class="p_Text"><span class="f_Text">First, this applies to parameters that directly point to the instrument price. Since our goal is to create a tool capable of projecting accumulated knowledge onto future market situations, where there will be similar price movements but at a new price level, we need to move away from absolute price values and move toward a relative range.</span></p>
<p class="p_Text"><span class="f_Text">So, instead of using the candlestick opening and closing prices, we can take their difference (the size of the candlestick body) as an indicator of price movement intensity. We will also replace the </span><span class="f_Text" style="font-style: italic;">High</span><span class="f_Text"> and </span><span class="f_Text" style="font-style: italic;">Low</span><span class="f_Text"> candlestick extremes with their deviation from the opening or closing price. We will treat SAR and Bollinger Bands indicators in the same way.</span></p>
<p class="p_Text"><span class="f_Text">Remember the classic MACD trading rules. In addition to the actual indicator values, their position relative to the signal line within the histogram is also crucial. To test this relationship, let’s add the difference between the indicator lines as another variable.</span></p>
<p class="p_Text"><span class="f_Text">Now, let's address our reference point for the price movement. The ZigZag indicator gives absolute price values of extremes on a particular candlestick. However, we ideally want to know the price reference point for each market situation. In other words, we need a price guide for the upcoming movement on each candlestick. In doing so, we will consider two options for such a benchmark:</span></p>
<ul style="list-style-type:disc">
<li class="p_li"><span class="f_li">Direction of movement (vector </span><span class="f_li" style="font-style: italic;">target1</span><span class="f_li">).</span></li>
<li class="p_li"><span class="f_li">Magnitude of movement (vector </span><span class="f_li" style="font-style: italic;">target2</span><span class="f_li">).</span></li>
</ul>
<p class="p_Text"><span class="f_Text">We can solve this task using a loop. We will iterate over the ZigZag indicator values in reverse order (from the newest values to the oldest values). If the indicator finds an extremum, we will save its value in a local variable </span><span class="f_Text" style="font-style: italic; font-weight: bold;">extremum</span><span class="f_Text">. If there is no extremum, we will use the last saved value.</span></p>
<p class="p_Text"><span class="f_Text">Simultaneously, in the same loop, we will calculate and save the target values for our dataset. For this, we will subtract the closing price of the analyzed bar from the price value of the last peak. This way we get the magnitude of the movement to the nearest future extremum (target2 vector). The sign of this value will indicate the direction of movement (vector target1).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">oc</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bmc</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">buc</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">blc</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_delta</span><span class="f_CodeExample">[];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #8000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">oc</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">bmc</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">buc</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">blc</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)&nbsp;&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayResize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">macd_delta</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span></p>
</td>
</tr>
</table>
</div>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">extremum</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">-1</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">zz</span><span class="f_CodeExample">)&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #008000;">2</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&gt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">--)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">zz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008000;">1</span><span class="f_CodeExample">]&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">&nbsp;&amp;&amp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">zz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008000;">1</span><span class="f_CodeExample">]&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">EMPTY_VALUE</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">extremum</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">zz</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;+&nbsp;</span><span class="f_CodeExample" style="color: #008000;">1</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&gt;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">continue</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">extremum</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;=&nbsp;(</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;&gt;=&nbsp;</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">oc</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">open</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">sar</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;-=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_low</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_low</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_up</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;-=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_medium</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;-=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">close</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_delta</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_main</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">]&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_signal</span><span class="f_CodeExample">[</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">After completing the preparatory work, we will proceed to check the data correlation. Since we'll be performing the same operation for different indicator data, it makes sense to encapsulate this iteration in a separate function. From the body of the </span><span class="f_Text" style="font-style: italic;">Start</span><span class="f_Text"> function, we will only make the function call, passing different source data to it. The results of the correlation analysis will be saved to a </span><span class="f_Text" style="font-style: italic;">CSV</span><span class="f_Text"> file for further processing.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: auto; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_Functions">FileOpen</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;correlation.csv&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_Definition">FILE_WRITE</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_Definition">FILE_CSV</span><span class="f_CodeExample">&nbsp;|&nbsp;</span><span class="f_Definition">FILE_ANSI</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;\t&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_Definition">CP_UTF8</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Indicator\tTarget&nbsp;1\tTarget&nbsp;2&quot;</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">&nbsp;!=&nbsp;</span><span class="f_Definition">INVALID_HANDLE</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_Functions">FileWrite</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample" style="color: #808080;">//---</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">oc</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Close&nbsp;-&nbsp;Open&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">hc</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;High&nbsp;-&nbsp;Close&nbsp;%.5f&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">lc</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;Close&nbsp;-&nbsp;Low&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">cci</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;CCI&nbsp;%.5f&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">rsi</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;RSI&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">atr</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;ATR&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">sar</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;SAR&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_main</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MACD&nbsp;Main&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_signal</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MACD&nbsp;Signal&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">macd_delta</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #008080;">&quot;MACD&nbsp;Main-Signal&quot;</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_medium</span><span class="f_CodeExample">,&nbsp;&quot;</span><span class="f_CodeExample" style="color: #008080;">BB&nbsp;Main</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_low</span><span class="f_CodeExample">,&nbsp;&quot;</span><span class="f_CodeExample" style="color: #008080;">BB&nbsp;Low</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">bands_up</span><span class="f_CodeExample">,&nbsp;&quot;</span><span class="f_CodeExample" style="color: #008080;">BB&nbsp;Up</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">stoch</span><span class="f_CodeExample">,&nbsp;&quot;</span><span class="f_CodeExample" style="color: #008080;">Stochastic&nbsp;Main</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ssig</span><span class="f_CodeExample">,&nbsp;&quot;</span><span class="f_CodeExample" style="color: #008080;">Stochastic&nbsp;Signal</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">mfi</span><span class="f_CodeExample">,&nbsp;&quot;</span><span class="f_CodeExample" style="color: #008080;">MFI</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample" style="color: #808080;">//---</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">FileFlush</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">FileClose</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The algorithm of our correlation test method is pretty straightforward. The correlation coefficient is calculated using the </span><span class="f_Text" style="font-style: italic; font-weight: bold;">MathCorrelationPearson</span><span class="f_Text"> function from the MQL5 standard statistical analysis library. We will call this function sequentially for two sets of data:</span></p>
<ul style="list-style-type:disc">
<li class="p_li"><span class="f_li">Indicator and direction of the upcoming movement; and</span></li>
<li class="p_li"><span class="f_li">Indicator and strength of the upcoming movement.</span></li>
</ul>
<p class="p_Text"><span class="f_Text">The results of the analysis are used to form a text message, which is then written to a local file.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">Correlation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #0000ff;">&nbsp;double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">[],</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">indicator</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #0000ff;">&nbsp;string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">,</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;{&nbsp;</span><br>
<span class="f_CodeExample" style="color: #808080;">//---</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #008000;">0</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">=&quot;&quot;;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">MathCorrelationPearson</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target1</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">indicator</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">))</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #8000ff;">StringFormat</span><span class="f_CodeExample">(&quot;</span><span class="f_CodeExample" style="color: #008080;">%s\t%.5f</span><span class="f_CodeExample">&quot;,</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">MathCorrelationPearson</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">target2</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">indicator</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">))</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #8000ff;">StringFormat</span><span class="f_CodeExample">(&quot;</span><span class="f_CodeExample" style="color: #008080;">%s\t%.5f</span><span class="f_CodeExample">&quot;,</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">!=</span><span class="f_CodeExample" style="color: #ff0000;">INVALID_HANDLE</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">FileWrite</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">The results of my analysis are presented in the graph below. The data show that there is no correlation between our target data and the ATR indicator values. The deviation from the extremes of the candlestick to its closing price (</span><span class="f_Text" style="font-style: italic; font-weight: bold;">High – Close</span><span class="f_Text">, </span><span class="f_Text" style="font-style: italic; font-weight: bold;">Close – Low</span><span class="f_Text">) also shows a low correlation with the expected price movement. Consequently, we can safely exclude these figures from our further analysis.</span></p>
<div class="p_Text" style="text-align: center;"><div style="margin:0 auto 0 auto;width:600px"><img class="help" id="initial_data_correlation" alt="Correlation of indicator values with expected price movements" title="Correlation of indicator values with expected price movements" width="600" height="400" style="width:600px;height:400px;border:none" src="indat_correlation.png"/><p style="text-align:center"><span class="f_ImageCaption">Correlation of indicator values with expected price movements</span></p></div></div>
<p class="p_Text"><span class="f_Text">In general, the conducted analysis shows that determining the direction of the upcoming movement is much easier than predicting its strength. All indicators showed a higher correlation with the direction rather than the magnitude of the upcoming movement. However, the correlation with all values remains rather low. The RSI indicator demonstrated the highest correlation, with a value of 0.40 for the direction and 0.22 for the magnitude of the movement.</span></p>
<p class="p_Text"><span class="f_Text">The correlation coefficient takes values from -1 (inverse relationship) to 1 (direct relationship), with 0 indicating a complete absence of dependence between random variables.</span></p>
<p class="p_Text"><span class="f_Text">It's worth noting that among the three arrays of data obtained from the MACD indicator (histogram, signal line, and the difference between them), it's the distance between the MACD lines that demonstrated the highest correlation with the target data. This only confirms the validity of the classical approach to using indicator signals.</span></p>
<p class="p_Text"><span class="f_Text">The next step is to test the correlation between data from different indicators. To avoid comparing each indicator with all others, we will analyze the correlation of indicators with RSI (the winner of the previous stage). We will perform the task using the previously created script with minor modifications. The new script will be saved in the file </span><span class="f_Text" style="font-style: italic;">initial_data_rsi.mq5</span><span class="f_Text"> in our <a href="3_3_initial_data.htm#full_path" class="topiclink">subdirectory</a>.</span></p>
<div class="p_Text" style="text-align: center;"><div style="margin:0 auto 0 auto;width:600px"><img class="help" id="indat_correlation_rsi" alt="Correlation of indicator values to RSI" title="Correlation of indicator values to RSI" width="600" height="400" style="width:600px;height:400px;border:none" src="indat_correlation_rsi.png"/><p style="text-align:center"><span class="f_ImageCaption">Correlation of indicator values to RSI</span></p></div></div>
<p class="p_Text"><span class="f_Text">The analysis showed a strong correlation of RSI with a range of indicators. Stochastic, CCI, and MFI have a correlation coefficient with RSI which is greater than 0.70, while the main line of Bollinger Bands showed an inverse correlation of -0.76 with RSI. This indicates that the indicators mentioned above will only duplicate signals. Including them for analysis in our neural network will only complicate its architecture and maintenance. The expected impact of their use will be minimal. Therefore, we are excluding the aforementioned indicators from further analysis.</span></p>
<p class="p_Text"><span class="f_Text">The indicators that show the minimum correlation with </span><span class="f_Text" style="font-style: italic;">RSI</span><span class="f_Text"> are the two deviation variables:</span></p>
<ul style="list-style-type:disc">
<li class="p_li"><span class="f_li">MACD signal line (0.40);</span></li>
<li class="p_li"><span class="f_li">Between opening and closing prices (0.23).</span></li>
</ul>
<p class="p_Text"><span class="f_Text">The deviation of the MACD signal line from the histogram in the first step showed a strong correlation with the target data of the upcoming price movement. Based on this data, it is MACD that will be taken into our indicator basket. Next, we will check its correlation with the remaining indicators.</span></p>
<p class="p_Text"><span class="f_Text">The updated script is saved in the file </span><span class="f_Text" style="font-style: italic;">initial_data_macd.mq5</span><span class="f_Text"> in the <a href="3_3_initial_data.htm#full_path" class="topiclink">subdirectory</a>.</span></p>
<div class="p_Text" style="text-align: center;"><div style="margin:0 auto 0 auto;width:600px"><img class="help" id="indat_correlation_macd" alt="Correlation of indicator values to MACD Main-Signal" title="Correlation of indicator values to MACD Main-Signal" width="600" height="400" style="width:600px;height:400px;border:none" src="indat_correlation_macd.png"/><p style="text-align:center"><span class="f_ImageCaption">Correlation of indicator values to MACD Main-Signal</span></p></div></div>
<p class="p_Text"><span class="f_Text">The SAR indicator here shows some interesting data. With moderate levels of inverse correlation to the target data, it shows a relatively high negative correlation with both selected indicators. The correlation coefficient with MACD was -0.66 and for RSI it was -0.62. This gives us reason to exclude the SAR indicator from the basket of analyzed indicators.</span></p>
<p class="p_Text"><span class="f_Text">A similar situation is observed for all three Bollinger Bands indicator lines.</span></p>
<p class="p_Text"><span class="f_Text">So far, we have selected two indicators for our indicator basket for further training of the neural network.</span></p>
<p class="p_Text"><span class="f_Text">But this is not the end of the road to initial data selection. It should be noted that the neural network analyzes linear dependencies between the target values and the initial data in their pure form. So, it analyzes the data that is input into it. Each indicator is analyzed in isolation from other data available on the neuron input layer.</span></p>
<p class="p_Text"><span class="f_Text">Hence, the neural network won't be able to capture the relationship between the source data and target values if it's not a linear relationship, such as being power law or logarithmic instead. To find such relationships, we need to prepare data beforehand. And to test the usefulness of such work, we need to test the correlation between such values.</span></p>
<p class="p_Text"><span class="f_Text">In the script </span><span class="f_Text" style="font-style: italic;">initial_data_rsi_pow.mq5</span><span class="f_Text">, we will analyze the change in correlation with the expected price movement when the RSI indicator values are set to different degrees. The new script can be saved in the appropriate <a href="3_3_initial_data.htm#full_path" class="topiclink">subdirectory</a>.</span></p>
<div class="p_Text" style="text-align: center;"><div style="margin:0 auto 0 auto;width:600px"><img class="help" id="indat_correlation_rsi_pow" alt="The dynamics of how the correlation of RSI values changes in relation to the expected movement when raising the indicator to a power." title="The dynamics of how the correlation of RSI values changes in relation to the expected movement when raising the indicator to a power." width="600" height="400" style="width:600px;height:400px;border:none" src="indat_correlation_rsi_pow.png"/><p style="text-align:center"><span class="f_ImageCaption">The dynamics of how the correlation of RSI values changes in relation to the expected movement when raising the indicator to a power.</span></p></div></div>
<p class="p_Text"><span class="f_Text">The presented graph clearly shows that as the exponentiation of the indicator values increases, the correlation with the original values decreases much faster than with the expected price movement. This observation gives us a potential opportunity to expand the basket of original data indicators with exponential values of the selected indicators. A little later, we will be able to see how it works in practice. </span></p>
<p class="p_Text"><span class="f_Text">It's important to note that when using exponential operations on indicators, you need to consider the properties of exponents and the nature of indicator values. Indeed, when raising any number to an even exponent, the result will always be positive. In other words, we lose the sign of the number.</span></p>
<p class="p_Text"><span class="f_Text">For example, if we have two equal-magnitude values of a certain indicator with opposite signs, and they correlate with the target data. If the indicator is positive, the target function grows and if it is negative, it falls. Squared values for such an indicator will give us the same value. In this case, we will observe a decrease in correlation or a complete absence of it, as our target function remains unchanged while the indicator loses its sign.</span></p>
<p class="p_Text"><span class="f_Text">This effect is noticeable when analyzing the change in correlation when raising the power of the difference between the lines of the MACD indicator, which we conducted in the script </span><span class="f_Text" style="font-style: italic;">initial_data_macd_pow.mq5</span><span class="f_Text"> from our <a href="3_3_initial_data.htm#full_path" class="topiclink">subdirectory</a>.</span></p>
<div class="p_Text" style="text-align: center;"><div style="margin:0 auto 0 auto;width:600px"><img class="help" id="indat_correlation_macd_pow" alt="Dynamics of changing the correlation of MACD values to expected movement when raising the indicator to the power" title="Dynamics of changing the correlation of MACD values to expected movement when raising the indicator to the power" width="600" height="400" style="width:600px;height:400px;border:none" src="indat_correlation_macd_pow.png"/><p style="text-align:center"><span class="f_ImageCaption">Dynamics of changing the correlation of MACD values to expected movement when raising the indicator to the power</span></p></div></div>
<p class="p_Text"><span class="f_Text">Similarly, you can test the correlation of various indicators with the target values. The only limit is your ability and common sense. In addition to standard indicators and price quotes, these could also include custom indicators, and quotes from other instruments, including synthetic ones. Don't be afraid to experiment. Sometimes you can find good indicators in the most unexpected places.</span></p>
<p class="p_Text"><span class="f_Text">&nbsp;</span></p>
<p class="p_H3"><span class="f_H3">Effect of the time shift on the correlation coefficient</span></p>
<p class="p_Text"><span class="f_Text">After selecting the indicators for analysis, let's remember that we are dealing with time series data. One of the features of time series is their &quot;historical memory&quot;. Each subsequent value depends not only on one previous value but also on a certain depth of historical values.</span></p>
<p class="p_Text"><span class="f_Text">Certainly, one approach could be experimental – building a neural network and conducting a series of experiments to identify the optimal configuration. In this approach, it will take time to create and train several experimental models. Optionally, we could use our sample to test the correlation of the data with the historical shift.</span></p>
<p class="p_Text"><span class="f_Text">To solve this problem, let's modify the script slightly and replace the </span><span class="f_Text" style="font-style: italic;">Correlation</span><span class="f_Text"> function with </span><span class="f_Text" style="font-style: italic; font-weight: bold;">ShiftCorrelation</span><span class="f_Text">. The new function is a complete descendant of the </span><span class="f_Text" style="font-style: italic;">Correlation</span><span class="f_Text"> function and is built using the same algorithm.</span></p>
<p class="p_Text"><span class="f_Text">In the function parameters, we add a new variable </span><span class="f_Text" style="font-style: italic;">max_shift</span><span class="f_Text"> to which we pass the maximum shift for analysis.</span></p>
<p class="p_Text"><span class="f_Text">Time offsets are organized by copying the data to the new shifted arrays. The initial data will be copied without offset but to a lesser extent. Data reduction corresponds to time offset. At the same time, we will transfer the target values data to new arrays with offsets. However, since the size of the target data in our dataset is constant, when shifting, the number of elements for correlation analysis decreases. Therefore, after copying the data, we get data sets that are comparable in size and with a given time shift.</span></p>
<p class="p_Text"><span class="f_Text">All we need to do is call the correlation coefficient calculation function and write the resulting data to a file.</span></p>
<p class="p_Text"><span class="f_Text">To analyze the change in correlation with the increase in displacement over time, wrap all operations in a loop. The number of looping iterations corresponds to the </span><span class="f_Text" style="font-style: italic;">max_shift</span><span class="f_Text"> parameter. </span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">ShiftCorrelation</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">targ1</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #0000ff;">&nbsp;double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">targ2</span><span class="f_CodeExample">[],</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double</span><span class="f_CodeExample">&nbsp;&amp;</span><span class="f_CodeExample" style="color: #333333;">signal</span><span class="f_CodeExample">[],</span><span class="f_CodeExample" style="color: #0000ff;">&nbsp;string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">name</span><span class="f_CodeExample">,</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">max_shift</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #0000ff;">&nbsp;int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;{</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArraySize</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">targ1</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">max_shift</span><span class="f_CodeExample">&nbsp;&gt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">max_shift</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">10</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">max_shift</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">10</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">&nbsp;&lt;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">max_shift</span><span class="f_CodeExample">;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">++)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t1</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t2</span><span class="f_CodeExample">[],&nbsp;</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">[];</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #8000ff;">ArrayCopy</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">targ1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayCopy</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">t2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">targ2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">&nbsp;||</span><br>
<span class="f_CodeExample" style="color: #0000ff;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">ArrayCopy</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">signal</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">total</span><span class="f_CodeExample">&nbsp;-&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">)&nbsp;&lt;=&nbsp;</span><span class="f_CodeExample" style="color: #333333;">0</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">continue</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//---</span></p>
</td>
</tr>
</table>
</div>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; page-break-after: avoid; border-color: #d8dfea; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid; page-break-after: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">MathCorrelationPearson</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t1</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">))</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">StringFormat</span><span class="f_CodeExample">(&quot;%</span><span class="f_CodeExample" style="color: #333333;">d</span><span class="f_CodeExample">\</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">%.</span><span class="f_CodeExample" style="color: #333333;">5f</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">i</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">MathCorrelationPearson</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">t2</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">))</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">&nbsp;=&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">StringFormat</span><span class="f_CodeExample">(&quot;%</span><span class="f_CodeExample" style="color: #333333;">s</span><span class="f_CodeExample">\</span><span class="f_CodeExample" style="color: #333333;">t</span><span class="f_CodeExample">%.</span><span class="f_CodeExample" style="color: #333333;">5f</span><span class="f_CodeExample">&quot;,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">correlation</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">&nbsp;!=&nbsp;</span><span class="f_CodeExample" style="color: #ff0000;">INVALID_HANDLE</span><span class="f_CodeExample">)</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #8000ff;">FileWrite</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #333333;">handle</span><span class="f_CodeExample">,&nbsp;</span><span class="f_CodeExample" style="color: #333333;">message</span><span class="f_CodeExample">);</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="f_CodeExample" style="color: #808080;">//---</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br>
<span class="f_CodeExample">&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<div class="p_Text" style="text-align: center;"><div style="margin:0 auto 0 auto;width:600px"><img class="help" id="indat_correlation_rsi_shift" alt="Dynamics of the correlation between RSI values and the expected movement, with time shift" title="Dynamics of the correlation between RSI values and the expected movement, with time shift" width="600" height="400" style="width:600px;height:400px;border:none" src="indat_correlation_rsi_shift.png"/><p style="text-align:center"><span class="f_ImageCaption">Dynamics of the correlation between RSI values and the expected movement, with time shift</span></p></div></div>
<p class="p_Text"><span class="f_Text">To analyze the effect of shifting RSI indicator values over time on the correlation with target data, we will create a new script in the file initial_data_rsi_shift.mq5 in the specified </span><span class="f_Text" style="font-style: italic;">initial_data_rsi_shift.mq5</span><span class="f_Text"> <a href="3_3_initial_data.htm#full_path" class="topiclink">subdirectory</a>.</span></p>
<p class="p_Text"><span class="f_Text">The results of the analysis show a rapid decline in the correlation up to the 30th bar. Then, a slight inverse correlation with a peak coefficient of -0.042 is observed around the 60th bar, followed by a gradual approach to 0. In such a situation, the use of the first 30 bars would be most effective. Further expansion of the analysis depth may lead to a decrease in the efficiency of utilizing computational resources. The value of such a solution can be tested in practice.</span></p>
<p class="p_Text"><span class="f_Text">A similar analysis of MACD indicator data in the script </span><span class="f_Text" style="font-style: italic;">initial_data_macd_shift.mq5</span><span class="f_Text"> showed a similar dynamic with a slight shift in the transition zone from direct to inverse correlation at around the 40th bar.</span></p>
<p class="p_Text"><span class="f_Text">Thus, conducting a correlation analysis of available source data and target values allows us to choose the optimal set of indicators and historical depth during the preparatory phase. This helps in analyzing data and forecasting target values more effectively. This enables us to significantly reduce expenses during the neural network creation and training phases with relatively low effort spent on the preparatory stage. &nbsp;</span></p>
<div class="p_Text" style="text-align: center;"><div style="margin:0 auto 0 auto;width:600px"><img class="help" id="indat_correlation_macd_shift" alt="Dynamics of the correlation between MACD values and the expected movement, with time shift" title="Dynamics of the correlation between MACD values and the expected movement, with time shift" width="600" height="400" style="width:600px;height:400px;border:none" src="indat_correlation_macd_shift.png"/><p style="text-align:center"><span class="f_ImageCaption">Dynamics of the correlation between MACD values and the expected movement, with time shift</span></p></div></div>

</div>

</body>
</html>
