<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=Windows-1252" />
  <title>OnInit</title>
  <meta name="keywords" content="OnInit" />
  <link type="text/css" href="default.css" rel="stylesheet" />
  <link type="text/css" href="screenshot.css" rel="stylesheet" />
  

   
   
   


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Reference </a> / <a class="h_m" href="event_handlers.htm"> Event Handling </a>/ OnInit
          </td>
          <td width="70" align="right">
          <a href="onstart.htm"><img style="vertical-align:middle;" src="previous.png" alt="Previous" width="27" height="27" border=0></a>&nbsp;
          <a href="ondeinit.htm"><img style="vertical-align:middle;" src="next.png" alt="Next" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H1"><span class="f_H1">OnInit</span></p>
<p class="p_Function"><span class="f_Function">The function is called in indicators and EAs when the <a href="event_fire.htm#init" class="topiclink">Init</a> event occurs. It is used to initialize a running MQL5 program. There are two function types.</span></p>
<p class="p_Function"><span class="f_Function">The </span><span class="f_Function" style="font-weight: bold;">version</span><span class="f_BoldTitles"> that returns the result</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_Keywords">int&nbsp;&nbsp;</span><span class="f_Functions">OnInit</span><span class="f_CodeExample">(</span><span class="f_Keywords">void</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_BoldTitles"><span class="f_BoldTitles">Return Value</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark"><a href="integertypes.htm" class="topiclink">int</a> type value, zero means successful initialization.</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">When returning <a href="events.htm" class="topiclink">INIT_FAILED</a>, the EA is forcibly unloaded from the chart. </span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">When returning <a href="events.htm" class="topiclink">INIT_FAILED</a>, the indicator is not unloaded from the chart. The indicator remaining on the chart is non-operational — <a href="event_handlers.htm" class="topiclink">event handlers</a> are not called in the indicator. </span></p>
<p class="p_Function"><span class="f_Function">The OnInit() call that returns the execution result is recommended for use since it not only allows for program initialization, but also returns an error code in case of an early program termination.</span></p>
<p class="p_BoldTitles"><span class="f_BoldTitles">The version</span><span class="f_Function" style="font-weight: bold;"> without a result return</span><span class="f_Function"> is left only for compatibility with old codes. It is not recommended for use</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_Keywords">void&nbsp;&nbsp;</span><span class="f_Functions">OnInit</span><span class="f_CodeExample">(</span><span class="f_Keywords">void</span><span class="f_CodeExample">);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_BoldTitles"><span class="f_BoldTitles">Note</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">The Init event is generated immediately after loading an EA or an indicator. The event is not generated for scripts. The OnInit() function is used to initialize an MQL5 program. If OnInit() has a return value of <a href="integertypes.htm#int" class="topiclink">int</a> type, the non-zero return code means failed initialization and generates the <a href="event_fire.htm#deinit" class="topiclink">Deinit</a> event with the <a href="uninit.htm#reason_initfailed" class="topiclink">REASON_INITFAILED</a> deinitialization reason code.</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">OnInit() function of </span><span class="f_FunctionRemark" style="color: #0000ff;">void</span><span class="f_FunctionRemark"> type always means successful initialization and is not recommended for use.</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">For <a href="testing.htm" class="topiclink">optimizing</a> the EA <a href="inputvariables.htm" class="topiclink">inputs</a>, it is recommended to use values from the <a href="https://www.mql5.com/ru/docs/basis/function/events#enum_init_retcode" class="weblink">ENUM_INIT_RETCODE</a> enumeration as a return code. These values are intended for establishing the optimization process management, including selection of the most suitable <a href="https://www.mql5.com/ru/docs/runtime/testing#agents" class="weblink">test agents</a>. It is possible to request data on agent configuration and resources (number of cores, free memory amount, etc.) using the <a href="https://www.mql5.com/ru/docs/check/terminalinfointeger" class="weblink">TerminalInfoInteger()</a> function during the EA initialization before launching the test. Based on the obtained data, you can either allow using the test agent or ban it from optimizing the EA.</span></p>
<div style="text-align: justify; text-indent: 0; padding: 0 0 0 0; margin: 8px 17px 7px 17px;"><table class="EnumTable" cellspacing="0" cellpadding="5" border="1">
<thead>
<tr class="EnumTable">
<th class="EnumTable" style="width:200px;"><p class="p_EnumHeader"><span class="f_EnumHeader">ID</span></p>
</th>
<th class="EnumTable"><p class="p_EnumHeader"><span class="f_EnumHeader">Description</span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="EnumTable">
<td class="EnumTable" style="width:200px;"><p class="p_EnumID"><span class="f_EnumID">INIT_SUCCEEDED</span></p>
</td>
<td class="EnumTable"><p class="p_EnumDesc"><span class="f_EnumDesc">Initialization successful, EA test can be continued.</span></p>
<p class="p_EnumDesc"><span class="f_EnumDesc">This code means the same as the zero value – the EA initialization in the tester is successful.</span></p>
</td>
</tr>
<tr class="EnumTable">
<td class="EnumTable" style="width:200px;"><p class="p_EnumID"><span class="f_EnumID">INIT_FAILED</span></p>
</td>
<td class="EnumTable"><p class="p_EnumDesc"><span class="f_EnumDesc">Initialization failed. There is no point in continuing the test due to unavoidable errors. For example, it is impossible to create an indicator necessary for the EA operation.</span></p>
<p class="p_EnumDesc"><span class="f_EnumDesc">The return of this value means the same as returning the value different from zero – EA initialization in the tester failed.</span></p>
</td>
</tr>
<tr class="EnumTable">
<td class="EnumTable" style="width:200px;"><p class="p_EnumID"><span class="f_EnumID">INIT_PARAMETERS_INCORRECT</span></p>
</td>
<td class="EnumTable"><p class="p_EnumDesc"><span class="f_EnumDesc">Designed to denote an incorrect set of input parameters by a programmer. In the general optimization table, the result string with this return code is highlighted in red.</span></p>
<p class="p_EnumDesc"><span class="f_EnumDesc">A test for such a set of EA inputs is not performed. The agent is ready to receive a new task.</span></p>
<p class="p_EnumDesc"><span class="f_EnumDesc">When this value is received, the strategy tester does not pass this task to other agents for repeated execution.</span></p>
</td>
</tr>
<tr class="EnumTable">
<td class="EnumTable" style="width:200px;"><p class="p_EnumID"><span class="f_EnumID">INIT_AGENT_NOT_SUITABLE</span></p>
</td>
<td class="EnumTable"><p class="p_EnumDesc"><span class="f_EnumDesc">No program execution errors during initialization. However, for some reasons, the agent is not suitable for conducting a test. For example, there is not enough RAM, no <a href="opencl.htm" class="topiclink">OpenCL support</a>, etc. </span></p>
<p class="p_EnumDesc"><span class="f_EnumDesc">After returning this code, the agent no longer receives tasks until the very end of <a href="testing.htm" class="topiclink">this optimization</a>.</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">Using <a href="oninit.htm" class="topiclink">OnInit()</a> returning INIT_FAILED/INIT_PARAMETERS_INCORRECT in the tester have some peculiarities that should be considered when optimizing EAs:</span></p>
<ul style="list-style-type:disc">
<li class="p_FunctionRemLI"><span class="f_FunctionRemLI">the set of parameters the OnInit() returned INIT_PARAMETERS_INCORRECT for is considered unsuitable for testing and is not used to obtain the next population during <a href="https://www.metatrader5.com/en/terminal/help/algotrading/optimization_types" target="_blank" class="weblink">genetic optimization</a>. Too many &quot;discarded&quot; parameter sets may lead to incorrect results when searching for optimal EA parameters. The search algorithm assumes that the <a href="https://www.metatrader5.com/en/terminal/help/algotrading/optimization_types#criterion" target="_blank" class="weblink">optimization criterion</a> function is smooth and has no gaps on the entire multitude of input parameters.</span></li>
<li class="p_FunctionRemLI"><span class="f_FunctionRemLI">if OnInit() returns INIT_FAILED, this means that a test cannot be launched, and the EA is unloaded from the agent's memory. The EA is loaded again to perform the next pass with a new set of parameters. Launching the next optimization pass takes much more time as compared to calling TesterStop().</span></li>
</ul>
<p class="p_Text"><span class="f_Text" style="font-weight: bold;">Sample OnInit() function for an EA</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample" style="color: #808080;">//---&nbsp;input&nbsp;parameters</span>
<br><span class="f_CodeExample" style="color: #0000ff;">input</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="font-weight: bold; color: #c0504d;">ma_period</span><span class="f_CodeExample">=20;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//&nbsp;moving&nbsp;average&nbsp;period</span>
<br><span class="f_CodeExample">&nbsp;</span>
<br><span class="f_CodeExample" style="color: #808080;">//---&nbsp;handle&nbsp;of&nbsp;the&nbsp;indicator&nbsp;used&nbsp;in&nbsp;the&nbsp;EA</span>
<br><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;indicator_handle;&nbsp;&nbsp;&nbsp;</span>
<br><span class="f_CodeExample" style="color: #808080;">//+------------------------------------------------------------------+</span>
<br><span class="f_CodeExample" style="color: #808080;">//|&nbsp;Expert&nbsp;initialization&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>
<br><span class="f_CodeExample" style="color: #808080;">//+------------------------------------------------------------------+</span>
<br><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">OnInit</span><span class="f_CodeExample">()</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample" style="color: #808080;">//---&nbsp;check&nbsp;ma_period&nbsp;validity</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="font-weight: bold; color: #c0504d;">ma_period</span><span class="f_CodeExample">&lt;=0)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Invalid&nbsp;ma_period&nbsp;input&nbsp;value:&nbsp;%d&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="font-weight: bold; color: #c0504d;">ma_period</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;(</span><span class="f_CodeExample" style="color: #ff0000;">INIT_PARAMETERS_INCORRECT</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample" style="color: #808080;">//---&nbsp;during&nbsp;optimization</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">MQLInfoInteger</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">MQL_OPTIMIZATION</span><span class="f_CodeExample">))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #808080;">//---&nbsp;check&nbsp;available&nbsp;RAM&nbsp;for&nbsp;the&nbsp;agent</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;available_memory_mb=</span><span class="f_CodeExample" style="color: #0000ff;">TerminalInfoInteger</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">TERMINAL_MEMORY_TOTAL</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(available_memory_mb&lt;2000)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Insufficient&nbsp;memory&nbsp;for&nbsp;the&nbsp;test&nbsp;agent:&nbsp;%d&nbsp;MB&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;available_memory_mb);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;(</span><span class="f_CodeExample" style="color: #ff0000;">INIT_AGENT_NOT_SUITABLE</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample" style="color: #808080;">//---&nbsp;check&nbsp;for&nbsp;the&nbsp;indicator</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;indicator_handle=</span><span class="f_CodeExample" style="color: #0000ff;">iCustom</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">_Symbol</span><span class="f_CodeExample">,_Period,</span><span class="f_CodeExample" style="color: #008080;">&quot;My_Indicator&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="font-weight: bold; color: #c0504d;">ma_period</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(indicator_handle==</span><span class="f_CodeExample" style="color: #ff0000;">INVALID_HANDLE</span><span class="f_CodeExample">)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PrintFormat</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Failed&nbsp;to&nbsp;generate&nbsp;My_Indicator&nbsp;handle.&nbsp;Error&nbsp;code&nbsp;%d&quot;</span><span class="f_CodeExample">,</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">GetLastError</span><span class="f_CodeExample">());</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">&nbsp;(</span><span class="f_CodeExample" style="color: #ff0000;">INIT_FAILED</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample" style="color: #808080;">//---&nbsp;EA&nbsp;initialization&nbsp;successful</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #ff0000;">INIT_SUCCEEDED</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_BoldTitles"><span class="f_BoldTitles">See also</span></p>
<p class="p_SeeAlso"><span class="f_SeeAlso"><a href="ondeinit.htm" class="topiclink">OnDeinit</a>,<a href="events.htm" class="topiclink"> Event handling functions</a>, <a href="running.htm" class="topiclink">Program running</a>, <a href="event_fire.htm" class="topiclink">Client terminal events</a>, <a href="initialization.htm" class="topiclink">Initialization of variables</a>, <a href="object_live.htm" class="topiclink">Creating and deleting objects</a></span></p>

</div>

</body>
</html>
