<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=Windows-1252" />
  <title>PrecisionRecall</title>
  <meta name="keywords" content="" />
  <link type="text/css" href="default.css" rel="stylesheet" />
  <link type="text/css" href="screenshot.css" rel="stylesheet" />
  

   
   
   


</head>

<body style="background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;">



<table width="100%" height="49"  border="0" cellpadding="0" cellspacing="0" style="margin-top:0px; background-color:#1660af;">
  <tr>
    <td></td>
    <td valign="middle">
      <table style="margin-top:4px; margin-bottom:5px;" width="100%"  border="0" cellspacing="0" cellpadding="5">
        <tr valign="middle">
          <td class="nav">
<a class="h_m" href="index.htm">          MQL5 Reference </a> / <a class="h_m" href="matrix.htm"> Matrix and Vector Methods </a> / <a class="h_m" href="matrix_machine_learning.htm"> Machine learning </a>/ PrecisionRecall
          </td>
          <td width="70" align="right">
          <a href="matrix_classificationscore.htm"><img style="vertical-align:middle;" src="previous.png" alt="Previous" width="27" height="27" border=0></a>&nbsp;
          <a href="matrix_roc.htm"><img style="vertical-align:middle;" src="next.png" alt="Next" width="27" height="27" border="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="5"></td>
  </tr>
</table>



<div id="help">
<p class="p_H1"><span class="f_H1">PrecisionRecall</span></p>
<p class="p_Function"><span class="f_Function">Compute values to construct a precision-recall curve. Similarly to <a href="matrix_classificationscore.htm" class="topiclink">ClassificationScore</a>, this method is applied to the vector of true values.</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_Keywords">bool&nbsp;vector::</span><span class="f_Functions">PrecisionRecall</span><span class="f_CodeExample">(</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_Keywords">const&nbsp;matrix&amp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Param">pred_scores</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;</span><span class="f_Comments">//&nbsp;matrix&nbsp;containing&nbsp;the&nbsp;probability&nbsp;distribution&nbsp;for&nbsp;each&nbsp;class</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_Keywords">const&nbsp;ENUM_ENUM_AVERAGE_MODE&nbsp;&nbsp;</span><span class="f_Param">mode</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Comments">//&nbsp;averaging&nbsp;mode</span>
<br><span class="f_Keywords">&nbsp;&nbsp;&nbsp;matrix&amp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Param">precision</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Comments">//&nbsp;calculated&nbsp;precision&nbsp;values&nbsp;for&nbsp;each&nbsp;threshold&nbsp;value</span>
<br><span class="f_Keywords">&nbsp;&nbsp;&nbsp;matrix&amp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Param">recall</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Comments">//&nbsp;calculated&nbsp;recall&nbsp;values&nbsp;for&nbsp;each&nbsp;threshold&nbsp;value</span>
<br><span class="f_Keywords">&nbsp;&nbsp;&nbsp;matrix&amp;</span><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Param">thresholds</span><span class="f_CodeExample">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Comments">//&nbsp;threshold&nbsp;values&nbsp;sorted&nbsp;in&nbsp;descending&nbsp;order</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;);</span></p>
</td>
</tr>
</table>
</div>
<p class="p_BoldTitles"><span class="f_BoldTitles">Parameters</span></p>
<p class="p_FunctionParameter"><span class="f_FunctionParameter">pred_scores</span></p>
<p class="p_ParameterDesrciption"><span class="f_ParameterDesrciption">[in] &nbsp;A matrix containing a set of horizontal vectors with probabilities for each class. The number of matrix rows must correspond to the size of the vector of true values.</span></p>
<p class="p_FunctionParameter"><span class="f_FunctionParameter">mode</span></p>
<p class="p_ParameterDesrciption"><span class="f_ParameterDesrciption">[in] &nbsp;Averaging mode from the <a href="matrix_enumerations.htm#enum_average_mode" class="topiclink">ENUM_AVERAGE_MODE</a> enumeration. Only AVERAGE_NONE, AVERAGE_BINARY and AVERAGE_MICRO are used.</span></p>
<p class="p_FunctionParameter"><span class="f_FunctionParameter">precision</span></p>
<p class="p_ParameterDesrciption"><span class="f_ParameterDesrciption">[out] &nbsp;A matrix with calculated precision curve values. If no averaging is applied (AVERAGE_NONE), the number of rows in the matrix corresponds to the number of model classes. The number of columns corresponds to the size of the vector of true values (or the number of rows in the probability distribution matrix pred_score). In the case of microaveraging, the number of rows in the matrix corresponds to the total number of threshold values, excluding duplicates.</span></p>
<p class="p_FunctionParameter"><span class="f_FunctionParameter">recall</span></p>
<p class="p_ParameterDesrciption"><span class="f_ParameterDesrciption">[out] &nbsp;A matrix with calculated recall curve values.</span></p>
<p class="p_FunctionParameter"><span class="f_FunctionParameter">threshold</span></p>
<p class="p_ParameterDesrciption"><span class="f_ParameterDesrciption">[out] &nbsp;Threshold matrix obtained by sorting the probability matrix</span></p>
<p class="p_ParameterDesrciption"><span class="f_ParameterDesrciption">&nbsp;</span></p>
<p class="p_BoldTitles"><span class="f_BoldTitles">Note</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">See notes for the <a href="matrix_classificationscore.htm" class="topiclink">ClassificationScore</a> method.</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">&nbsp;</span></p>
<p class="p_Text"><span class="f_Text" style="font-weight: bold;">Example</span></p>
<p class="p_Text"><span class="f_Text">An example of collecting statistics from the mnist.onnx model (99% accuracy).</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_Comments" style="page-break-inside: avoid;"><span class="f_Comments">//---&nbsp;data&nbsp;for&nbsp;classification&nbsp;metrics</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">vectorf</span><span class="f_CodeExample">&nbsp;y_true(images);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">vectorf</span><span class="f_CodeExample">&nbsp;y_pred(images);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">matrixf</span><span class="f_CodeExample">&nbsp;y_scores(images,10);</span></p>
<p class="p_Comments" style="page-break-inside: avoid;"><span class="f_Comments">//---&nbsp;input-output</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">matrixf</span><span class="f_CodeExample">&nbsp;image(</span><span class="f_CodeExample" style="color: #008080;">28</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008080;">28</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">vectorf</span><span class="f_CodeExample">&nbsp;result(</span><span class="f_CodeExample" style="color: #008080;">10</span><span class="f_CodeExample">);</span>
<br><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Comments" style="page-break-inside: avoid;"><span class="f_Comments">//---&nbsp;testing</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample">&nbsp;test=</span><span class="f_Indicators">0</span><span class="f_CodeExample">;&nbsp;test&lt;images;&nbsp;test++)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Definition">image</span><span class="f_Indicators">=</span><span class="f_CodeExample">test_data[test].image;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(!OnnxRun(model,</span><span class="f_CodeExample" style="color: #0000ff;">ONNX_DEFAULT</span><span class="f_CodeExample">,image,result))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_Keywords">Print</span><span class="f_CodeExample">(&quot;</span><span class="f_CodeExample" style="color: #008080;">OnnxRun&nbsp;error</span><span class="f_CodeExample">&nbsp;&quot;,GetLastError());</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.Activation(result,</span><span class="f_CodeExample" style="color: #0000ff;">AF_SOFTMAX</span><span class="f_CodeExample">);</span></p>
<p class="p_Comments" style="page-break-inside: avoid;"><span class="f_Comments">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//---&nbsp;collect&nbsp;data</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_true[test]=(</span><span class="f_CodeExample" style="color: #0000ff;">float</span><span class="f_CodeExample">)test_data[test].label;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_pred[test]=(</span><span class="f_CodeExample" style="color: #0000ff;">float</span><span class="f_CodeExample">)result.ArgMax();</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_scores.Row(result,test);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">&nbsp;</span><br>
<span class="f_Text"><a href="matrix_classificationmetric.htm" class="topiclink">Accuracy calculation</a></span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">vectorf</span><span class="f_CodeExample">&nbsp;</span><span class="f_CodeExample">accuracy=y_pred.ClassificationMetric(y_true,CLASSIFICATION_ACCURACY);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample">PrintFormat(&quot;</span><span class="f_CodeExample" style="color: #008080;">accuracy=%f</span><span class="f_CodeExample">&quot;,accuracy[</span><span class="f_Indicators">0</span><span class="f_CodeExample">]);</span>
<br><span class="f_CodeExample">&nbsp;</span><br>
<span class="f_CodeExample">accuracy=0.989000</span></p>
</td>
</tr>
</table>
</div>
<p class="p_Text"><span class="f_Text">An example of plotting precision-recall graphs, where precision values are plotted on the y-axis and recall values are plotted on the x-axis. Also precision and recall graphs are plotted separately, with threshold values plotted on the x-axis &nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.0; page-break-inside: avoid; border-color: #b3b3b3; border-style: solid; border-width: thin; background: #fbf9f5; padding: 0 0 0 0; margin: 2px 17px 2px 17px;"><table cellspacing="0" cellpadding="3" border="0" style="text-align: justify;border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:3px; border:none"><p class="p_CodeExample" style="page-break-inside: avoid;"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample">(y_true.PrecisionRecall(y_scores,</span><span class="f_CodeExample" style="color: #0000ff;">AVERAGE_MICRO</span><span class="f_CodeExample">,mat_precision,mat_recall,mat_thres))</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&nbsp;precision[],recall[],thres[];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayResize</span><span class="f_CodeExample">(precision,mat_thres.Cols());</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayResize</span><span class="f_CodeExample">(recall,mat_thres.Cols());</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">ArrayResize</span><span class="f_CodeExample">(thres,mat_thres.Cols());</span>
<br><span class="f_CodeExample">&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">uint</span><span class="f_CodeExample">&nbsp;i=0;&nbsp;i&lt;thres.Size();&nbsp;i++)</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;precision[i]=mat_precision[0][i];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recall[i]=mat_recall[0][i];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thres[i]=mat_thres[0][i];</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thres[</span><span class="f_CodeExample" style="color: #008080;">0</span><span class="f_CodeExample">]=thres[</span><span class="f_CodeExample" style="color: #008080;">1</span><span class="f_CodeExample">]+</span><span class="f_CodeExample" style="color: #008080;">0.001</span><span class="f_CodeExample">;</span>
<br><span class="f_CodeExample">&nbsp;</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">PlotCurve</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Precision-Recall&nbsp;curve&nbsp;(micro&nbsp;average)&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008080;">&quot;p-r&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008080;">&quot;&quot;</span><span class="f_CodeExample">,recall,precision);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="f_CodeExample" style="color: #0000ff;">Plot2Curves</span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #008080;">&quot;Precision-Recall&nbsp;(micro&nbsp;average)&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008080;">&quot;precision&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #008080;">&quot;recall&quot;</span><span class="f_CodeExample">,thres,precision,recall);</span>
<br><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">&nbsp;</span></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark">&nbsp;</span></p>
<p class="p_Text"><span class="f_Text" style="font-weight: bold;">Resulting curves:</span></p>
<p class="p_Text"><img class="help" alt="Precision-Recall curve" title="Precision-Recall curve" width="750" height="750" style="margin:0;width:750px;height:750px;border:none" src="precision_recall_curve.png"/></p>
<p class="p_FunctionRemark"><img class="help" alt="Precision-Recall graph" title="Precision-Recall graph" width="750" height="350" style="margin:0;width:750px;height:350px;border:none" src="precision_recall_micro.png"/></p>
<p class="p_FunctionRemark"><span class="f_FunctionRemark"> &nbsp; </span><br>
<span class="f_FunctionRemark">&nbsp;</span></p>
<p class="p_Functions" style="page-break-inside: avoid;"><span class="f_Functions">&nbsp;</span></p>

</div>

</body>
</html>
